<!DOCTYPE html>

<!-- Mirrored from wiki.processmaker.com/node/626 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Feb 2024 09:23:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta name="keywords" content="BPM, business process management, workflow, processmaker, business, BPM Windows, BPM Linux, wiki, BPM documentation, BPM FAQ, task documentation, BPM PHP, BPM Open Source, BPM Variables, BPM Installation, BPM Programming, BPM Elements, BPM Concepts, BPM Frequently Asked Questions, BPM 3.0, BPM News, Release notes, DynaForms, BPM Community, BPM Enterprise, BPM Mobile, BPM Responsive Web Design, User Manual, BPM Resources" />
<link rel="alternate" hreflang="en" href="../index.html" />
<link rel="shortcut icon" href="../themes/thecompany_responsive_theme/favicon.ico" type="image/vnd.microsoft.icon" />
<meta name="description" content="ProcessMaker is commercial open source workflow and business process management software." />
<meta name="viewport" content="width=device-width" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
<link rel="canonical" href="../3.2/Triggers.html" />
<link rel="shortlink" href="626.html" />
<title>3.2 - 3.8 - PHP in Triggers | Documentation@ProcessMaker</title>
<style type="text/css" media="all">
@import url("../modules/system/system.base2af9.css?s743n7");
@import url("../modules/system/system.menus2af9.css?s743n7");
@import url("../modules/system/system.messages2af9.css?s743n7");
@import url("../modules/system/system.theme2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../modules/aggregator/aggregator2af9.css?s743n7");
@import url("../modules/comment/comment2af9.css?s743n7");
@import url("../modules/field/theme/field2af9.css?s743n7");
@import url("../modules/node/node2af9.css?s743n7");
@import url("../modules/search/search2af9.css?s743n7");
@import url("../modules/toc_filter/toc_filter2af9.css?s743n7");
@import url("../modules/user/user2af9.css?s743n7");
@import url("../modules/views/css/views2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../sites/all/modules/colorbox/styles/default/colorbox_style2af9.css?s743n7");
@import url("../modules/ctools/css/ctools2af9.css?s743n7");
@import url("../sites/all/modules/geshifilter/geshifilter2af9.css?s743n7");
@import url("../modules/panels/css/panels2af9.css?s743n7");
@import url("../modules/nice_menus/css/nice_menus2af9.css?s743n7");
@import url("../modules/nice_menus/css/nice_menus_default2af9.css?s743n7");
@import url("../modules/fivestar/css/fivestar2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../themes/thecompany_responsive_theme/css/style2af9.css?s743n7");
@import url("../themes/thecompany_responsive_theme/css/media2af9.css?s743n7");
</style>
<script type="text/javascript" src="../modules/jquery_update/replace/jquery/1.9/jquery.min4b17.js?v=1.9.1"></script>
<script type="text/javascript" src="../misc/jquery.once7839.js?v=1.2"></script>
<script type="text/javascript" src="../misc/drupal2af9.js?s743n7"></script>
<script type="text/javascript" src="../modules/nice_menus/js/jquery.bgiframef195.js?v=2.1"></script>
<script type="text/javascript" src="../modules/nice_menus/js/jquery.hoverIntent1f6b.js?v=0.5"></script>
<script type="text/javascript" src="../modules/nice_menus/js/superfish099d.js?v=1.4.8"></script>
<script type="text/javascript" src="../modules/nice_menus/js/nice_menusc619.js?v=1.0"></script>
<script type="text/javascript" src="../modules/jquery_update/replace/ui/external/jquery.cookie1683.js?v=67fb34f6a866c40d0570"></script>
<script type="text/javascript" src="../modules/jquery_update/replace/misc/jquery.form.min97e5.js?v=2.69"></script>
<script type="text/javascript" src="../misc/ajax2347.js?v=7.34"></script>
<script type="text/javascript" src="../modules/jquery_update/js/jquery_update241d.js?v=0.0.1"></script>
<script type="text/javascript" src="../modules/toc_filter/toc_filter2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/colorbox/js/colorbox2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/colorbox/styles/default/colorbox_style2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/google_analytics/googleanalytics2af9.js?s743n7"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","../../www.google-analytics.com/analytics.js","ga");ga("create", "UA-3380652-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript" src="../misc/progress2347.js?v=7.34"></script>
<script type="text/javascript" src="../modules/fivestar/js/fivestar.ajax2af9.js?s743n7"></script>
<script type="text/javascript" src="../modules/fivestar/js/fivestar2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-1.10.2.min2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-ui2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-ui.min2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/custom2af9.js?s743n7"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"thecompany_responsive_theme","theme_token":"Q3M_LqsCwBigxE4-Bcr1Zj2lbnBSK1uOCYiQmJsiRio","jquery_version":"1.9","js":{"modules\/jquery_update\/replace\/jquery\/1.9\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"modules\/nice_menus\/js\/jquery.bgiframe.js":1,"modules\/nice_menus\/js\/jquery.hoverIntent.js":1,"modules\/nice_menus\/js\/superfish.js":1,"modules\/nice_menus\/js\/nice_menus.js":1,"modules\/jquery_update\/replace\/ui\/external\/jquery.cookie.js":1,"modules\/jquery_update\/replace\/misc\/jquery.form.min.js":1,"misc\/ajax.js":1,"modules\/jquery_update\/js\/jquery_update.js":1,"modules\/toc_filter\/toc_filter.js":1,"sites\/all\/modules\/colorbox\/js\/colorbox.js":1,"sites\/all\/modules\/colorbox\/styles\/default\/colorbox_style.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1,"misc\/progress.js":1,"modules\/fivestar\/js\/fivestar.ajax.js":1,"modules\/fivestar\/js\/fivestar.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-1.10.2.min.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-ui.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-ui.min.js":1,"themes\/thecompany_responsive_theme\/js\/custom.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/aggregator\/aggregator.css":1,"modules\/comment\/comment.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/toc_filter\/toc_filter.css":1,"modules\/user\/user.css":1,"modules\/views\/css\/views.css":1,"sites\/all\/modules\/colorbox\/styles\/default\/colorbox_style.css":1,"modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"modules\/panels\/css\/panels.css":1,"modules\/nice_menus\/css\/nice_menus.css":1,"modules\/nice_menus\/css\/nice_menus_default.css":1,"modules\/fivestar\/css\/fivestar.css":1,"themes\/thecompany_responsive_theme\/css\/style.css":1,"themes\/thecompany_responsive_theme\/css\/media.css":1}},"colorbox":{"opacity":"0.85","current":"{current} of {total}","previous":"\u00ab Prev","next":"Next \u00bb","close":"Close","maxWidth":"98%","maxHeight":"98%","fixed":true,"mobiledetect":true,"mobiledevicewidth":"480px","specificPagesDefaultValue":"admin*\nimagebrowser*\nimg_assist*\nimce*\nnode\/add\/*\nnode\/*\/edit\nprint\/*\nprintpdf\/*\nsystem\/ajax\nsystem\/ajax\/*"},"toc_filter_smooth_scroll_duration":"","googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip","trackColorbox":1},"nice_menus_options":{"delay":"800","speed":"slow"},"ajax":{"edit-vote--2":{"callback":"fivestar_ajax_submit","event":"change","url":"\/system\/ajax","submit":{"_triggering_element_name":"vote"}}}});
//--><!]]>
</script>
<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','../../connect.facebook.net/en_US/fbevents.js');
// Insert Your Facebook Pixel ID below.
fbq('init', '735235999992228');
fbq('track', 'PageView');
</script>
<!-- Insert Your Facebook Pixel ID below. -->
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=735235999992228&amp;ev=PageView&amp;noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->

</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-626 node-type-processmakerbpm">
    
<div class="wrap">

<div id="header_wrapper">
  <div id="inner_header_wrapper">

    <header id="header" role="banner">
      
      <div class="header_inner_wrapper">
        <div class="header_left">
                      <div id="logo">
              <a href="../index.html" title="Home"><img src="../sites/default/files/full-logo.png"/></a>
            </div>
                    	  <div class="menu_wrapper">
            <nav id="main-menu"  role="navigation">
              <a class="nav-toggle" href="#">Navigation</a>
              <div class="menu-navigation-container">
                <ul class="menu"><li class="first leaf"><a href="../PM_Classic.html" title="Learn how to develop business solutions in ProcessMaker Platform while maintaining your existing ProcessMaker 3 solutions in PM Classic: the perfect bridge between your new and existing solutions with a state-of--the-art BPM platform.">PM Classic</a></li>
<li class="leaf"><a href="http://www.processmaker.com/tutorials" title="">Tutorials</a></li>
<li class="leaf"><a href="../3.1/user_guide.html">User Guide</a></li>
<li class="leaf"><a href="../3.1/developer_info.html">Developer Info</a></li>
<li class="leaf"><a href="../3.2/sys_administration.html">Sys Administration</a></li>
<li class="leaf"><a href="../3.1/resources.html">Helpful Resources</a></li>
<li class="leaf"><a href="../Sitemap.html">Sitemap</a></li>
<li class="last leaf"><a href="https://processmaker.gitbook.io/processmaker/" title="Read ProcessMaker Platform Spring 2023 documentation to learn more about the next generation of BPM.">ProcessMaker Platform</a></li>
</ul>              </div>
              <div class="clear"></div>
            </nav>
          </div>
                  <!--  <h1 id="site-title">
            <a href="/" title="Home">Documentation@ProcessMaker</a>
            <div id="site-description"></div>
          </h1> -->
            
        </div>
      </div>
      <div class="header_right">
          <div class="region region-search">
  <div id="block-search-form" class="block block-search">

        <h2 >_</h2>
    
  <div class="content">
    <form action="https://wiki.processmaker.com/node/626" method="post" id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
    <div class="form-item form-type-textfield form-item-search-block-form">
  <label class="element-invisible" for="edit-search-block-form--2">Search </label>
 <input title="Enter the terms you wish to search for." placeholder="Search" type="text" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text" />
</div>
<div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit" /></div><input type="hidden" name="form_build_id" value="form-lTLXBkstl-eJ7xyUKoPaS1Cvihm4hC5riG7sIW43fgc" />
<input type="hidden" name="form_id" value="search_block_form" />
</div>
</div></form>  </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
                  <h1 class="page-title">3.2 - 3.8 - PHP in Triggers</h1>                <p class="page-title-suffix"></p>
                 <div style="margin-top: 5px;"></div>
      </div>
    </header>
    <div class="region-version">
      <span>Version: </span><ul><li><a  class="active-version">3.8</a></li><li><a  class="active-version">3.7</a></li><li><a  class="active-version">3.6</a></li><li><a  class="active-version">3.5</a></li><li><a  class="active-version">3.4</a></li><li><a  class="active-version">3.3</a></li><li><a  class="active-version">3.2</a></li><li><a href="../3.1/Triggers.html" class="">3.1</a></li><li><a href="../3.0/Triggers.html" class="">3.0</a></li><li><a href="../index.php/2.0/Triggers.html" class="">2.x</a></li></ul>    </div>
  </div>
</div>
<!-- <ul class="nice-menu nice-menu-down nice-menu-main-menu" id="nice-menu-0"><li class="menu-506 menu-path-node-1078 first odd "><a href="/PM_Classic" title="Learn how to develop business solutions in ProcessMaker Platform while maintaining your existing ProcessMaker 3 solutions in PM Classic: the perfect bridge between your new and existing solutions with a state-of--the-art BPM platform.">PM Classic</a></li>
<li class="menu-319 menu-path-processmakercom-tutorials  even "><a href="http://www.processmaker.com/tutorials" title="">Tutorials</a></li>
<li class="menu-320 menu-path-node-571  odd "><a href="/3.1/user_guide">User Guide</a></li>
<li class="menu-1138 menu-path-node-572  even "><a href="/3.1/developer_info">Developer Info</a></li>
<li class="menu-1197 menu-path-node-876  odd "><a href="/3.2/sys_administration">Sys Administration</a></li>
<li class="menu-1140 menu-path-node-236  even "><a href="/3.1/resources">Helpful Resources</a></li>
<li class="menu-1141 menu-path-node-554  odd "><a href="/Sitemap">Sitemap</a></li>
<li class="menu-1213 menu-path-sprocessmakergitbookio-processmaker-  even last"><a href="https://processmaker.gitbook.io/processmaker/" title="Read ProcessMaker Platform Spring 2023 documentation to learn more about the next generation of BPM.">ProcessMaker Platform</a></li>
</ul>
-->
  
  <div id="container">
    
    <div class="content-sidebar-wrap">

    <div id="content">

              <!-- <div id="breadcrumbs">
        <h2 class="element-invisible">You are here</h2><div class="breadcrumb"><a href="/">Home</a></div></div> -->
      
      <section id="post-content" role="main">
                                        <div class="region region-content">
  <div id="block-system-main" class="block block-system">

      
  <div class="content">
                          <span property="dc:title" content="3.2 - 3.8 - PHP in Triggers" class="rdf-meta element-hidden"></span>  
      
    
  <div class="content node-processmakerbpm">
    <div class="field field-name-field-how-useful-did-you-find-th field-type-fivestar field-label-above"><div class="field-label">Please rate how useful you found this document:&nbsp;</div><div class="field-items"><div class="field-item even"><form class="fivestar-widget" action="https://wiki.processmaker.com/node/626" method="post" id="fivestar-custom-widget" accept-charset="UTF-8"><div><div  class="clearfix fivestar-average-text fivestar-average-stars fivestar-form-item fivestar-default"><div class="form-item form-type-fivestar form-item-vote">
 <div class="form-item form-type-select form-item-vote">
 <select id="edit-vote--2" name="vote" class="form-select"><option value="-">Select rating</option><option value="20">Give 3.2 - 3.8 - PHP in Triggers 1/5</option><option value="40">Give 3.2 - 3.8 - PHP in Triggers 2/5</option><option value="60" selected="selected">Give 3.2 - 3.8 - PHP in Triggers 3/5</option><option value="80">Give 3.2 - 3.8 - PHP in Triggers 4/5</option><option value="100">Give 3.2 - 3.8 - PHP in Triggers 5/5</option></select>
<div class="description"><div class="fivestar-summary fivestar-summary-average-count"><span class="average-rating">Average: <span >2.8</span></span> <span class="total-votes">(<span >11</span> votes)</span></div></div>
</div>

</div>
</div><input class="fivestar-submit form-submit" type="submit" id="edit-fivestar-submit" name="op" value="Rate" /><input type="hidden" name="form_build_id" value="form-g4TYHcequZs72Ay7MFQIsVMGZ3pU1GdJ7mR_LXZfTiY" />
<input type="hidden" name="form_id" value="fivestar_custom_widget" />
</div></form></div></div></div><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><div style="float: right; margin-left: 5px; background-color: #f9f9f9; border: 1px solid #aaaaaa; padding: 5px;"><center><strong>Contents:</strong> [<a href="#" onclick="var el = document.getElementById('toc');
        var txt = ('innerText' in el)? 'innerText' : 'textContent';
        if (el.style.display=='none') { 
           el.style.display = '';
           document.getElementById('hideLabel')[txt] = 'hide';
        }
        else {
	        el.style.display = 'none';
           document.getElementById('hideLabel')[txt] = 'show';
        }"><span id="hideLabel">hide</span></a>]</b></center><div id="toc" ><ol class="toc">
<li class="toc"><a href="#Overview">Overview</a></li>
<li class="toc"><a href="#Trigger_Timing">Trigger Timing</a></li>
<ol class="toc">
<li class="toc"><a href="#When_to_set_Triggers_to_Fire">When to Set Triggers to Fire</a></li>
<ol class="toc">
<li class="toc"><a href="#Asynchronous_Case_Routing">Asynchronous Case Routing</a></li>
</ol>
<li class="toc"><a href="#Case_Variables">Case Variables</a></li>
<ol class="toc">
<li class="toc"><a href="#Typing_rules_for_Case_Variables">Typing Rules for Case Variables</a></li>
</ol>
</ol>
<li class="toc"><a href="#How_to_use_case_variables">How to Use Case Variables</a></li>
<ol class="toc">
<li class="toc"><a href="#System_Variables_in_Triggers">System Variables in Triggers</a></li>
<li class="toc"><a href="#Operators">Operators</a></li>
<li class="toc"><a href="#Terminating_Statements">Terminating Statements</a></li>
<li class="toc"><a href="#Examples">Examples </a></li>
</ol>
<li class="toc"><a href="#Creating_Triggers">Creating Triggers</a></li>
<ol class="toc">
<li class="toc"><a href="#Custom_Trigger">Custom Trigger</a></li>
</ol>
<li class="toc"><a href="#Trigger_Management">Trigger Management</a></li>
<ol class="toc">
<li class="toc"><a href="#Copy/Import_Triggers_from_a_process">Copy/Import Triggers from a Process</a></li>
<li class="toc"><a href="#Creating_a_Trigger_with_the_Wizard">Creating a Trigger with the Wizard</a></li>
<ol class="toc">
<li class="toc"><a href="#ProcessMaker_Functions">ProcessMaker Functions</a></li>
</ol>
</ol>
<li class="toc"><a href="#Inserting_a_trigger_in_a_process">Inserting a Trigger in a Process</a></li>
<ol class="toc">
<li class="toc"><a href="#Firing_Triggers_Based_on_Conditions">Firing Triggers Based on Conditions</a></li>
</ol>
<li class="toc"><a href="#Debugging_Triggers">Debugging Triggers </a></li>
<ol class="toc">
<li class="toc"><a href="#Enabling_Debug_Mode">Enabling Debug Mode</a></li>
<li class="toc"><a href="#Using_the_ProcessMaker_Debugger">Using the ProcessMaker Debugger</a></li>
<ol class="toc">
<li class="toc"><a href="#Variables_Tab">Variables Tab</a></li>
<li class="toc"><a href="#Triggers_tab">Triggers Tab</a></li>
</ol>
<li class="toc"><a href="#Viewing_Error_Messages">Viewing Error Messages</a></li>
</ol>
<li class="toc"><a href="#When_action_cases">Triggers when Committing an Action in Cases</a></li>
<li class="toc"><a href="#Timeouts">Timeout Triggers for Self Service Tasks</a></li>
</ol>
</div></div>

<h2><span id="Overview">Overview</span></h2>
<p>A trigger is a piece of PHP code that can be inserted into a process. Triggers provide the appropriate framework to perform complex calculations and add additional functionality to processes.</p>
<p>A ProcessMaker trigger is parsed like a PHP script, so normal PHP variables and functions can be used inside triggers, along with ProcessMaker's <a href="#Case_Variables">case variables</a> and <a href="#System_Variables_in_Triggers">system variables</a>. <!--PHP libraries can also be imported into ProcessMaker triggers with the <a href="http://us.php.net/manual/en/function.require-once.php">require_once()</a> function. With access to the PHP language and its libraries, a great deal of functionality can be added to a trigger.--></p>

<h2><span id="Trigger_Timing">Trigger Timing</span></h2>
<p>Triggers can be fired at many points during the process:</p>
<ol>
<li><strong><em>Before</em></strong> a step is run (i.e., Dynaforms, Input Documents and Output Documents).</li>
<li><strong><em>After</em></strong> a step is run.</li>
<li><strong><em>Before</em></strong> a user is assigned (designated) to work on the next task in the process.</li>
<li><strong><em>Before</em></strong> a case is routed to the next task in the process.</li>
<li><strong><em>After</em></strong> a case is routed to the next task in the process.</li>
</ol>
<p>For example, a process whose first task contains a Dynaform step and an Input Document step will fire the triggers in the following order:</p><dl><dd></dd><dd><em>Before step trigger</em></dd><dd><strong>Dynaform step</strong></dd><dd></dd><dd><em>After step trigger</em></dd></dl>
<p>&nbsp;</p><dl><dd></dd><dd><em>Before step trigger</em></dd><dd><strong>Input Document step</strong></dd><dd></dd><dd><em>After step trigger</em></dd></dl>
<p>&nbsp;</p><dl><dd></dd><dd><em>Before assignment trigger</em></dd><dd><strong>Assignment of user for next task</strong></dd></dl>
<p>&nbsp;</p><dl><dd></dd><dd><em>Before routing trigger</em></dd><dd><strong>Routing to next task</strong></dd><dd></dd><dd><em>After routing trigger</em></dd></dl>
<p>&nbsp;</p>

<h3><span id="When_to_set_Triggers_to_Fire">When to Set Triggers to Fire</span></h3>
<table><tbody>
</tr><td><center><strong>Before a step</strong></center></td><td>If the step is a Dynaform, this is a good point to set any case variables that will be displayed in the Dynaform's fields. If the step is an Output Document, then case variables can be set to be used in the Output Document's template.</td></tr>
</tr><td><center><strong>After a step</strong></center></td><td>
<p>After a Dynaform step, the data from the Dynaform's fields exists as case variables, but hasn't yet been submitted to the database and any files uploaded to <a href="../3.0/File_control.html" title="3.0/Files">File</a> fields have not yet been saved to the file system. This a good point to alter the data before it gets submitted. </p>

<p style="margin-left:25px"><strong><font color="red">Warning:</font></strong> <font color="dimgray"> If the <a href="http://php.net/manual/en/function.die.php">die()</a>, <a href="http://php.net/manual/en/function.exit.php">exit()</a> or some other function is called that stops the completion of the trigger, it will prevent the data and files in the Dynaform from being saved to the database. To use <code>die()</code> or <code>exit()</code> in a trigger, set the trigger to fire <i>before</i> the next step (or <em>before assignment</em> if at the last step in the task). Alternatively, call <a href="../3.0/ProcessMaker_Functions.html#PMFSendVariables.28.29">PMFSendVariables(@@APPLICATION, ...)</a> to save the variables in the current case before calling <code>die()</code> or <code>exit()</code>. </font></p>
<p>A trigger set to fire <i>after</i> an Input Document step is fired <i>every time</i> another file is added to the Input Document, so it may be fired multiple times. 
The trigger is fired <i>after</i> the new file has already been added to the database and saved in the server's file system. Therefore, it isn't possible to prevent the file from being saved with trigger code, but it is possible to look up the latest file that was added to the <b><tt>APP_DOCUMENT</tt></b> table and call <a href="../3.0/Internal_Functions_and_Classes.html#AppDocument::remove.28.29">AppDocument::remove()</a> to eliminate the latest file from the Input Document.</p>
<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray"> Clicking on <b>Next Step</b> does not run the trigger. </font></p>
<p>If no file is uploaded to an Input Document, then a trigger set to be fired <i>after</i> the Input Document will <i>not be fired</i>. To set the trigger to always fire, then set the trigger to fire <i>before</i> the next step in the task (or <i>before assignment</i> if at the last step in the task).</p>  
</td></tr>
</tr><td><center><strong>Before Assignment</strong></center></td><td>If the next task in the process uses <a href="../3.0/Tasks.html#Assignment_Rules">Value Based Assignment</a>, this is a good point to set the variable used to determine the next user. Note that before assignment triggers will <em>always</em> fire, even in final tasks when there is no user assignment for the next task.</td></tr>
</tr><td><center><strong>Before Routing </strong></center></td><td>This is a good point to set any variables used by <a href="../3.0/Using_Conditions.html" title="Using Conditions">conditions</a> to direct the flow to the next activity (task or sub-process).</td></tr>
</tr><td><center><strong>After Routing </strong></center></td><td>At this point, the record for the <em>next</em> task has already been written to the database in the <strong><code>wf_&lt;WORKSPACE&gt;.APP_DELEGATION</code></strong> table, so it can be consulted with database queries. Before this point, the next task and the next user can not be known for sure.</td></tr></tbody></table>

<h4><span id="Asynchronous_Case_Routing">Asynchronous Case Routing</span></h4>
<p style="margin-left:25px"><strong><font color="green">Available Version:</font></strong> <font color="dimgray"> As of ProcessMaker 3.5.0</font></p>

<p>"Task Manager through Laravel Queue jobs integrates in ProcessMaker to send emails asynchronously in the background to improve ProcessMaker runtime efficiency, performance and handling errors. However, Task Manager also queues case step triggers (Before and After Routing) as jobs asynchronously in the background. Therefore, the debugger does not evaluate triggers in those case steps while routing occurs."</p>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">All asynchronous case routing occurs in the background. Then, when a case is in the next task, the refresh time updates the view in the <a href="../3.2/Cases/Cases.html#Inbox">Inbox</a>. Therefore, to not wait, as a best practice configure the <a href="../3.2/Environment_Settings.html#Case_List_Refresh_Time">counters refresh time</a>.</font></p>

<p>This behavior works for the following instances:</p>
<ul>
    <li><a href="../3.3/Notifications.html#Task_Notifications">Task Notifications</a>
    <ul>
        <li>After routing notify the next assigned user(s)</li>
        <li>Notify the assigned user to this task</li>
    </ul>
    </li>
    <li><a href="../3.3/Actions_by_Email.html">Actions by Email</a>
        <ul>
            <li>Link to Fill a Form</li>
            <li>Use a Field to Generate Action Links</li>
            <li>Email Response</li>
            <li>Custom Actions</li>
        </ul>
    </li>
    <li><a href="../3.2/Tasks.html#ScriptTask">Script Task</a>
        <p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">The Script Task running does not work with session variables and global variables that work with timer events. Review the <a href="../Best_Practices/Advanced_Developer_Triggers.html#Triggers">Trigger best practices.</a></font></p>
    </li>
    <li><a href="../3.2/Tasks.html#ServiceTask">Service Task</a></li>
    <li><a href="../3.2/Sub-Processes.html">Asynchronous and synchronous Sub-Process</a></li>
    <li>All routing cases from the ProcessMaker web that involve before and after routing. Take into account that <b>Asynchronous Case Routing</b> does not work in ProcessMaker Mobile.
        <p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">As of <b>ProcessMaker 3.5.0</b>, it is important to configure <a href="../3.5/Events.html#EmailMessage">Intermediate Email Event</a> to avoid problems with the Laravel Queue jobs.</font></p>
    </li>
</ul>

<p>If there are errors, they are recorded in:</p>
<ul>
    <li>All errors including all related to before and after routing records in <a href="../3.3/ProcessMaker_Standard_Logging.html">ProcessMaker Standard Logs</a> describing all references about the error occurred. It takes into account the <a href="https://laravel.com/docs/5.7/queues#dealing-with-failed-jobs">QUEUE Jobs failed</a>.</li>
    <li>All errors related to <a href="../3.3/Actions_by_Email.html#Actions_by_Email_Log">Actions by Email Log</a>.</li>
</ul>

<h3><span id="Case_Variables">Case Variables</span></h3>
<p>
In addition to normal PHP variables, triggers can use <strong><em>case variables</em></strong>, which are variables that hold information about a ProcessMaker case and can only be used while that case is running. 

These variables can be defined by clicking on Variables in the Process Objects menu on the process map.  Controls in Dynaforms, such as textboxes, dropdown boxes, grids, etc., can be associated to a case variable to hold the values entered into that control. 
When a user clicks a <a href="../3.0/Submit_and_Button_Controls.html#Submit" title="3.0/Buttons">submit</a> button in a Dynaform, the values in the controls are saved to their case variables, which are automatically created for each control when data is entered as the case variable value.

</p>

<p>Not only can triggers access case variables defined in the Variables list, they can also define additional case variables. If a subsequent Dynaform in the case uses the variable in a field, the field's value will automatically be set to the value of the variable. When the Dynaform is submitted, the value in the field will be assigned to its case variable.</p>
<p>For instance, a trigger could define the case variable <code>@@ApplicationDate</code> and store the current date in it. A subsequent Dynaform containing the field whose variable is <code>@@ApplicationDate</code> would display that date. The user could alter the date in the Dynaform, which would then change the value stored in the case variable <code>@@ApplicationDate</code>. A subsequent trigger could examine <code>@@ApplicationDate</code> and make calculations based on that date.</p>

<p>Case variables are defined like normal PHP variables, except they use <strong>@@</strong>, <strong>@%</strong>, <strong>@#</strong> and <strong>@=</strong> instead of <strong>$</strong> to identify them. For example:</p>
<p><span class="geshifilter"><code class="php geshifilter-php"><span style="color: #339933;">@@</span>myVariable <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Hello world!&quot;</span><span style="color: #339933;">;</span></code></span></p>
<p>Where:</p>
<table><tbody>
<tr><td><code>@@myVariable</code></td><td>A case variable parsed as a string.</td></tr>
<tr><td><code>=</code></td><td>The equals symbol means that the entire right side of the expression will be assigned to a variable. <tr><td>"Hello word!"</td><td>A string of characters to assign to the variable. All strings need to either be enclosed in <code>'</code>(single quotation marks) or <code>"</code> (double quotation marks). In contrast, integers such as <code>987</code> and floating-point numbers such as <code>19.87</code> are not enclosed in quotation marks.</td></tr>
</tr><td><strong>;</strong></td><td>A semicolon indicates the end of a trigger statement. Each trigger statement should be finished with a semicolon.</td></tr></tbody></table>
<p>Note that case variables only have scope when their case is open. To create global variables that can be accessed by any case, use this <a href="../3.0/Trigger_Examples.html#Workaround_for_Global_Variables" title="Trigger Examples">workaround</a>.</p>

<h4><span id="Typing_rules_for_Case_Variables">Typing Rules for Case Variables</span></h4>
<p>When referencing a <a href="../3.2/Triggers.html#How_to_use_case_variables">case variable</a> within a trigger, take into account the following typing rules:</p>
<ul>
<li><strong><code>@@<font color=green><i>variable_name</i></font></code></strong><br> The variable will be parsed as a <em>string</em>. If originally another type, it will be converted to a string. So <code>-1</code>, <code>0</code> and <code>12.45</code> become <code>"-1"</code>, <code>"0"</code> and <code>"12.45"</code>, respectively. Take into account that the end of line in a variable value is represented by <code> \r\n</code>, for example, <code>"variable \r\n next line"</code>.</li>
<li><strong><code>@%<font color=green><i>variable_name</i></font></code></strong> &nbsp; &nbsp;<br> The variable will be parsed as an <em>integer</em> (a whole number). If originally another type, it will be converted to an integer. A real number will be converted to a whole number, so 12.99 becomes 12. The decimal portion of the number is dropped and there is no rounding up in the conversion. A string that contains numbers will be converted to a whole number, so <code>"655"</code> and <code>"34.19"</code> become <code>655</code> and <code>34</code>, respectively.</li>
<li><strong><code>@#<font color=green><i>variable_name</i></font></code></strong> <br> The variable will be parsed as a <em>float</em> type (a real number with decimals).</li>

<li><strong><code>@=<font color=green><i>variable_name</i></font></code></strong> &nbsp; &nbsp;<br> The variable's type will not be changed and it is parsed as its original type. This is recommended when referencing booleans, arrays and objects.<br> 
<p style="margin-left:25px"><font color=green><b>Note:</b></font> <font color=dimgrey> If the variable is an array or an boolean, its type will not be changed by the type casting, but it is recommended to reference it as <code>@=<font color=green><i>variable_name</i></font></code> for greater clarity in the code.</font></p>
</li>

<li><strong><code>@&<font color=green><i>variable_name</i></font></code></strong> &nbsp; &nbsp;<br> Used to reference object variables. Note that it is not necessary to initialize object variables inside triggers, because object variables are initialized when they are created in the Variables section. Use PHP object standard syntax to access the object properties. For example:<br> 
<codeblock>@&Address→street = "Norman Street"
@&Address→number = "123"
</codeblock>

<p>To use the object variable, take note of these considerations:</p>
<ul>
    <li>Objects inside objects are not supported.</li>
    <li>Multiple objects can be defined and each object can have multiple attributes, but each attribute must be a scalar value; multidimensional values are not supported.</li>
</ul>

</li>
</ul>

<p>For example, this statement uses three case variables which are parsed as a string, an integer and its original type, respectively.</p><span class="geshifilter"><code class="php geshifilter-php"><span style="color: #339933;">@@</span>other_value <span style="color: #339933;">=</span> <span style="color: #339933;">@%</span>any_number <span style="color: #339933;">+</span> <span style="color: #339933;">@=</span>age <span style="color: #339933;">-</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span></code></span>
<p>Where:</p>
<ul>
<li><strong><code>any_number</code></strong> could be a number from a text field in a Dynaform; this variable will be parsed as an integer value.</li>
<li><strong><code>age</code></strong> could be a field in any Dynaform, but it's type will not be changed.</li></ul>

<p>Type conversion of case variables only happens when the variable is an R-value, which means that it is what is on the right-hand side of an assignment statement and is <strong>assigned from</strong>:</p>

<p>L-value (assigned to) = R-value (assigned from);</p>
<p>If a case variable is an L-value or is <strong>assigned to</strong>, no type conversion happens. For example:</p><div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$x</span> &nbsp;<span style="color: #339933;">=</span> <span style="color: #339933;">@</span><span style="color: #666666; font-style: italic;">#y; &nbsp; &nbsp;//R-value, so transformed to float before assignment<br />
</span><span style="color: #000088;">$a</span> &nbsp;<span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>b<span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//R-value, so transformed to string before assignment</span><br />
<span style="color: #339933;">@</span><span style="color: #666666; font-style: italic;">#c = &quot;40.0&quot;; //@#c is a L-value, so assigned a string and no type conversion <br />
</span><span style="color: #339933;">@@</span>d <span style="color: #339933;">=</span> <span style="color:#800080;">40.0</span><span style="color: #339933;">;</span> &nbsp; <span style="color: #666666; font-style: italic;">//@#d is a L-value, so assigned a float and no type conversion</span></div></div>
<p>It is important to note that <strong><code>variable_name</code></strong> follows the PHP rules for variable name definition. That means a valid case variable name in ProcessMaker starts with a letter or underscore, followed by any number of letters, numbers, or underscores. Case variables are case sensitive, so <strong><code>@@myvar</code></strong>, <strong><code>@@MyVar</code></strong> and <strong><code>@@MYVAR</code></strong> are three different variables. If passing values between triggers and Dynaforms, make sure that the case variable name in the trigger is spelled the same as the variable name used in the Dynaform field. ProcessMaker case variables are stored separately from normal PHP variables, so a trigger with <strong><code>$myVar</code></strong> and <strong><code>@@myVar</code></strong> would have two different variables.</p>
<p>ProcessMaker retains the original value of case variables as normal PHP variables, so they not altered by using the different conversion rules. For instance:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@=</span>MyVar <span style="color: #339933;">=</span> <span style="color:#800080;">22.345</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$sum</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">5</span> <span style="color: #339933;">+</span> <span style="color: #339933;">@%</span>MyVar<span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;"># Use MyVar as the integer 22<br />
</span><span style="color: #000088;">$str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Sum: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>MyVar<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;"># Use MyVar as the string &quot;22.345&quot;<br />
</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;"># @=MyVar still equals its original value of 22.345 <br />
</span><span style="color: #000088;">$total</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>MyVar <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> &nbsp; &nbsp; <span style="color: #666666; font-style: italic;"># $total equals 23.345</span></div></div>
<p>ProcessMaker case variables can not be inserted into strings like normal PHP variables. The following statement will <em><strong>not</strong></em> work:</p><div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;My name is @@MyName and my age is @%MyAge.<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span></div></div>
<p>To insert case variables in a string, either reassign them to normal PHP variables and insert them:</p><div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$my_name</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>MyName<span style="color: #339933;">;</span> <br />
<span style="color: #000088;">$my_age</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@%</span>MyAge<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;My name is <span style="color: #006699; font-weight: bold;">$my_name</span> and my age is <span style="color: #006699; font-weight: bold;">$my_age</span>.<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span></div></div>
<p>Or use the dot operator (.) to concatenate strings with case variables:</p><div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;My name is &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>MyName <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot; and my age is &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@%</span>MyAge <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;.<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span></div></div>
<p>When a case variable that is an integer or floating point number is concatenated with <strong><code>.</code></strong> (dot operator), it is automatically converted to a string.</p>

<h2><span id="How_to_use_case_variables">How to Use Case Variables</span></h2>
<p>Case variables hold data specific to a case and can either be set in a Dynaform field or a trigger. Unlike <a href="#System_Variables_in_Triggers">system variables</a>, which are defined automatically by ProcessMaker, case variables are defined in the Variables list inside the Process Designer or by defining them in triggers.</p>

<p>Case and System variables can be used in:</p>
<ul>
<li><a href="../3.0/Output_Documents.html" title="3.0/Output Documents">Output Documents</a></li>
<li><a href="../3.0/Input_Documents.html" title="3.0/Input Documents">Input Documents</a></li>
<li><a href="../3.0/Process_Files_Manager.html" title="3.0/Process Files Manager">Process File Manager</a></li>
<li><a href="#Creating_Triggers">Triggers</a></li>
<li><a href="../3.0/Tasks.html#Steps">Assigning Steps to Tasks</a></li>
<li><a href="../3.0/Tasks.html#NOTIFICATIONS">Dynaform notifications</a></li></ul>

<p>For instance, inside the properties of an activity, in the <strong>Variable for Case priority</strong> field:</p>
<p><img src="../sites/default/files/3.6.x_BPMN_ActivityPropertiesVariableForCaseProperty.png" alt="" width="828" height="459"></p>
<p>Click on the @@ button to access the list of case and system variables.</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_ProcessVariables.png" alt="" width="444" height="438"></p>
<ul>
<ul>
<li><code><strong>Prefix.</strong></code> Select the prefix the variable will use in the field. These prefixes are explained in this <a href="#Typing_rules_for_Case_Variables"> section</a>.</li>
<li><code><strong>Help icon.</strong></code> Hover the mouse pointer over the "?" icon to view the existing prefixes for variables:</li></ul></ul><dl><dd>
<p><img src="../sites/default/files/3.6.x_BPMN_TriggersProcessVariablesHelpIcon.png" alt="" width="660"></p></dd></dl>
<ul>
<li><code><strong>Text to search.</strong></code> Enter the name of the variable to be found.</li>
<li><code><strong>Variable.</strong></code> This column lists the names of all existing variables. To add a variable to the list, select it and click on the Insert Variable button at the bottom of the window.</li>
<li><code><strong>Label.</strong></code> This column indicates whether it is a system or case variable.</li>
<li><code><strong>Pagination control.</strong></code> Each page lists only ten items; navigate through all existing variables using this control.</li>

<li><code><strong>Insert variable.</strong></code> Click on this button to insert a variable.</li></ul>
<h3><span id="System_Variables_in_Triggers">System Variables in Triggers</span></h3>

<p>In addition to case variables, triggers can also use system variables, which are predefined variables that have the same syntax as case variables and hold information about the current ProcessMaker system.</p>
<p>ProcessMaker has the following system variables:</p>
<p style="margin-left:25px"><span style="color: green;"><strong>Note:</strong></span> <span style="color: dimgrey;">UID stands for "unique identification", which is a string of 32 hexadecimal characters that identifies objects in ProcessMaker. To find the UIDs for processes, tasks, cases, users, groups, etc., see <a href="../3.0/Consulting_the_ProcessMaker_databases.html" title="Consulting the ProcessMaker databases">Consulting the ProcessMaker databases</a>.</span></p>
<table><tbody>
<tr><th>Variable Name</th><th>Variable Description</th></tr>

<tr><td><code>@@SYS_LANG</code></td><td>Current system language in two letter <a href="http://en.wikipedia.org/wiki/ISO_639-1">ISO 639-1</a> code, which by default is "en" (English).</td></tr>

<tr><td><code>@@SYS_SKIN</code></td><td>Current system skin, which by default is "neoclassic" in ProcessMaker 3.</td></tr>

<tr><td><code>@@SYS_SYS</code></td><td>Current <a href="../3.0/Workspaces.html" title="Workspaces">workspace</a> name, which by default is "workflow".</td></tr>

<tr><td><code>@@PROCESS</code></td><td>Current <a href="../3.1/Processes.html" title="Processes">process</a> UID.</td></tr>

<tr><td><code>@@TASK</code></td><td>Current task UID.</td></tr>

<tr><td><code>@@APPLICATION</code></td><td>Current case UID.</td></tr>

<tr><td><code>@@APP_NUMBER</code></td><td>Current case number. <strong><font color="#009688">Available Version:</font></strong> <font color="dimgray"> 3.1 and later. </font></td></tr>

<tr><td><code>@@USER_LOGGED</code></td><td>UID of the current <a href="../3.0/Managing_Users.html" title="Managing Users">user</a>.</td></tr>

<tr><td><code>@@USR_USERNAME&nbsp;</code></td><td>Username of the current <a href="../3.0/Managing_Users.html" title="Managing Users">user</a>.</td></tr>

<tr><td><code>@%INDEX</code></td><td>The delegation index number, which is a positive integer that counts tasks in a process, starting from 1. If multiple tasks are operating in parallel, then each task will have a different index number.</td></tr>

<tr><td><code>@@PIN</code></td><td>The 4 character <a href="../3.0/Case_Tracker.html" title="Case Tracker">PIN</a>, which can be used to access information about the case without being a registered user at:<br>&nbsp;&nbsp;<code>http://&lt;IP-ADDRESS&gt;:&lt;PORT&gt;/sys&lt;WORKSPACE&gt;/&lt;LANG&gt;/&lt;SKIN&gt;/tracker/login</code></td></tr>

<tr><td height="41"><code>@@__ERROR__</code></td><td>If a ProcessMaker error occurs, this system variable will be created containing the error message. Note that this system variable only exists after a ProcessMaker exception occurs. It will <em><strong>not</strong></em> be created by syntax errors in PHP or JavaScript or by errors that ProcessMaker doesn't know how to handle.
</td></tr>
</tbody></table>

<p style="margin-left:25px">
    <strong><font color="red">Warning:</font></strong>
    <font color="dimgray"> It is a bad practice to overwrite System Variables like  <code>@@__ERROR__</code> via triggers. Avoid this bad practice to do not have errors while calling REST APIs.</font>
</p>

<h3><span id="Operators">Operators</span></h3>
<p>Operators in ProcessMaker triggers are handled like PHP operators.</p><div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">@#a + @#b &nbsp; Addition <br />
@#a - @#b &nbsp; Subtraction<br />
@#a * @#b &nbsp; Multiplication<br />
@#a / @#b &nbsp; Division<br />
@#a % @#b &nbsp; Modulus (Remainder)<br />
@@a . @@b &nbsp; String concatenation</div></div>
<h3><span id="Terminating_Statements">Terminating Statements</span></h3>
<p>A statement in a ProcessMaker trigger can extend for multiple lines. All statements should terminate with a <strong><code>;</code></strong> (semicolon) to indicate where the statement ends. Follow next trigger code example as a good practice for terminating statements with semicolon.</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$db</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;71525495056005261835755079295218&quot;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//Unique ID of the database connection</span><br />
<span style="color: #000088;">$grid</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>grid<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$rows</span> <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$grid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;=</span> <span style="color: #000088;">$rows</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$quantity</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$grid</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;Quantity&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$description</span> <span style="color: #339933;">=</span> <a href="http://php.net/addslashes"><span style="color: #990000;">addslashes</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$grid</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;Description&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$unitCost</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$grid</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;UnitCost&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;INSERT INTO INVOICE_REPORTS (<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUANTITY, <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DESCRIPTION, <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UNIT_PRICE<br />
&nbsp; &nbsp; &nbsp; ) <br />
&nbsp; &nbsp; &nbsp; VALUES (<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #006699; font-weight: bold;">$quantity</span>, <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'<span style="color: #006699; font-weight: bold;">$description</span>', <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #006699; font-weight: bold;">$price</span><br />
&nbsp; &nbsp; &nbsp; )&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #339933;">,</span> <span style="color: #000088;">$db</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<h3><span id="Examples">Examples </span></h3>
<ul>
<li><strong>Trigger 1</strong>: Gets information about the user logged in and assigns these values to the <code>@@issueOwner</code> case variable.</li>
</ul>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@=</span>aData <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>issueOwner <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>aData<span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' '</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@=</span>aData<span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'lastname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>
<ul>
<li><strong>Trigger 2</strong>: Gets the current date and time and assigns the values to the <code>@@issueDate</code> case variable.</li>
</ul>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@@</span>aDate <span style="color: #339933;">=</span> getCurrentDate<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>aTime <span style="color: #339933;">=</span> getCurrentTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>issueDate <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>aDate <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot; &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>aTime<span style="color: #339933;">;</span></div></div>
<ul>
<li><strong>Trigger 3</strong>: Runs a SQL query and assigns the values to case variables <code>@@issueDesc1</code> and <code>@@issueDesc2</code>.</li>
</ul>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@=</span>Data <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SELECT ITEM, ITEM2 FROM PMT_DESCRIPTION'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>Data<span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>Data<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>issueDesc1 <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>Data<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ITEM'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>issueDesc2 <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>Data<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ITEM2'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>

<h2><span id="Creating_Triggers">Creating Triggers</span></h2>
<p>To following options are available to create triggers in a project:</p>
<ul>
<li><a href="#Custom_Trigger">Create a Custom Trigger</a>: This option allows process designers to create custom triggers in PHP.</li>
<li><a href="#Copy/Import_Triggers_from_a_process">Copy/Import Triggers from a process</a>: This option allows process designers to copy and import a trigger from a different or the same process within the same workspace.</li>
<li><a href="#Creating_a_Trigger_with_the_Wizard">Creating a Trigger with the Wizard</a>: This option allows process designers to create a trigger using the Trigger Wizard, in which it is possible to create triggers based on the functions of ProcessMaker or any other third-party integration.</li></ul>

<h3><span id="Custom_Trigger">Custom Trigger</span></h3>
<p>To create a new custom trigger, go to the Process Objects toolbox in the Process Map and hover the mouse pointer over the "+" icon next to the <b>Triggers</b> option. Click on the option <strong>Create</strong> displayed to the right.</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_CreateTriggerOption.png" alt=""></p>
<p>A new window will open to create a new custom trigger in PHP, as shown in the following image:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_CreateCustomTriggerWindow.png" alt="" width="828" height="459"></p>
<p>Where:</p>
<ul>
<li><strong>Title:</strong> Required Field. Give the trigger a title.</li>
<li><strong>Description:</strong> Give the trigger a description.</li>
<li><strong>Code:</strong> Add the PHP code for the trigger. To make the code easier to read and to help eliminate careless errors, the code editor contains syntax highlighting, parentheses, bracket matching and line numbering.</li>
<li><strong>@@ Button:</strong> Click this button to insert either a system or case variable into the trigger code.</li>
<li><strong>Open Editor:</strong> It opens the editor in a larger window to edit triggers with longer code. After editing the code, click on <strong>Apply</strong> to save the changes or they will be lost.<dl><dd><img src="../sites/default/files/ProcessMaker3_BPMN_TriggerEditor.png" alt="" width="828" height="459"></dd></dl></li>
<li><strong>Cancel:</strong> Discards any changes in the trigger and closes the window.</li>
<li><strong>Save:</strong> Saves the changes made during the creation or editing of a trigger.</li></ul>
<h2><span id="Trigger_Management">Trigger Management</span></h2>
<p>To see the complete list of triggers created and other options for triggers, click on the <b>Triggers</b> option in the Process Objects toolbox on the Process Map:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_TriggersOption.png" alt=""></p>
<p>The window that is opened shows the list of triggers previously created in the project:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_TriggerManagementWindow.png" alt="" width="828" height="459"></p>
<p>Where:</p>
<p><strong>1. Text to search:</strong> Filters the name of the trigger to be searched.</p>
<p><strong>2. Create:</strong> Click on this option to create a new custom trigger. This option is explained in <a href="#Custom_Trigger">this section</a>.</p>
<p><strong>3. Copy:</strong> Click on this option to copy/import a trigger from a process. This option is explained in <a href="#Copy/Import_Triggers_from_a_process">this section</a>.</p>
<p><strong>4. Wizard:</strong> Click on this option to create a new trigger based on ProcessMaker functions or any other third-party integration. This option is explained in <a href="#Creating_a_Trigger_with_the_Wizard">this section</a></p>
<p><strong>5. Show ID:</strong> Click on this option to obtain the Unique ID of the trigger, which is a string of 32 hexadecimal characters that uniquely identifies the trigger.</p>
<p><strong>6. Title:</strong> Trigger title. Click on the down arrow to sort the list in descending order; sort the list in ascending order by clicking on the up arrow.</p>
<p><strong>7. Type:</strong> Shows the type of trigger created. <a href="#Creating_Triggers">Read this section</a> to see what kind of triggers can be created.</p>
<p><strong>8. Edit:</strong> Click on this option to go into the trigger editor.</p>
<p><strong>9. Delete:</strong> Click on this button to delete the trigger. A message like the following is shown:</p><dl><dd><img src="../sites/default/files/ProcessMaker3_BPMN_DeleteTriggerMessageWindow.png" alt=""></dd></dl><dl><dd>It is not possible to delete a trigger that is still assigned as a step in a task. Instead, remove the trigger as a step before deleting the trigger. If the trigger is still assigned as a step, the following warning will be displayed:</dd></dl><dl><dd><img src="../sites/default/files/ProcessMaker3_BPMN_ErrorDependenciesDeleteTrigger.png" alt=""></dd></dl>
<p><strong>10. Pagination control:</strong> Use this control to navigate through the pages, which shows 10 files per page.</p>
<p><span style="color: green;"><strong>Note: </strong></span> <span style="color: dimgrey;">It is recommended not to change the structure of the process while there are still cases running.</span></p>
<h3><span id="Copy/Import_Triggers_from_a_process">Copy/Import Triggers from a Process</span></h3>
<p>To reuse a trigger from any process within the same workspace, open the process where the trigger will be used.  In the main toolbox, click on the <strong>Triggers</strong> option. In the window that opens, click on the <strong>Copy</strong> option:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_CopyTriggerOption.png" alt="" width="831" height="183"></p>
<p>A new window will open with the settings necessary to copy a trigger from a process:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_CopyTriggerCreation.png" alt="" width="828" height="459"></p>
<p>Where:</p>
<ul>
<li><strong>Process:</strong> Required field. Select the process from which the trigger will be copied/imported.</li>
<li><strong>Trigger:</strong> Required field. Select the trigger that will be copied/imported from the process previously selected.</li>
<li><strong>Title of the new Trigger:</strong> Required field. Give the trigger a title in the current process.</li>
<li><strong>Description of the new Trigger:</strong> Give the trigger a description.</li>
<li><strong>Code:</strong> Once the trigger is imported, its code will be included in this section. Edit it only if it is necessary.</li>
<li><strong>Cancel:</strong> This option cancels the action to import the trigger.</li>
<li><strong>Copy Trigger:</strong> Click on this option to copy and import the trigger.</li></ul>
<h3><span id="Creating_a_Trigger_with_the_Wizard">Creating a Trigger with the Wizard</span></h3>
<p>The Wizard option creates a new trigger using the Trigger Wizard in ProcessMaker. This option is designed to help process designers who don't have much knowledge about the PHP syntax, but still want to be able to create triggers that call a single ProcessMaker function or other available functions. For each function, the Wizard displays a window to input each parameter and enter a variable to store the return value.</p>
<p>To create a trigger with the Trigger Wizard, open the process where the trigger will be used. In the main toolbox, click on the <strong>Triggers</strong> option. In the window that opens, click on the <strong>Wizard</strong> option:</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_TriggerWizardOption.png" alt="" width="831" height="183"></p>
<p>The window that is opened contains the services available to create triggers using the Trigger Wizard.</p>
<p><img src="../sites/default/files/ProcessMaker3_BPMN_TriggerWizardCreation.png" alt="" width="828" height="459"></p>
<p>Select the type of function that will be called by the new trigger, such as ProcessMaker Functions or Sugar CRM Functions, etc. Click on the right arrow to expand the list of triggers in a service. Then, select a specific function to use from the list.</p>

<h4><span id="ProcessMaker_Functions">ProcessMaker Functions</span></h4>
<p>ProcessMaker has <a href="../3.2/ProcessMaker_Functions.html">predefined PHP functions</a> available to be used in triggers and conditions. Follow the next steps to use <code>PMFCaseList()</code>. Similarly you can create other functions by following the parameters described in <a href="../3.2/ProcessMaker_Functions.html">ProcessMaker Functions</a>.</p>    

<ol style="font-weight:bold;">
    <li><p style="font-weight:normal;">Open the <a href="../3.2/Triggers.html#Creating_a_Trigger_with_the_Wizard">Trigger wizard</a>. The screen displays all the Trigger groups.</p></li>

    <li><p style="font-weight:normal;">Click the down arrow next to <strong>ProcessMaker functions</strong>. The ProcessMaker functions display.</p>
    <p><img src="../sites/default/files/3.7.0TriggerWizard-PMFunctions.png" alt=""></p></li>

    <li><p style="font-weight:normal;">Click the ProcessMaker function. In this case, select <strong>PMF Case List</strong>, which returns a list of the pending cases (i.e., cases that have a status of "To Do" or "Draft") belonging to a specified user. Follow <a href="../3.3/ProcessMaker_Functions/Case_Functions.html#PMFCaseList.28.29">PMFCaseList()</a> to review the required parameters for this case function. The <strong>Create ProcessMaker Functions</strong> display.</p>
    <p><img src="../sites/default/files/ProcessMaker3_BPMN_PMFunctionsCreationWindow.png" alt="" width="828" height="459"></p></li>

    <li><p style="font-weight:normal;">The <strong>Type</strong> field indicates the type of function created. Possible types: Custom, ProcessMaker Functions, Sugar CRM Triggers, Talend ETL Integration, Alfresco DM Triggers v. 0.1, Sharepoint DWS Triggers v. 0.1 and Zimbra Triggers v. 0.1.</p></li>

    <li><p style="font-weight:normal;">In the <strong>Title</strong> field, enter the trigger title. Be more descriptive to easily work later. It is a required field.</p></li>

    <li><p style="font-weight:normal;">In the <strong>Description</strong> field, enter a brief description about the trigger.</p></li>

    <li><p style="font-weight:normal;">In the <strong>Parameters</strong> section, enter the parameters for the specific function that will be called. For each parameter enter a value. In this case enter a value for the <strong>User ID</strong>. Parameter can be:</p>
        <ul style="font-weight:normal;">
            <li>A case variable or a system variable.</li>
            <li>A literal value, such as an integer number like <code>644</code>, a floating number like <code>-2999.85</code>, a string like <code>Finance Department</code>, or a ProcessMaker unique ID like <code>"447CEAF7BE6AEB747CEB6EB5526B"</code>. If the parameter type is a string, ProcessMaker automatically encloses it in double quotation marks if it does not start with . If the string contains a double quotation mark ("), escape it with a backslash. For example: <code>"Say \"hello\""</code>. If the parameter type is an integer or floating number, ProcessMaker automatically converts it to a number if it does not start with <code>@</code>. So, a string value such as <code>"client1"</code> gets converted to <code>0</code>.</li>
        </ul>
    </li>

    <li><p style="font-weight:normal;">In the parameters field, hover the <strong>Help</strong> icon to see the parameter instructions.</p>
    <p><img src="../sites/default/files/ProcessMaker3_BPMN_TriggersCreatePMFunctionsParametersHelpIcon.png" alt=""></p></li>

    <li><p style="font-weight:normal;">In the parameters field, click the <code>@@</code> button to insert either system or case variables.</p></li>

    <li><p style="font-weight:normal;">In the <strong>Return Value</strong> section, in the <strong>Variable to hold the return value</strong>, enter the return value. It is recommended enter a case variable, such as <code>@@ReturnVal</code>, so that this value can later be examined in the Process Debugger if errors occur. It does not matter what type cast is used in the case variable because ProcessMaker ignores the type cast when assigning values to case variables. Then, <code>@%return</code> is the same as <code>@@return</code>.</p></li>
    
    <li><p style="font-weight:normal;">In the <strong>Return Value</strong> section, hover the <strong>Help</strong> icon to see instructions of the return value.</p></li>
    
    <li><p style="font-weight:normal;">Click <strong>Cancel</strong> to discard any changes and cancel the creation of the new trigger by closing the current modal window.</p></li>
    
    <li><p style="font-weight:normal;">Click <strong>Save</strong> to save the configuration. When the trigger is created, the page redirects to the main list of triggers and a flash message displays indicating that the trigger has been saved.</p></li>
</ol>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">ProcessMaker Trigger Wizard does not validate email fields. It is recommended to validate an email variable in the trigger code or use the <a href="../3.2/ProcessMaker_Functions.html">ProcessMaker Functions</a>, which validate emails by default.</font></p>

<h2><span id="Inserting_a_trigger_in_a_process">Inserting a Trigger in a Process</span></h2>

<p>After creating a trigger, it can be inserted at various points in a process. Log in to ProcessMaker with a user such as "admin" who has the <a href="../3.1/Roles.html#PM_FACTORY" title="Roles">PM_FACTORY</a> permission in his/her <a href="../3.1/Roles.html" title="Roles">role</a>. Then, open a process for editing.</p>

<ul>
<li>In the process map, <em>right click</em> on the task where the trigger will be fired and select the <strong>Steps</strong> option from the menu:
<p><img src="../sites/default/files/ProcessMaker3_Triggers_SelectStepPropertiesFromMenu.png" alt="SelectStepPropertiesFromMenu.png"></p>
</li>

<li>To select the runtime for a given trigger, go to the Triggers section inside the Available Elements panel and grab the trigger that will be assigned and drag it to where it will be run. Notice that when expanding each step, there are two sections: "Before (Dynaform, Input Document, Output Document)" and "After (Dynaform, Input Document, Output Document)". In the Assignment section, steps can be placed only "Before Assignment" and in the section "Routing"; triggers can be assigned "Before Routing" or "After Routing".

<p><img src="../sites/default/files/ProcessMaker3.6.x_Triggers_BasedOnConditionsSelectTrigger.png"></p>
<p>A flash message is shown at the top of the panel indicating that the step was assigned correctly.</p>
</li>

<li>Drop the element into the gray space enabled and the step will be added:

<p><img src="../sites/default/files/ProcessMaker3_Triggers_TaskStepAssigningTriggerOptions.png"></p>
</li>
</ul>

<h3><span id="Firing_Triggers_Based_on_Conditions">Firing Triggers Based on Conditions</span></h3>
<p>To set the trigger to fire only in certain situations, enter a <a href="../3.0/Using_Conditions.html" title="Using Conditions">condition</a> that must evaluate to true for the trigger to be fired.
 Use the <strong>@@</strong> button to insert system and case variables in the condition. If the trigger does not have a condition, it will always be run.</p>

<p>To add a condition to a trigger, go to the Triggers section inside the Assigned Elements panel and click the <b>Condition</b> button:</p>

<p><img src="../sites/default/files/ProcessMaker3_Triggers_BasedOnConditionsSelectTrigger.png" alt="AssignTriggerToStep.png"></p>

<p>The window that is displayed has the <strong>@@</strong> button, which allows adding existing variables. Enter the condition in the Condition field and save the settings by clicking on the <strong>Save</strong> button:</p>

<p><img src="../sites/default/files/ProcessMaker3_Triggers_ConditionTriggerWindow.png"></p>

<p>The "*" mark will appear in the <strong>Condition</strong> button of the trigger to indicate that its running is based on a condition. This visual clue reminds process designers which triggers have defined conditions, which is helpful when trying to figure out why a trigger did not fire:</p>

<p><img src="../sites/default/files/ProcessMaker3_Triggers_ConditionTrigger_mark.png" alt="GreenTickConditionsTriggerV2 8.png"></p>


<h2><span id="Debugging_Triggers">Debugging Triggers </span></h2>

<p>When running cases, it is possible to see when triggers are running and the value of system and case variables by turning on the ProcessMaker Debugger.</p>

<h3><span id="Enabling_Debug_Mode">Enabling Debug Mode</span></h3>

<p>There are two ways to enable Debug Mode. When its enabled, the ProcessMaker Debugger will be displayed in a left sidebar while running cases of a particular process.</p>
<p>Log in to ProcessMaker with a user such as "admin" who has the <a href="../3.1/Roles.html#PM_FACTORY" title="Roles">PM_FACTORY</a> permission in his/her <a href="../3.1/Roles.html" title="Roles">role</a>. Then, go to the <strong>Designer</strong> menu. <em>Right click</em> on a process in the list and select the <strong>Enable Debug Mode</strong> option from the dropdown menu.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_EnableDebugModeInProcessList.png" alt="EnableDebugModeInProcessList.png"></p>
<p>Debug Mode can also be enabled while editing a process. <em>Right click</em> on a blank area in the Process Map and select the option <strong>Edit Process</strong> from the menu.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_SelectPropertiesFromProcessMapMenu.png" alt="SelectPropertiesFromProcessMapMenu.png"></p>
<p>In the Edit Process dialog box, mark the <strong>Debug</strong> checkbox:</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_MarkDebugCheckboxInProcessProperties.png" alt="MarkDebugCheckboxInProcessProperties.png" width="865" height="481"></p>


<h3><span id="Using_the_ProcessMaker_Debugger">Using the ProcessMaker Debugger</span></h3>
<p>To use the ProcessMaker Debugger, run a case within a process that has the Debug Mode enabled. The ProcessMaker Debugger displays as a left-hand sidebar, listing the system and case variables and the code of the triggers that have just been run.</p>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">As of <strong>ProcessMaker 3.6.0</strong>, the <strong>ProcessMaker Debugger</strong> menu can not be collapsed.</font></p>

<h4><span id="Variables_Tab">Variables Tab</span></h4>

<p>The Variables tab shows the values of the system variables and the case variables in the case currently open. To see the content of long strings and arrays, click on a variable to see its value displayed in the box below.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_DebuggerVariablesTab.png" alt="DebuggerVariablesTab.png" width="865" height="449"></p>
<p>The list of variables can be filtered by clicking on the buttons at the top:</p>
<ul>
<li><strong>All</strong>: Displays all system and case variables in the current case.</li>
<li><strong>DynaForm</strong>: Displays the Dynaform variables in the current case.
</li>
<img src="../sites/default/files/3.2.2DebuggerDynaformVariables.png">
<li><strong>System</strong>: Displays the system variables.
</li>
<img src="../sites/default/files/3.2.2DebuggerSystemVariables.png">
</ul>

<h4><span id="Triggers_tab">Triggers Tab</span></h4>
<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray"> Take into account the <b>Triggers Tab</b> is not available in ProcessMaker 3.6.x. As a result, follow these steps to work in the Triggers Tab only for ProcessMaker versions 3.2.x to 3.5.x.</font></p>

<p>The <strong>Triggers</strong> tab shows which triggers have just been run and whether they were run before or after the last step or routing. To see a particular trigger's code, click on the trigger and its code will be displayed in the box below.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_DebuggerTriggersTab.png" alt="DebuggerTriggersTab.png"></p>

<p>To see a trigger's code in a separate window, click on <strong>Open in a New Window</strong>.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_DebuggerTriggerCodeWindow.png" alt="DebuggerTriggerCodeWindow.png" width="865" height="549"></p>

<p>It is also possible to see the trigger's code in a column by clicking on the little arrow in the right corner of a column to display the menu. Then, go to <b>Columns</b> and click the checkbox next to "Code".</p>

<p><img src="../sites/default/files/3.1TriggersPMDebuggerCode.png"></p>

<p>To find possible problems in triggers (ex. slow queries), it is useful to review the running time of a trigger. To do this, click the checkbox next to the "Execution Time (Milliseconds)" option.</p>

<p><img src="../sites/default/files/3.1TriggersPMDebuggerExecutiontime.png"></p>

<p>A column listing the running times will be added to the debugger. </p>

<p><img src="../sites/default/files/3.1TriggersPMDebuggerExecutiontimeChecked.png"></p>

<p>After each step, the debugger will pause the case so the variables and triggers can be examined in the debugger.  To continue running the case, click on the <strong>Continue</strong> button.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_DebuggerContinueButton.png" alt="DebuggerContinueButton.png"></p>

<p>The debugger will also pause after the task has been routed, so the results of the triggers from before assignment, before routing and after routing can be examined.</p>

<h3><span id="Viewing_Error_Messages">Viewing Error Messages</span></h3>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray"> The following steps apply only for ProcessMaker versions 3.2.x to 3.5.x</font></p>

<p>If a fatal PHP error occurs in the trigger code when running a case, a message will be displayed in red saying "Fatal error in trigger" and the error message will be placed in the <code>@@__ERROR__</code> system variable. 
To see the error message, either turn on the debugger or examine the error in the <b><tt>wf_<font color=blue><i>WORKSPACE</i></font>.APPLICATION.APP_DATA</tt></b> field in the database.</p>
<p><img src="../sites/default/files/FatalErrorInTriggerCode.png"></p>
<p>If PHP is configured to stop on errors, then the case will stop and a PHP error message will be displayed in the right panel:</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_TriggersPHPFatalError.png" alt="" width="865" height="117"></p>
<p>If a PHP warning or non-fatal error (such as a syntax error) occurs while running a trigger, the running of the trigger will stop and a message will be displayed at the top of the right panel. Nonetheless, the running of the case will continue so the user can work on the next step in the task. These are the only types of error messages whose line numbers correspond to the line numbers of the trigger code.</p>
<p><img src="../sites/default/files/ProcessMaker3_Triggers_TriggersPHPSyntaxError.png" alt="" width="865" height="113"></p>
<p>While all of the types of errors previously mentioned are immediately obvious to the user running the case, ProcessMaker exceptions will not be displayed to the user when running a case. When a ProcessMaker exception occurs, the system variable <code>@@__ERROR__</code> is created to store its error message.</p>

<!--<p>The easiest way to detect ProcessMaker exceptions is to check if the <code>@@__ERROR__</code> variable has been defined. Add trigger code that displays the contents of the <code>@@__ERROR__</code> to the user when running cases. For example, the following code checks if a ProcessMaker exception has occurred. If so, it stops the case with the die() function and displays the contents of the error message to the user:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@</span>__ERRROR__<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
<span style="color: #009900;">&#125;</span></div></div>

h3<span id="Examining_Normal_PHP_Variables">Examining Variables</span>

<p>It is often difficult to figure out what the problem is with trigger code, because the values of variables can't be seen when running a case except if they are displayed in Dynaform fields. If debugging code, it is recommended to add code to view the values of the variables.</p>

<p>For example, the G::SendTextMessage() function can be used to display the contents of a variable at the top of the screen, without stopping the case. Then, the user can assign the result to a case variable so it can be seen in the Debugger, without stopping the case to figure out why the database query is failing, :</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@@</span>result <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p>To see even more detailed information about a variable, the contents of variables can be displayed with <a href="http://php.net/manual/en/function.var-dump.php">var_dump()</a> wrapped in <code>&lt;pre&gt;</code> tags:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">print</span> <span style="color: #0000ff;">&quot;&lt;pre&gt;&quot;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/var_dump"><span style="color: #990000;">var_dump</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">print</span> <span style="color: #0000ff;">&quot;&lt;/pre&gt;&quot;</span><span style="color: #339933;">;</span></div></div>


<p>To force trigger execution to stop at a certain point to display the variables call <a href="http://www.php.net/manual/en/function.die.php">die()</a>. Be aware, however, that <code>die()</code> will stop the execution of the case from continuing onto the next step and will stop the Dynaform's data from being saved if called after a Dynaform step.</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">print</span> <span style="color: #0000ff;">&quot;&lt;pre&gt;&quot;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/var_dump"><span style="color: #990000;">var_dump</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;/pre&gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

h2<span id="Error_Management">Error Management</span>
h3<span id="Error_Management_for_Processes_in_Production">Error Management for Processes in Production</span>

<p>Activating the ProcessMaker Debugger is a good way to detect errors when designing processes, however, it is not recommended when running cases in production. Not only is the debugger distracting for normal users, it also creates a potential security hole if users can see data entered by other users in the case.</p>

<p>Most of the time, bugs will be detected when designing the process, but some types of bugs are caused by unexpected user input or unanticipated circumstances, such as a condition that contains a variable that didn't get defined because a step was skipped. The most common source of these errors is unexpected user input, which causes problems when querying the database in a dependent field or when a trigger calls <a href="/3.1/ProcessMaker_Functions#executeQuery.28.29">executeQuery()</a>.</p> 

To detect errors when a process is in production, it is recommended to add triggers that check for the existence of the <code>@@__ERROR__</code> variable to display its message to users. Use the <a  href="http://php.net/manual/en/function.isset.php" >isset()</a> function to detect whether the <code>@@__ERROR__</code> variable exists and to display the message to the user with <code>die()</code> or the <a href="/3.0/Internal_Functions_and_Classes#G::SendMessageText.28.29" title="Internal Functions and Classes">G::SendMessageText()</a> method. Then, remove the <code>@@__ERROR__</code> variable with the <a  href="http://php.net/manual/en/function.unset.php" >unset()</a> function, so it can be set again when the next ProcessMaker exception occurs. </p>

<p>For example:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; &nbsp;<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #339933;">,</span> <span style="color: #0000ff;">'ERROR'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<a href="http://php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>The <code>@@__ERROR__</code> variable will be stored as a case variable, so it will stay in the case if it isn't unset. Since it is stored, it can be checked several tasks later or at the end of a case.</p>

<p>It might also be a good idea to email the exception's message to an administrator, so he/she knows that something is going wrong with the process.</p>
<p>For example, if using the following email template named "errorForm.html":</p>
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">Date: @#date<br />
Time: @#time<br />
Case: @#APPLICATION<br />
Username: @#USR_USERNAME<br />
Process ID: @#PROCESS<br />
Task ID: @#TASK<br />
Error Message: @#errorMessage </div></div>
<p>Then, the following trigger will email this form to the system administrator with the <a href="/3.1/ProcessMaker_Functions#PMFSendMessage.28.29" title="ProcessMaker Functions">PMFSendMessage()</a> function when an exception occurs:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$vars</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'date'</span> <span style="color: #339933;">=&gt;</span> getCurrentDate<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'time'</span> <span style="color: #339933;">=&gt;</span> getCurrentTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'errorMessage'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;PMFSendMessage<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #0000ff;">'admin@example.com'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'admin@example.com'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'ProcessMaker exception occurred'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'errorForm.html'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$vars</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<a href="http://php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>Alternatively, the error messages can be appended to a log file at <strong><tt>shared/log/exceptions_log.txt</tt></strong> with the <a href="http://php.net/manual/en/function.file-put-contents.php">file_put_contents()</a> function:</p><div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$logFilePath</span> <span style="color: #339933;">=</span> PATH_DATA <span style="color: #339933;">.</span> <span style="color: #0000ff;">'log'</span> <span style="color: #339933;">.</span> PATH_SEP <span style="color: #339933;">.</span> <span style="color: #0000ff;">'exceptions_log.txt'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$content</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Datetime: &quot;</span> <span style="color: #339933;">.</span> getCurrentDate<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' '</span> <span style="color: #339933;">.</span> getCurrentTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Case: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>APPLICATION <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Username: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>USR_USERNAME <span style="color: #339933;">.</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Process: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>PROCESS <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Task: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>TASK <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Error: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>__ERROR__ <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<a href="http://php.net/file_put_contents"><span style="color: #990000;">file_put_contents</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$logFilePath</span><span style="color: #339933;">,</span> <span style="color: #000088;">$content</span><span style="color: #339933;">,</span> FILE_APPEND<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp;<a href="http://php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #339933;">&lt;/</span>pre<br />
<br />
h3<span style="color: #339933;">&lt;</span>span id<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;Exiting_from_the_Middle_of_Trigger_Code&quot;</span><span style="color: #339933;">&gt;</span>Exiting from the Middle of Trigger Code<span style="color: #339933;">&lt;/</span>span<span style="color: #339933;">&gt;</span><br />
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;</span>ProcessMaker does not provide a good way to <a href="http://php.net/exit"><span style="color: #990000;">exit</span></a> a trigger besides coming to the <a href="http://php.net/end"><span style="color: #990000;">end</span></a> of the code<span style="color: #339933;">.</span> The only way to <a href="http://php.net/exit"><span style="color: #990000;">exit</span></a> the middle of a trigger is to cause an exception or call the <span style="color: #339933;">&lt;</span>a href<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;http://www.php.net/manual/en/function.die.php&quot;</span><span style="color: #339933;">&gt;</span><a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span> <span style="color: #000000; font-weight: bold;">function</span><span style="color: #339933;">,</span> which would stop the execution of the trigger and prevent the execution of the <a href="http://php.net/next"><span style="color: #990000;">next</span></a> step in the process<span style="color: #339933;">.&lt;/</span>p<span style="color: #339933;">&gt;</span><br />
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;</span>To write reliable code<span style="color: #339933;">,</span> it is a good idea to check <span style="color: #b1b100;">for</span> unexpected errors and provide a way to <a href="http://php.net/exit"><span style="color: #990000;">exit</span></a> the trigger<span style="color: #339933;">.</span> Generally this involves writing long <span style="color: #339933;">&lt;</span>code<span style="color: #339933;">&gt;</span>if<span style="color: #339933;">&lt;/</span>code<span style="color: #339933;">&gt;</span> then <span style="color: #339933;">&lt;</span>code<span style="color: #339933;">&gt;</span>else<span style="color: #339933;">&lt;/</span>code<span style="color: #339933;">&gt;</span> blocks<span style="color: #339933;">,</span> which quickly become unwieldy <span style="color: #b1b100;">if</span> there are very many of them<span style="color: #339933;">.&lt;/</span>p<span style="color: #339933;">&gt;</span><br />
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;</span><span style="color: #b1b100;">For</span> example<span style="color: #339933;">,</span> a trigger that contains three database queries becomes quite difficult to manage<span style="color: #339933;">:&lt;/</span>p<span style="color: #339933;">&gt;</span><br />
<span style="color: #339933;">&lt;</span>pre lang<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;php&quot;</span><span style="color: #339933;">&gt;</span><br />
<span style="color: #000088;">$result1</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result1</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result1</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//some code for query1 </span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #000088;">$result2</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result2</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result2</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//some code for query2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result3</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result3</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result3</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//some code for query 3 &nbsp;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in query3&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #0000ff;">&quot;Error in query2&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in query1&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>Breaking up the code into functions doesn't help, because calling a function will only temporarily leave the middle of the code. EEventually, the function has to return to the code and there is still no easy way to exit. The best way to handle these situations is to use the <a href="http://php.net/manual/en/control-structures.goto.php">goto</a> statement. It is ugly, but it works.</p>
<p>For example:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$result1</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result1</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result1</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$msg</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Error ...&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;goto errorMsg<span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #666666; font-style: italic;">//some code here</span><br />
<span style="color: #000088;">$result2</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result2</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result2</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$msg</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Error ...&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;goto errorMsg<span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #666666; font-style: italic;">//some more code here</span><br />
<span style="color: #000088;">$result3</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT ...&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result3</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result3</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$msg</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Error ...&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;goto errorMsg<span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #666666; font-style: italic;">//some more code here</span><br />
goto endScript<span style="color: #339933;">:</span><br />
&nbsp;<br />
errorMsg<span style="color: #339933;">:</span><br />
&nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$msg</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp;<br />
endScript<span style="color: #339933;">:</span></div></div>

h2<span id="Variable_Storage">Variable Storage</span>
<p>Case and system variables for each case are stored in the <b><tt>wf_&lt;WORKSPACE&gt;.APPLICATION.APP_DATA</tt></b> field in the <a href="/3.1/ProcessMaker_Database_Model" title="ProcessMaker Database Model">database</a>, which is a MySQL mediumtext field that can hold up to 16MB (2<sup>24</sup> bytes) of data.</p>
<p>The variables are stored in the <strong><tt>APP_DATA</tt></strong> field as an associative array that has been converted to a string by PHP's <a href="http://php.net/manual/en/function.serialize.php">serialize()</a> function. It has the following format:</p>
<codeblock>a:<font color=blue><i>NUMBER-OF-VARIABLES</i></font>:{
<font color=blue><i>NAME-TYPE1</i></font>:<font color=blue><i>NUMBER-CHARS-IN-NAME1</i></font>:<font color=blue><i>VARIABLE-NAME1</i></font>;<font color=blue><i>VALUE-TYPE1</i></font>:<font color=blue><i>NUMBER-CHARS-IN-VALUE1</i></font>:<font color=blue><i>VARIABLE-NAME1</i></font>;
<font color=blue><i>NAME-TYPE2</i></font>:<font color=blue><i>NUMBER-CHARS-IN-NAME2</i></font>:<font color=blue><i>VARIABLE-NAME2</i></font>;<font color=blue><i>VALUE-TYPE2</i></font>:<font color=blue><i>NUMBER-CHARS-IN-VALUE2</i></font>:<font color=blue><i>VARIABLE-NAME2</i></font>; 
...}</codeblock>
<p>The <code><font color=blue><i>NAME-TYPE</i></font></code> and <code><font color=blue><i>VARIABLE-TYPE</i></font></code> are almost always listed as type "s", which stands for <em>string</em>. For example:</p>
<codeblock>a:4:{s:7:"repDate";s:10:"2015-10-29";s:7:"repTime";s:8:"10:56:00"; "repUserName";s:9:"Amy Wyron";s:12:"repUserEmail";s:14:"amy@processmaker.com";}</codeblock>
<p>If a Dynaform has a <a href="/3.0/File_control">file</a> field, the actual file is stored separately and only the filename (without its path) is stored as a case variable.</p>
<p>The data in the <b><tt>APPLICATION.APP_DATA</tt></b> field is also stored as an associative array within the superglobal <code>$_SESSION</code> variable. In addition to the usual way of accessing case and system variables as <code>@@<font color=blue><i>variable</i></font></code>, they can also be accessed as <code>$_SESSION["APP_DATA"]["<font color=blue><i>variable</i></font>"]</code> in the current case.</p>
<p>To get the system and case variables of any case, the <strong><tt>APPLICATION.APP_DATA</tt></strong> field can be unserialized into an associative array of variable name and variable value pairs. For example, the following script looks up the current case's variables and outputs them into a string that can be displayed in a Dynaform field named "MyTextArea":</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$caseNo</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'46'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//lookup the case number for the case in the Case list </span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT APP_DATA FROM APPLICATION WHERE APP_NUMBER='<span style="color: #006699; font-weight: bold;">$caseNo</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$sVars</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aVars</span> <span style="color: #339933;">=</span> <a href="http://php.net/unserialize"><span style="color: #990000;">unserialize</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sVars</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>MyTextArea <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aVars</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$varName</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$varValue</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #339933;">@@</span>MyTextArea <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$varName</span>: <span style="color: #006699; font-weight: bold;">$varValue</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>The following script does the same thing, using ProcessMaker's <a href="/index.php/Gulliver%3A_Programmer%2527s_Reference_Guide" title="Gulliver: Programmer's Reference Guide">Gulliver framework</a> classes:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$CaseNo</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'46'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//lookup the case number for the case in the Case list</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT APP_UID FROM APPLICATION WHERE APP_NUMBER='<span style="color: #006699; font-weight: bold;">$caseNo</span>' &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$caseUID</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp;<br />
G<span style="color: #339933;">::</span><span style="color: #004000;">LoadClass</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'case'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$oCase</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//Create Cases object</span><br />
<span style="color: #000088;">$aCase</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$oCase</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseUID</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//Load a particular case</span><br />
<span style="color: #000088;">$aVariables</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//Get the variables for that case </span><br />
<span style="color: #339933;">@@</span>MyTextArea <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span><br />
&nbsp;<br />
<span style="color: #666666; font-style: italic;">//Loop through the associative array, examining each variable</span><br />
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aVariables</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$varName</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$varValue</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>MyTextArea <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$varName</span>: <span style="color: #006699; font-weight: bold;">$varValue</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>If working with large values in triggers, it is recommended to use normal PHP variables rather than case variables due to their limited storage space. If continuous storage is needed, create a separate database to store the large values and manage the database with <a href="/3.1/ProcessMaker_Functions#executeQuery.28.29" title="ProcessMaker Functions">executeQuery()</a>. Remember to <a href="http://www.php.net/serialize">serialize</a> the variable before saving it to the database, especially if it isn't a string. The PHP language doesn't provide a reliable way to check the memory usage of a variable, but <code>strlen(serialize(@=<font color=blue><i>variable</i></font>))</code> can also provide a rough idea of the memory size of a variable in bytes.To avoid exceeding the available memory limit of 16MB, see <a href="http://forum.processmaker.com/viewtopic.php?f=7&t=1300&p=3930&hilit=16MB#p3930">this example</a> about how to check the memory usage of the <b><tt>APPLICATION.APP_DATA</tt></b> field.
</p>

h2<span id="Browser_Redirection">Browser Redirection</span>
<p>Triggers can be used to redirect the web browser to a new page by calling the <a href="http://php.net/manual/en/function.header.php">header()</a> function. Set its parameter to "location:" concatenated with the URL where the web browser should be redirected. For example:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;location: http://www.google.com&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>To stop any normal processing after the trigger from occurring, it is a good idea to call the <a href="http://php.net/manual/en/function.die.php">die()</a> function after redirection to immediately kill the trigger.</p>
<p>If redirecting to an address inside ProcessMaker, it not necessary to include the full address. Version 2.0 and later uses <a href="/3.0/JavaScript_in_DynaForms#Frames">multiple frames to display the ProcessMaker interface</a> and cases are run within a child frame. To redirect to the case list inside the parent frame use:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;location: casesListExtJsRedirector&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p>The <code>header()</code> function only redirects to a new address in the current frame. To redirect the web browser to the top-most frame, trigger code can write JavaScript code inside <span class="geshifilter"><code class="text geshifilter-text">&lt;script&gt;...&lt;/script&gt;</code></span> tags 
that redirects to the top-most frame. For example, the following trigger redirects the web browser to the <b>Home</b> menu, which displays the Inbox:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;script&gt; top.location='../cases/main'; &lt;/script&gt;&quot;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>For more information about ProcessMaker URLs, see <a href="/3.0/Internal_Functions_and_Classes#G::header.28.29" title="Internal Functions and Classes">G::header()</a>.

h3<span id="Redirecting_to_a_case">Redirecting to a Case</span>
<p>When a trigger is executed inside a case, redirection will occur within the <a href="/3.0/JavaScript_in_DynaForms#Frames">"casesSubFrame" iframe</a>, which is the iframe where cases are opened. The <a href="http://php.net/manual/en/function.header.php">header("Location: ...")</a> function can be used to open a different case. For example:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Location: cases_Open?APP_UID=7921628035723c3458afbd5092219945&amp;DEL_INDEX=1&amp;action=draft&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>Remember that a case can only be opened if the user logged in is assigned to the current task in the case, has process permissions to open the case (in read-only format), or is a Process Supervisor with the rights to open an object in the task specified by the delegation index number. If a user doesn't have the rights to open a case, the web browser will redirected back to the case list.</p>

<p>The case will open in the task specified by the case's unique ID (<code>APP_UID</code>) and the delegation index number (<code>DEL_INDEX</code>). The <code>DEL_INDEX</code> is <code>1</code> for the first task in a case, <code>2</code> for the second task, etc.

<p>The case will open the <i>first</i> step (DynaForm, Input Document, Output Document or External Step) in the specified task. To open a case and go to the second or a subsequent step at the same time, see <a href="#Redirecting_to_a_task_and_step">Redirecting to a specified task</a> below.</p>

h3<span id="Redirecting_to_a_step">Redirecting to a Step</span>

<p>Once a case is opened in a specified task, then it is possible to redirect to a specified step (DynaForm, Input Document, Output Document or External Step) within that task. For example, the following trigger redirects to the third step in the current task, which is a DynaForm:</p> 
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Location: cases_Step?TYPE=DYNAFORM&amp;UID=8818168195723e0919faaf5044471877&amp;POSITION=3&amp;ACTION=EDIT&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

h3<span id="Redirecting_to_a_task_and_step">Redirecting to a Specified Task and Step</span>

<p>ProcessMaker does not provide a way to open a case at a specified task and go to a specified step within that task at the same time. However, it is possible to use JavaScript to work around this problem if the first step in the task is a DynaForm.</p>
<p>In the Dynaform that is the first step in the task, add a hidden field whose name, ID and variable is "redirectUrl". Then, add JavaScript to the same Dynaform that uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/location">Window.location</a> to redirect to the address in the "redirectUrl" field:</p>
<div class="geshifilter"><div class="javascript geshifilter-javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">var</span> url <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;#redirectUrl&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">getValue</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>url <span style="color: #339933;">!=</span> <span style="color: #3366CC;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;location.<span style="color: #660066;">href</span> <span style="color: #339933;">=</span> url<span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>

<p>Then, create a trigger that calls <a href="/3.1/ProcessMaker_Functions#PMFSendVariables.28.29">PMFSendVariables()</a> to set the "redirectUrl" variable in the case and then calls  <a href="http://php.net/manual/en/function.header.php" >header("Location: ...")</a> to redirect to the case:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//variables set dynamically from database searches in the APP_CACHE_VIEW table or </span><br />
<span style="color: #666666; font-style: italic;">//from case variables set by the user in a previous DynaForm:</span><br />
<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'4101368135723d3a0e12e75054391524'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$url</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'cases_Step?TYPE=DYNAFORM&amp;UID=8818168195723e0919faaf5044471877&amp;POSITION=3&amp;ACTION=EDIT'</span><span style="color: #339933;">;</span><br />
<br />
PMFSendVariables<span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'redirectUrl'</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$url</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Location: cases_Open?APP_UID=<span style="color: #006699; font-weight: bold;">$caseId</span>&amp;DEL_INDEX=<span style="color: #006699; font-weight: bold;">$index</span>&amp;action=draft&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>-->

<h2><span id="When_action_cases">Triggers when Committing an Action in Cases</span></h2>
<p>A trigger can be executed when creating, deleting, canceling, pausing, unpausing, reassigning or opening cases. To set a trigger to fire at one of these points, open a process for editing and <i>right click</i> on a blank area of the process map and select <b>Edit Process</b> from the context menu.</p>

<p><img src="../sites/default/files/3.2TriggersEditProcess.png"></p>

<p>In the Edit Process dialog box that opens, select a trigger in the following dropdown boxes:</p>

<img src="../sites/default/files/3.2EditProcessSelectTrigger.png">

<p>When the user creates, deletes, cancels, pauses, unpauses, reassigns or opens a case, the selected trigger will be run. The exact point when the trigger is run depends on the action:</p>
<p>
<ul>
<li>When <b><i>creating</i></b> a case, the trigger is run <i>after</i> a new case is created, so it is possible to access the case's variables in the trigger. It is possible to display a message above the case when it opens by calling <a href="../3.0/Internal_Functions_and_Classes.html#G::SendMessageText.28.29">G::SendMessageText()</a>.
</li>

<li>When <b><i>deleting</i></b> or <b><i>canceling</i></b> a case, the trigger is run <i>before</i> the action takes place, so it is possible to stop the action by calling <a href="http://php.net/manual/en/function.die.php">die()</a> in the trigger. Note that <i>deleting</i> a case is only possible when in the the first task, meaning that the case is removed from the database. In subsequent tasks, it is only possible to <i>cancel</i> a case, meaning that the case remains in the database, but its status is changed to "CANCELLED" so it can no longer be opened and worked on.</li>

<li>When <b><i>pausing</i></b> a case, the trigger runs <i>after</i> the action takes place, so it is <i>not</i> possible to stop the action by calling <a href="http://php.net/manual/en/function.die.php">die()</a>. However, it is possible to undo the pausing of a case by calling <a href="../3.0/Internal_Functions_and_Classes.html#Cases::unpauseCase.28.29">Cases::unpauseCase()</a> in the trigger. </li>

<li>
    When <b><i>reassigning</i></b> a case, is <i>not</i> possible to stop the action using <a href="http://php.net/manual/en/function.die.php">die()</a>, because similarly as when pausing a case, the trigger runs <i>after</i> the action takes place. Even so, it is possible to undo the reassignment of a case by calling <a href="../3.0/Internal_Functions_and_Classes.html#Cases::reassignCase.28.29">Cases::reassignCases()</a> in the trigger and reassigning it back to the original user.
    <p>For <b>ProcessMaker 3.2.x</b>, after reassignment, data is changed and triggers run in the following sequence:</p>
    <ol>
        <li>Fillment of <strong><code>APP_&lt;TABLE-NAME&gt;</code></strong> tables.</li>
        <li>Fillment of <strong><code>LIST_&lt;TABLE-NAME&gt;</code></strong> tables.</li>
        <li>Trigger running.</li>
    </ol>

    <p>As of <b>ProcessMaker 3.3.0</b>, data changes and triggers running sequence goes the following way:</p>
    <ol>
        <li>Fillment of <strong><code>APP_&lt;TABLE-NAME&gt;</code></strong> tables.</li>
        <li>Trigger running.</li>
        <li>Fillment of <strong><code>LIST_&lt;TABLE-NAME&gt;</code></strong> tables.</li>
    </ol>
</li>

<li>When <b><i>opening</i></b> a case, the trigger is run <i>after</i> an existing case is loaded, so it is possible to access the case's variables in the trigger. However, the trigger is run <i>before</i> the case is displayed to the user, so it is possible to prevent the user from seeing the case by calling <a href="http://php.net/manual/en/function.die.php">die()</a> in the trigger. It is also possible to display a message above the case when it opens by calling <a href="../3.0/Internal_Functions_and_Classes.html#G::SendMessageText.28.29">G::SendMessageText()</a>.</li>
</ul>
</p>
<p>When the trigger is run, the @@APPLICATION system variable will be set to the unique ID of the case that is being deleted/canceled/paused/reassigned/opened, so it is possible to use <a href="../3.1/ProcessMaker_Functions.html#executeQuery.28.29">executeQuery()</a> to look up information about that case in the database in tables such as <tt>APPLICATION</tt>, <tt>APP_CACHE_VIEW</tt>, <tt>APP_DELEGATION</tt>, <tt>APP_DOCUMENT</tt>, etc.</p> 

<!--h3<span id="when_creating_case">Example When Creating a Case</span>
<p>When a new case is created, the records for the new case have already been written in the database in the <tt>APPLICATION</tt>, <tt>APP_DELEGATION</tt> and <tt>APP_CACHE_VIEW</tt> tables, so database queries with <a href="/3.1/ProcessMaker_Functions#executeQuery.28.29">executeQuery()</a> or the <a href="/3.0/Internal_Functions_and_Classes#Cases::loadCase.28.29">Cases::LoadCase()</a> method may be used to discover more information about the new case. The trigger code may reference all the system variables except <code>@@TASK</code> and <code>@@INDEX</code>, which haven't yet been defined. The delegation index will always be <code>1</code> at this point and the unique ID of the initial task in the case can be found with the following trigger code:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>taskId <span style="color: #339933;">=</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAS_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>
<p>This example demostrates how to send a notification to the manager of the user who starts a new case. It uses <code>Cases::LoadCase()</code> to look up additional information about the new case and <a href="/3.1/ProcessMaker_Functions#PMFInformationUser.28.29">PMFInformationUser()</a> to look up information about the user starting the case and that user's manager. It places that information in an array of variables to insert to an email template. <a href="/3.1/ProcessMaker_Functions#PMFSendMessage.28.29">PMFSendMessage()</a> is used to send out the email to the manager, and then <a href="/3.0/Internal_Functions_and_Classes#G::SendMessageText.28.29">G::SendMessageText()</a> is used to display a message informing the user that an email was sent to his/her manager.</p>

<p>First, an email template named "newCase.html" is created with the following content:</p>
<p><img src="/sites/default/files/newCaseTemplateFile.png"></p>
<p>Then, the following trigger is created to send out an email with that template:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> PMFInformationUser<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aManager</span> <span style="color: #339933;">=</span> PMFInformationUser<span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'reportsto'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$caseUrl</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'http://'</span><span style="color: #339933;">.</span><span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SERVER_NAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">':'</span><span style="color: #339933;">.</span><span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SERVER_PORT'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'/sys'</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; <span style="color: #339933;">@@</span>SYS_SYS<span style="color: #339933;">.</span><span style="color: #0000ff;">'/'</span><span style="color: #339933;">.@@</span>SYS_LANG<span style="color: #339933;">.</span><span style="color: #0000ff;">'/'</span><span style="color: #339933;">.@@</span>SYS_SKIN<span style="color: #339933;">.</span><span style="color: #0000ff;">'/cases/cases_Open?APP_UID='</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">.</span><span style="color: #0000ff;">'&amp;DEL_INDEX=1&amp;action=draft'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aVars</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'caseUrl'</span> &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$caseUrl</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'caseNo'</span> &nbsp; &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@@</span>APP_NUMBER<span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'assignedTo'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;CREATOR&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'caseStarted'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INIT_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'taskDue'</span> &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_TASK_DUE_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'manager'</span> &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aManager</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aManager</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'lastname'</span><span style="color: #009900;">&#93;</span><br />
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
PMFSendMessage<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;admin@example.com&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aManager</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">'New Case #'</span><span style="color: #339933;">.@@</span>APP_NUMBER<span style="color: #339933;">,</span> <span style="color: #0000ff;">'newCase.html'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aVars</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Email about case #&quot;</span><span style="color: #339933;">.@@</span>APP_NUMBER<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; sent to &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$aVars</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'manager'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'INFO'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>Finally, this trigger is selected in the <b>Execute a trigger when a case is created</b> dropdown in the <b>Properties</b> of the process.</p>
<p><img src="/sites/default/files/TriggerWhenCreatingCase.png"></p>
<p>When a new case is created, a green information message appears above the Dynaform in the first task in the process.</p>
<p><img src="/sites/default/files/InfoMessageForNewCaseTrigger.png"></p>
<p>In addition, the manager receives the following email:</p>
<p><img src="/sites/default/files/EmailStartCaseTrigger.png"></p>
  
h3<span id="when_reassigning_case">Example When Reassigning a Case</span>

<p>When a case is reassigned, the following trigger sends an email message to the user who is newly assigned to the case, plus a carbon copy to the user who was previously assigned to the case.</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//use order by descending to get the highest delegation index, which is the record for the reassigned case</span><br />
<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;select * from APP_CACHE_VIEW where APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' order by DEL_INDEX desc&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aDels</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aDels</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aDels</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; <span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in query:<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #006699; font-weight: bold;">$query</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;WARNING&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//Case Info if needing to send it to template:</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseNo</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">=</span> <span style="color: #000088;">$aDels</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_NUMBER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$newUserId</span> &nbsp; &nbsp; <span style="color: #339933;">=</span> <span style="color: #000088;">$aDels</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$prevUserId</span> &nbsp; &nbsp;<span style="color: #339933;">=</span> <span style="color: #000088;">$aDels</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PREVIOUS_USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseStartDate</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aDels</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_CREATE_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> PMFInformationUser<span style="color: #009900;">&#40;</span><span style="color: #000088;">$newUserId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aPrevUser</span> <span style="color: #339933;">=</span> PMFInformationUser<span style="color: #009900;">&#40;</span><span style="color: #000088;">$prevUserId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$to</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$aUser['firstname']}</span> <span style="color: #006699; font-weight: bold;">{$aUser['lastname']}</span> &lt;<span style="color: #006699; font-weight: bold;">{$aUser['mail']}</span>&gt;&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$cc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$aPrevUser['firstname']}</span> <span style="color: #006699; font-weight: bold;">{$aPrevUser['lastname']}</span> &lt;<span style="color: #006699; font-weight: bold;">{$aPrevUser['mail']}</span>&gt;&quot;</span><span style="color: #339933;">;</span><br />
&nbsp;<br />
&nbsp; &nbsp;PMFSendMessage<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #0000ff;">'manager@example.com'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$to</span><span style="color: #339933;">,</span> <span style="color: #000088;">$cc</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">'Reassigned to case '</span><span style="color: #339933;">.</span><span style="color: #000088;">$caseNo</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'ReassignCaseTemplate.html'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>

h3<span id="Triggers_When_Reassigning_Cases">Triggers When Reassigning Cases</span>
<p>The trigger for case reassignment is executed <i>after</i> the reassignment action, so a new delegation index has already been created and a new record has been added to the 
<b><tt>APP_DELEGATION</tt></b> table in the database. 

When the trigger is fired, 
<code>@%INDEX</code> is still set to the delegation index of the previous assigned user, and <code>@@USER_LOGGED</code> and <code>@@USR_USERNAME</code> are set to the ID and username of the user who is doing the reassigning (which may be the previous assigned user who has the 
<a href="/3.1/Roles#PM_REASSIGNCASE">PM_REASSSIGNCASE</a> permission or a process supervisor 
who has the <a href="/3.1/Roles#PM_REASSIGNCASE_SUPERVISOR">PM_REASSIGNCASE_SUPERVISOR</a> 
permission).

<p>To find out who is the new user  assigned to the case, use the following database query in the
<b><tt>APP_DELEGATION</tt></b> table in the trigger executed during reassignment:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$taskId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>TASK<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$oldIndex</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>INDEX<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT USR_UID, DEL_INDEX FROM APP_DELEGATION WHERE APP_UID='caseId' AND TAS_UID='<span style="color: #006699; font-weight: bold;">$taskId</span>' AND <br />
&nbsp; &nbsp;DEL_THREAD_STATUS='OPEN' AND DEL_INDEX&lt;&gt;<span style="color: #006699; font-weight: bold;">$oldIndex</span> ORDER BY DEL_INDEX DESC&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error: Case reassignment failed!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$newIndex</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$newUserId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$newUserId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$newUserName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'lastname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$newUserEmail</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>
<p>To find out who was the user previously assigned to the case, use the 
<a href="/3.0/Internal_Functions_and_Classes#Cases::loadCase.28.29">Cases::LoadCase()</a> method and 
the <code>@%INDEX</code> system variable, which is still set to the delegation index of the 
previous delegation:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aCase</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$oldUserId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$oldUserName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$oldUserEmail</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$oldUserId</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>

h2<span id="Using_PHP_Functions">Using PHP Functions</span>
<p>Any standard PHP function can be called inside triggers. Functions from PHP extensions can also be called if the extension is installed in the ProcessMaker server. In addition, it is also possible to define custom functions inside triggers.

In the same trigger, where the function will be used, define the function:
<codeblock>//define the custom function: 
function <font color=blue><i>func()</i></font> {
  //function code here
}
//call the function:
<font color=blue><i>func</i></font>(); 
</codeblock>
<p><b>Example:</b><br>
The custom function </code>getAssignedCases()</code> returns an array of the active cases assigned to a user. The function is called to get the number of cases assigned to the user currently logged in.</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//Get the assigned cases for a specified user:</span><br />
<span style="color: #000000; font-weight: bold;">function</span> getAssignedCases<span style="color: #009900;">&#40;</span><span style="color: #000088;">$userUid</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$userUid</span> <span style="color: #339933;">=</span> <a href="http://php.net/mysql_real_escape_string"><span style="color: #990000;">mysql_real_escape_string</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$userUid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT APP_UID, APP_NUMBER, DEL_INDEX, APP_TITLE FROM APP_CACHE_VIEW <br />
&nbsp; &nbsp; &nbsp;WHERE USR_UID='<span style="color: #006699; font-weight: bold;">$userUid</span>' AND DEL_THREAD_STATUS = &quot;</span>OPEN<span style="color: #0000ff;">&quot; AND <br />
&nbsp; &nbsp; &nbsp;(APP_STATUS='TO_DO' OR APP_STATUS='DRAFT')&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCases</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCases</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error executing query:<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #006699; font-weight: bold;">$query</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">return</span> <span style="color: #000088;">$aCases</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<br />
<span style="color: #009900;">&#125;</span> &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp;<br />
<span style="color: #339933;">@%</span>numberOfCases <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span>getAssignedCases<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>The getAssignedCases() function needs to be defined in the same trigger that calls it. To define the function in a separate file, see <a href="#Importing_PHP_Files">Importing PHP files</a> below.

<p>There are two restrictions on functions defined in triggers. The functions can't access global variables defined outside the function. For example, this code will not work in a trigger:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$fileUrl</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;http://example.com/files/weeklyAccount.txt&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000000; font-weight: bold;">function</span> getFile<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$fileUrl</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//global variables like this won't work</span><br />
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <a href="http://php.net/file_get_contents"><span style="color: #990000;">file_get_contents</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$fileUrl</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #339933;">@@</span>contents <span style="color: #339933;">=</span> getFile<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>To get around this restriction, pass the variable as a parameter to the function like this:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> getFile<span style="color: #009900;">&#40;</span><span style="color: #000088;">$fileUrl</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <a href="http://php.net/file_get_contents"><span style="color: #990000;">file_get_contents</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$fileUrl</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$url</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;http://example.com/files/weeklyAccount.txt&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>contents <span style="color: #339933;">=</span> getFile<span style="color: #009900;">&#40;</span><span style="color: #000088;">$url</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>The other restriction is that system and case variable can't be used inside functions defined in triggers. For example, the following code will not work:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> getFields<span style="color: #009900;">&#40;</span><span style="color: #000088;">$formId</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//Error: system and case variables can't be used inside function defined in trigger:</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$aFields</span> <span style="color: #339933;">=</span> PMFDynaFormFields<span style="color: #009900;">&#40;</span><span style="color: #000088;">$formId</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #000088;">$aFields</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$aFields</span> <span style="color: #339933;">=</span> getFields<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'1656915905b5fc667e90607076410421'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </div></div>
Instead, the system and case variables should be passed as parameters to the function like this:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> getFields<span style="color: #009900;">&#40;</span><span style="color: #000088;">$formId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$aFields</span> <span style="color: #339933;">=</span> PMFDynaFormFields<span style="color: #009900;">&#40;</span><span style="color: #000088;">$formId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #000088;">$aFields</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$aFields</span> <span style="color: #339933;">=</span> getFields<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'1656915905b5fc667e90607076410421'</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </div></div>
 
h2 <span id="Importing_PHP_Files">Importing PHP Files</span>
<p>PHP files can be imported into triggers by calling the <a href="http://php.net/manual/en/function.require-once.php">require_once()</a> function.

<p>For example, to import the <a href="https://github.com/PHPOffice/PhpSpreadsheet">PhpSpreadsheet</a> library, <a href="/3.1/Grid_Control#Importing_spreadsheet">downloaded it and placed it on the ProcessMaker server</a> at the location:</p>
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">/opt/PhpSpreadsheet/Spreadsheet.php<br />
/opt/PhpSpreadsheet/Calculation/Calculation.php<br />
/opt/PhpSpreadsheet/Cell/Cell.php</div></div>
<p>After importing the library, functions from this library can be used in a trigger by adding the following code at the beginning of the trigger:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/opt/PhpSpreadsheet/Spreadsheet.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//now functions from PhpSpreadsheet can be called in the trigger</span></div></div>
<p>Remember that <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/opt/PhpSpreadsheet/Spreadsheet.php&quot;</span><span style="color: #009900;">&#41;</span></code></span> should be added to every trigger that calls the PhpSpreadsheet functions, because there is no guarantee that the other triggers in the process have been executed.</p>

<p>It is also possible to reference libraries via their web URL. For example, if ProcessMaker is installed on a server at <code>http://www.example.com</code> and the PhpSpreadsheet files are placed at the following location:</p>
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">/opt/processmaker/workflow/public_html/PhpSpreadsheet/PhpSpreadsheet.php<br />
/opt/processmaker/workflow/public_html/PhpSpreadsheet/Calculation/Calculation.php<br />
/opt/processmaker/workflow/public_html/PhpSpreadsheet/Cell/Cell.php</div></div>

<p>Then, the following command can be used to import the PhpSpreadsheet library to a trigger:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.example.com/PhpSpreadsheet/PhpSpreadsheet.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//now functions from PhpSpreadsheet can be called in the trigger</span></div></div>

<p style="margin-left:25px"><font color=green><b>Note:</b></font> <font color=dimgrey>The problem with placing files in the <b><tt>processmaker/workflow/public_html</tt></b> directory is that they are publicly accessible, so it is not necessary to log into ProcessMaker to access them, and are therefore less secure. Also, they will be overwritten every time ProcessMaker is upgraded to a new version, so it is recommended to place library files in a location outside the <b><tt>processmaker</tt></b> directory.</font></p>

<p>To import PHP files via a web URL, the <a href="http://php.net/manual/en/filesystem.configuration.php#ini.allow-url-include">allow_url_include</a> setting needs to be enabled in the <a href="/3.0/Additional_Configuration#Configuring_PHP"><b><tt>php.ini</tt></b> configuration file</a> on the ProcessMaker server. Add the following line to the <b><tt>php.ini</tt></b> file:
<codeblock>allow_url_include=1
</codeblock>

h3 <span id="Importing_Public_Files">Importing Public Files</span>
<p>If it is not possible to access the file system of the ProcessMaker server, the PHP code files can be uploaded as <a href="/3.0/Public_Files">Public Files</a>. Then, they can be imported into a trigger with the command:
<codeblock>require_once("http://&lt;IP-ADDRESS&gt;/sys&lt;WORKSPACE&gt;/&lt;LANG&gt;/&lt;SKIN&gt;/&lt;PROCESS-UID&gt;/&lt;FILENAME&gt;");
//now functions from PHP file can be called in the trigger
</codeblock>

<p>PHP files uploaded as public files will not be overwritten when ProcessMaker is upgraded to a new version, but they are still publicly accessible, so do not use Public Files if the code in PHP files contains confidential information.</p> 

<p>For example, if the <b><tt>mycode.php</tt></b> file is uploaded in a process with the UID of <code>951278345568c24e3b3a2b4030387681</code> in the default "workflow" workspace on a server located at <code>http://www.example.com</code>, then it can be accessed with the following code in a trigger:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.example.com/sysworkflow/en/neoclassic/951278345568c24e3b3a2b4030387681/mycode.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//now functions from mycode.php can be called in the trigger</span></div></div>
<p>To find the Process's unique ID, run a case with the <a href="#Debugging_Triggers">Debugger</a> turned on and check the value of the <code>PROCESS</code> variable.</p>

<p>The <code>@@PROCESS</code> system variable can be used to automatically insert the current process's unique ID into the URL, as long as the PHP file is uploaded to the public files of the same process:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.example.com/sysworkflow/en/neoclassic/&quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>PROCESS <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;/mycode.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//now functions from mycode.php can be called in the trigger</span></div></div>

<p>If the <a href="http://php.net/manual/en/filesystem.configuration.php#ini.allow-url-include">allow_url_include</a> setting is not enabled (as explained above), then the public file can be imported directly from the server's file system. To import a public file that was uploaded to the same process which contains the trigger:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span>PATH_DATA_PUBLIC <span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>PROCESS <span style="color: #339933;">.</span> PATH_SEP <span style="color: #339933;">.</span> <span style="color: #0000ff;">'mycode.php'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
If accessing a public file that was uploaded to a different process, then specify the process's unique ID:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span><span style="color: #009900;">&#40;</span>PATH_DATA_PUBLIC <span style="color: #339933;">.</span> <span style="color: #0000ff;">'90867389156d629c03d98c1058762491'</span> <span style="color: #339933;">.</span> PATH_SEP <span style="color: #339933;">.</span> <span style="color: #0000ff;">'mycode.php'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<code>PATH_DATA_PUBLIC</code> is a predefined constant containing the path to the public files, such as <code>"/opt/processmaker/shared/sites/workflow/public/"</code> on a Linux system. <code>PATH_SEP</code> is the directory separator, which is <code>"/"</code> on a Linux/UNIX system and <code>"\"</code> on a Windows system. Both of these constants are defined in <b><tt>workflow/public_html/sysGeneric.php</tt></b>.

h3 <span id="Automatically_importing_code_files">Automatically Importing Code Files</span>
<p>To avoid calling <code>require_once()</code> in every trigger that references code in an external PHP file, then add the <code>require_once()</code> command to the <b><tt>processmaker/workflow/engine/classes/class.pmFunctions.php</tt></b> file, so the PHP file will automatically be imported to every trigger.

However, the <b><tt>class.pmFunctions.php</tt></b> file will automatically be overwritten every time ProcessMaker is upgraded, so the <code>require_once()</code> command will need to be reinserted after every upgrade.-->

<h2><span id="Timeouts">Timeout Triggers for Self Service Tasks</span></h2>
<p>A <a href="../3.0/Tasks.html#Setting_time_limit_to_claim_a_case">timeout trigger</a> can be set for <a href="../3.0/Tasks.html#Self-Service">Self Service</a> and <a href="../3.0/Tasks.html#Self_Service_Value_Based_Assignment">Self Service Value Based Assignment</a> tasks, that will be run if the task is not claimed by a user after a set amount of time. Timeout triggers are run when the <a href="../3.0/Executing_cron.html"><b><tt>cron.php</tt></b> file</a> on the ProcessMaker server is run.</p>

<p>When a timeout trigger is run, the system variables will not be updated for the current task, so the following system variables listed below will not be accurate. They will be set to the values in the most recent task worked on in the case, which is generally the task before the self service task, but it could be a parallel task (if the process contains any parallel tasks):
<ul>
<li><code>@@TASK</code>: Set to the ID of the task that was most recently worked on.
<li><code>@%INDEX</code>: Set to the delegation index of the task that was most recently worked on. To get the delegation index of a self service task, look it up in the APP_DELEGATION.DEL_INDEX field in the database. See the example below. 
<li><code>@@USER_LOGGED</code>: 
Since the timeout trigger is run by <b><tt>cron.php</tt></b>, there will be no user logged in, so <code>@@USER_LOGGED</code> is set to the ID of the user who most recently worked on the case.

To get the ID of the user who worked on the task before the self service task, it is recommended to save the @@USER_LOGGED in a case variable in the prior task. See the example below.
<li><code>@@USR_USERNAME</code>: 
Since the timeout trigger is run by <b><tt>cron.php</tt></b>, there will be no user logged in, so <code>@@USR_USERNAME</code> is set to the ID of the user who most recently worked on the case. 

To get the ID of the user who worked on the task before the self service task, it is recommended to save the @@USR_USERNAME in a case variable in the prior task. See the example below.
</ul>
<p>In a timeout trigger, the <a href="../3.0/Internal_Functions_and_Classes.html#Cases::setCatchUser.28.29">Cases::setCatchUser()</a> method can be used to automatically assign a user to the task.</p> 
<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray">Time-out triggers for self-service tasks cannot contain the <span class="geshifilter"><code class="text geshifilter-text">$_SERVER</code></span> PHP global variable.</font></p>
<!--<p><b>Example 1:</b></p>
<p>The following trigger saves the ID and username of the user who was assigned to the task prior to the self service task:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@@</span>previousUserId <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>previousUsername <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USR_USERNAME<span style="color: #339933;">;</span></div></div>
<p>This trigger is set to fire <i>before assignment</i> in the task prior to the self service task. 
<p>Then, the following timeout trigger automatically assigns a Self Service task to the manager of the user who was assigned to the previous task in the process:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$taskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'188586462577ed40a325599037697166'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to the ID of the self service task</span><br />
<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//lookup delegation index of self service task in database:</span><br />
<span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT DEL_INDEX FROM APP_DELEGATION WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND <br />
&nbsp; &nbsp;TAS_UID='<span style="color: #006699; font-weight: bold;">$taskId</span>' ORDER BY DEL_INDEX DESC&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aDelegations</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span> or <br />
&nbsp; &nbsp;<span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in DB query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unable to find delegation index for self service task with query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>previousUserId<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//user assigned to previous task</span><br />
<span style="color: #666666; font-style: italic;">//if user does not have a Departmental manager, then assign the task to the admin:</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'reportsto'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$managerId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'reportsto'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">else</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$managerId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'00000000000000000000000000000001'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// ID of the admin</span><br />
<br />
<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setCatchUser</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #339933;">,</span> <span style="color: #000088;">$managerId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p><b>Example 2:</b></p>
<p>When assigning a user to a Self Service task, remember that the user must be in the assignment pool for that task. The following trigger randomly selects a user from the assignment pool of the Self Service task and assigns him/her to work on the task.  <a href="/3.0/Internal_Functions_and_Classes#Derivation::getAllUsersFromAnyTask.28.29">Derivation::getAllUsersFromAnyTask()</a> is used to get an array of the users assigned to the task and then selects one with the <a href="http://php.net/manual/en/function.rand.php">rand()</a> function. In addition, the trigger uses <a href="/3.0/ProcessMaker_Functions#PMFSendMessage.28.29">PMFSendMessage()</a> to send an email message to the assigned user to inform him/her of the assignment.</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$taskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'188586462577ed40a325599037697166'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to the ID of the self service task</span><br />
<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//lookup delegation index of self service task in database:</span><br />
<span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT DEL_INDEX FROM APP_DELEGATION WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND <br />
&nbsp; &nbsp;TAS_UID='<span style="color: #006699; font-weight: bold;">$taskId</span>' ORDER BY DEL_INDEX DESC&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aDelegations</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span> or <br />
&nbsp; &nbsp;<span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in DB query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unable to find delegation index for self service task with query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$d</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Derivation<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$d</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getAllUsersFromAnyTask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$taskId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$cnt</span> <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cnt</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$userToAssign</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><a href="http://php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$cnt</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$userToAssign</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$to</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span>lastname<span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' &lt;'</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setCatchUser</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #339933;">,</span> <span style="color: #000088;">$userToAssign</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;PMFSendMessage<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #0000ff;">'admin@example.com'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$to</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;You're assigned to case #&quot;</span><span style="color: #339933;">.@@</span>APP_NUMBER<span style="color: #339933;">,</span> <span style="color: #0000ff;">'caseAssignment.html'</span><span style="color: #339933;">,</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>-->

<p>Any timeout triggers scheduled are run when <code>unassigned cases</code> are listed as <code>DONE</code> in the output of the <b><tt>cron.php</tt></b> file. <a href="../3.2/Executing_cron.html">Cron executions</a> for timeout triggers are also registered in the <a href="../3.3/Logs.html#Cron_Logs">cron logs</a>.</p>

<!--<p>Any timeout triggers scheduled are executed when <code>inassigned cases</code> are listed as <code>DONE</code> in the output of the <b><tt>cron.php</tt></b> file.

For example, on a Linux server:
<codeblock># <b>cd /opt/processmaker/workflow/engine/bin</b>
# <b>php cron.php</b>
<font color=lightgreen>Processing workspace: workflow</font>
* Resending emails............................................<font color=lightgreen>[DONE]</font>
* Unpausing applications......................................<font color=lightgreen>[DONE]</font>
* Calculating Duration........................................<font color=lightgreen>[DONE]</font>
* Calculating Duration by Application.........................<font color=lightgreen>[DONE]</font>
* Executing events............................................<font color=lightgreen>[PROCESSING]</font>
* |- End Execution events.....................................<font color=lightgreen>[Processed 0]</font>
* Executing the scheduled starting cases......................<font color=lightgreen>[PROCESSING]</font>
<font color=lightgreen>[DONE]</font>
* Update case labels..........................................<font color=lightgreen>[DONE]</font>
<span style="background-color: yellow">* Unassigned case.............................................<font color=lightgreen>[DONE]</font></span>
* Executing cron files in bin/plugins directory in Workspace: workflow
Finished 1 workspaces processed
Done!
</codeblock>
<p>If an error occurs during the execution of a timeout trigger, an error message will replace the <code><font color=lightgreen>[DONE]</font></code> in the output:
<codeblock>* Unassigned case.............................................PHP Fatal error:  Function name must be a string in /opt/processmaker/workflow/engine/classes/class.pmScript.php(210) : eval()'d code on line 9
Finished 1 workspaces processed
Done!
</codeblock>
<p>When <b><tt>cron.php</tt></b> checks whether there are any timeouts scheduled, it adds the following line to the <b><tt>shared/log/cron.log</tt></b> file:
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">2016-12-02 22:36:02 | &nbsp;| unassignedCase | action | Unassigned case</div></div>
<p>For every timeout trigger executed by <b><tt>cron.php</tt></b>, additional lines are added to the log file:
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">2016-12-02 22:36:02 | &nbsp;| unassignedCase | action | Unassigned case<br />
2016-12-02 22:36:03 | &nbsp;| unassignedCase | action | OK Executed trigger to the case 62<br />
2016-12-02 22:36:04 | &nbsp;| unassignedCase | action | OK Executed trigger to the case 107<br />
2016-12-02 22:36:05 | &nbsp;| unassignedCase | action | OK Executed trigger to the case 123</div></div>
<p>Since timeout triggers are generally executed automatically by a cronjob in Linux or a Scheduled Task in Windows, it may be useful to catch exceptions and write their messages to a custom log file. 
For example, the trigger below could be written to print exceptions, so the user can see them when <b><tt>cron.php</tt></b> is executed, and write them to a custom log file named <b>shared/log/timeoutExceptions.log</b>:


<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;">try <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$taskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'188586462577ed40a325599037697166'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to the ID of the self service task</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//lookup delegation index of self service task in database:</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT DEL_INDEX FROM APP_DELEGATION WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND <br />
&nbsp; &nbsp; &nbsp; TAS_UID='<span style="color: #006699; font-weight: bold;">$taskId</span>' ORDER BY DEL_INDEX DESC&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aDelegations</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span> or <br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in DB query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unable to find delegation index for self service task with query: <span style="color: #006699; font-weight: bold;">$sql</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aDelegations</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$d</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Derivation<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$d</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getAllUsersFromAnyTask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$taskId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$cnt</span> <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cnt</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> Exception<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;No users assigned to self service task.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$userToAssign</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><a href="http://php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$cnt</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$userToAssign</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$to</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span>lastname<span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' &lt;'</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setCatchUser</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #339933;">,</span> <span style="color: #000088;">$userToAssign</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;PMFSendMessage<span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'admin@example.com'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$to</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;You're assigned to case #&quot;</span><span style="color: #339933;">.@@</span>APP_NUMBER<span style="color: #339933;">,</span> <span style="color: #0000ff;">'caseAssignment.html'</span><span style="color: #339933;">,</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span> <br />
catch <span style="color: #009900;">&#40;</span>Exception <span style="color: #000088;">$e</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$msg</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Exception in timeout trigger in case #&quot;</span><span style="color: #339933;">.@@</span>APP_NUMBER<span style="color: #339933;">.</span><span style="color: #0000ff;">' at '</span><span style="color: #339933;">.</span><a href="http://php.net/date"><span style="color: #990000;">date</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Y-m-d_H:i:s'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;: <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$e</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">print</span> <span style="color: #000088;">$msg</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//print in output of cron.php</span><br />
&nbsp; &nbsp;<a href="http://php.net/file_put_contents"><span style="color: #990000;">file_put_contents</span></a><span style="color: #009900;">&#40;</span>PATH_DATA<span style="color: #339933;">.</span><span style="color: #0000ff;">'log'</span><span style="color: #339933;">.</span>PATH_SEP<span style="color: #339933;">.</span><span style="color: #0000ff;">'timeoutExceptions.php'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$msg</span><span style="color: #339933;">,</span> FILE_APPEND<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span> </div></div> --></div></div></div>  </div>

      <footer>
          </footer>
  
    </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
      </section>
    </div>
  
      
    </div>

      
</div>

 <!---add diego--->
  <div id="download-app-section" class="download-app mobile-none">
			<div class="row">
				<div class="col-md-12">
					<div class="text_app">Download our app</div>
							<a href="https://itunes.apple.com/us/app/processmaker/id992576284?ls=1&amp;mt=8" target="_blank">
								<img src="../themes/thecompany_responsive_theme/images/appstore.png">
							<a href="https://play.google.com/store/apps/details?id=com.colosa.processmaker" target="_blank">
								<img src="../themes/thecompany_responsive_theme/images/playstore.png">				
				</div>
			</div>
  </div>
  <!---end diego--->
<!----add diego----->    
		<div class="logo_processmaker"><a href="http://www.processmaker.com/">
		<img src="../themes/thecompany_responsive_theme/images/logo_processmaker.png"></div>
<!----end diego----->
<div id="footer">
  <div id="footer_wrapper">
      </div>

  <div class="social-media-wrapper">
         <div id="social-media-icons">
       <ul>
       	<div class="text_contact">Contact us</div>
				<div class="text_number">+1-617-340-3377</div>
        <!--<li><a class="rss" href="/rss.xml">rss</a></li> <!--edit diego-->
        <li><a class="facebook" href="http://facebook.com/processmaker/" target="_blank" rel="me">facebook</a></li>
        <li><a class="twitter" href="https://twitter.com/processmaker" target="_blank" rel="me">twitter</a></li>
        <li><a class="gplus" href="https://www.google.com/+ProcessMakerOpenSource" target="_blank" rel="me">Gplus</a></li>
        <li><a class="linkedin" href="https://www.linkedin.com/groups?mostRecent=&amp;gid=3970335&amp;trk=my_groups-tile-flipgrp" target="_blank" rel="me">Linked in</a></li>
        <!--<li><a class="dribbble" href="http://dribbble.com" target="_blank" rel="me">Dribbble</a></li>
        <li><a class="vimeo" href="http://vimeo.com" target="_blank" rel="me">Vimeo</a></li>-->
        <li><a class="youtube" href="https://www.youtube.com/user/processmaker" target="_blank" rel="me">Youtube</a></li>
       </ul>
      </div>
      </div>
  
  <div class="footer_credit">
    <div class="footer_inner_credit">
           <div id="foot"><div class="region region-footer">
  <div id="block-block-2" class="block block-block">

      
  <div class="content">
    <p><font style="font-family:arial,sans-serif; font-size:15px; font-weight: none; color:#FFF">Automate your Workflow with Business Process Management<br>Software licensed under the <a 1px="" class="external text" href="http://www.gnu.org/licenses/agpl.html" rel="nofollow" style="padding-right: 13px; color:white;">GNU Affero General Public License version 3</a><br>Contact us:&nbsp;<a class="external free" href="mailto:community@processmaker.com" rel="nofollow" style="font-weight:bold;color:white;text-decoration:underline;">community@processmaker.com</a><br><a class="external free" href="https://www.processmaker.com/privacy-statement" rel="nofollow" style="font-weight:bold;color:white;text-decoration:underline;">Privacy Statement</a></font><br><font style="font-family:arial,sans-serif; font-size:15px; font-weight: none; color:#FFF">© Copyright 2000-2024 ProcessMaker Inc. All rights reserved.</font></p>
  </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
</div>
         
   <!-- <div id="copyright">
      <p class="copyright">Copyright &copy; 2024, Documentation@ProcessMaker </p>
      <!--<p class="credits"> Developed by  <a href="http://www.zymphonies.com">Zymphonies</a></p>
      <div class="clear"></div>
    </div>-->
  </div>
  
  </div>
</div>

</div>

<script type="text/javascript">
  /* <![CDATA[ */
  document.write (
    '<img src="https://marketing.processmaker.com/acton/bn/3812/visitor.gif?ts='+ new Date().getTime()+ '&ref='+escape(document.referrer) + '">'
  );
  /* ]]> */
</script>
  
</div>
    <style>
    .center-div{
        width: 100%;        
        margin: 0 auto;
        z-index:10000;
        position:fixed;
        bottom: 0px;
        cursor:pointer;
    }
    .round-popup{
        margin:0 auto;
        font-family: 'Montserrat', sans-serif;
        font-size: 15px;
        font-weight: lighter;
        width: 412px;
        height: 50px;
        padding-top: 7px;
        text-align: center;
        position:relative;
    }
    .round-popup-button{
        position:absolute;
        top: 11px;
        right: 15px;
        background: transparent;
        border:none;
        font-size:15px;
        font-weight:normal;
        line-height:20px;
        width:20px;
        height:20px;
        padding:0;
    }
    .round-background-blue{
        background: url('http://www.processmaker.com/uploads/blue.png')no-repeat;
        color:white;
        
    }
    #box-pm31-button-blue{
        color: rgba(255, 255, 255, 0.5);
    }
    
    #box-pm31-button-blue:active,#box-pm31-button-blue:focus{
        border:none;
        outline:none;
    }
    .round-background-blue a{
        color: white!important;
        text-decoration: none;
        font-size: 15px;
        line-height:45px;
        font-family:Montserrat, sans-serif;
    }
    .round-background-blue span{
        font-weight: bold;
    }
    /*WHITE background*/
    .round-background-white{
        background: url('http://www.processmaker.com/uploads/white.png')no-repeat;
        background-position-x: -9px;        
        color: #3397E1;
    }
    .round-background-white a:hover{
        color: #3397E1!important;
        text-decoration: none;
        font-size: 15px;
    }
    #box-pm31-button-white{
        color: rgba(51, 151, 225, 0.7);
    }
</style>
    <div id="box-pm31" class="center-div" style="display:none;">
        <div class="round-popup round-background-blue">
            <a onclick="ga('send', 'event', 'WikiBlueBanner','click','PM31Release');" href="http://www.processmaker.com/download-processmaker-landing-page">
                <span>ProcessMaker 3.1</span> is Here! Download Now <span style="font-size:20px;font-weigth:normal;">»</span>
            </a>
            <button id="box-pm31-button-blue" class="round-popup-button">&times;</button>
        </div>
    </div>
    <script>

function pmCreateCookie(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        var expires = "; expires="+date.toGMTString();
    }
    else var expires = "";
    document.cookie = name+"="+value+expires+"; path=/";
}

function pmReadCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function pmEraseCookie(name) {
    createCookie(name,"",-1);
}



     jQuery(document).ready(function( $ ) {
        $('#box-pm31-button-blue').click(function(e){
                e.stopPropagation();
                $('#box-pm31').slideUp('fast');
                pmCreateCookie('ppcookie','val',10);
            });
        });
        jQuery(window).load(function() {
            if(pmReadCookie('ppcookie') !== 'val'){
                //jQuery('#box-pm31').delay( 2000 ).slideDown('slow');
            }
        });
    </script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">

<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
    // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
    // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.marinsm.com/serve/586a7ec3a2ae6b728400003d.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>

</body>

<!-- Mirrored from wiki.processmaker.com/node/626 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Feb 2024 09:23:12 GMT -->
</html>
