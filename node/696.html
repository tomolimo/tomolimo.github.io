<!DOCTYPE html>

<!-- Mirrored from wiki.processmaker.com/node/696 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Feb 2024 09:23:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta name="keywords" content="BPM, business process management, workflow, processmaker, business, BPM Windows, BPM Linux, wiki, BPM documentation, BPM FAQ, task documentation, BPM PHP, BPM Open Source, BPM Variables, BPM Installation, BPM Programming, BPM Elements, BPM Concepts, BPM Frequently Asked Questions, BPM 3.0, BPM News, Release notes, DynaForms, BPM Community, BPM Enterprise, BPM Mobile, BPM Responsive Web Design, User Manual, BPM Resources" />
<link rel="alternate" hreflang="en" href="../index.html" />
<link rel="shortcut icon" href="../themes/thecompany_responsive_theme/favicon.ico" type="image/vnd.microsoft.icon" />
<meta name="description" content="ProcessMaker is commercial open source workflow and business process management software." />
<meta name="viewport" content="width=device-width" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
<link rel="canonical" href="../3.2/Trigger_Examples.html" />
<link rel="shortlink" href="696.html" />
<title>3.2 - 3.8 - Trigger Examples | Documentation@ProcessMaker</title>
<style type="text/css" media="all">
@import url("../modules/system/system.base2af9.css?s743n7");
@import url("../modules/system/system.menus2af9.css?s743n7");
@import url("../modules/system/system.messages2af9.css?s743n7");
@import url("../modules/system/system.theme2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../modules/aggregator/aggregator2af9.css?s743n7");
@import url("../modules/comment/comment2af9.css?s743n7");
@import url("../modules/field/theme/field2af9.css?s743n7");
@import url("../modules/node/node2af9.css?s743n7");
@import url("../modules/search/search2af9.css?s743n7");
@import url("../modules/toc_filter/toc_filter2af9.css?s743n7");
@import url("../modules/user/user2af9.css?s743n7");
@import url("../modules/views/css/views2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../sites/all/modules/colorbox/styles/default/colorbox_style2af9.css?s743n7");
@import url("../modules/ctools/css/ctools2af9.css?s743n7");
@import url("../sites/all/modules/geshifilter/geshifilter2af9.css?s743n7");
@import url("../modules/panels/css/panels2af9.css?s743n7");
@import url("../modules/nice_menus/css/nice_menus2af9.css?s743n7");
@import url("../modules/nice_menus/css/nice_menus_default2af9.css?s743n7");
@import url("../modules/fivestar/css/fivestar2af9.css?s743n7");
</style>
<style type="text/css" media="all">
@import url("../themes/thecompany_responsive_theme/css/style2af9.css?s743n7");
@import url("../themes/thecompany_responsive_theme/css/media2af9.css?s743n7");
</style>
<script type="text/javascript" src="../modules/jquery_update/replace/jquery/1.9/jquery.min4b17.js?v=1.9.1"></script>
<script type="text/javascript" src="../misc/jquery.once7839.js?v=1.2"></script>
<script type="text/javascript" src="../misc/drupal2af9.js?s743n7"></script>
<script type="text/javascript" src="../modules/nice_menus/js/jquery.bgiframef195.js?v=2.1"></script>
<script type="text/javascript" src="../modules/nice_menus/js/jquery.hoverIntent1f6b.js?v=0.5"></script>
<script type="text/javascript" src="../modules/nice_menus/js/superfish099d.js?v=1.4.8"></script>
<script type="text/javascript" src="../modules/nice_menus/js/nice_menusc619.js?v=1.0"></script>
<script type="text/javascript" src="../modules/jquery_update/replace/ui/external/jquery.cookie1683.js?v=67fb34f6a866c40d0570"></script>
<script type="text/javascript" src="../modules/jquery_update/replace/misc/jquery.form.min97e5.js?v=2.69"></script>
<script type="text/javascript" src="../misc/ajax2347.js?v=7.34"></script>
<script type="text/javascript" src="../modules/jquery_update/js/jquery_update241d.js?v=0.0.1"></script>
<script type="text/javascript" src="../modules/toc_filter/toc_filter2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/colorbox/js/colorbox2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/colorbox/styles/default/colorbox_style2af9.js?s743n7"></script>
<script type="text/javascript" src="../sites/all/modules/google_analytics/googleanalytics2af9.js?s743n7"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","../../www.google-analytics.com/analytics.js","ga");ga("create", "UA-3380652-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript" src="../misc/progress2347.js?v=7.34"></script>
<script type="text/javascript" src="../modules/fivestar/js/fivestar.ajax2af9.js?s743n7"></script>
<script type="text/javascript" src="../modules/fivestar/js/fivestar2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-1.10.2.min2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-ui2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/jquery-ui.min2af9.js?s743n7"></script>
<script type="text/javascript" src="../themes/thecompany_responsive_theme/js/custom2af9.js?s743n7"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"thecompany_responsive_theme","theme_token":"XAwdsiMdAGeVyIxUhBB_gWzqbg1wPWCrAmc606ZbxEE","jquery_version":"1.9","js":{"modules\/jquery_update\/replace\/jquery\/1.9\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"modules\/nice_menus\/js\/jquery.bgiframe.js":1,"modules\/nice_menus\/js\/jquery.hoverIntent.js":1,"modules\/nice_menus\/js\/superfish.js":1,"modules\/nice_menus\/js\/nice_menus.js":1,"modules\/jquery_update\/replace\/ui\/external\/jquery.cookie.js":1,"modules\/jquery_update\/replace\/misc\/jquery.form.min.js":1,"misc\/ajax.js":1,"modules\/jquery_update\/js\/jquery_update.js":1,"modules\/toc_filter\/toc_filter.js":1,"sites\/all\/modules\/colorbox\/js\/colorbox.js":1,"sites\/all\/modules\/colorbox\/styles\/default\/colorbox_style.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1,"misc\/progress.js":1,"modules\/fivestar\/js\/fivestar.ajax.js":1,"modules\/fivestar\/js\/fivestar.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-1.10.2.min.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-ui.js":1,"themes\/thecompany_responsive_theme\/js\/jquery-ui.min.js":1,"themes\/thecompany_responsive_theme\/js\/custom.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/aggregator\/aggregator.css":1,"modules\/comment\/comment.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/toc_filter\/toc_filter.css":1,"modules\/user\/user.css":1,"modules\/views\/css\/views.css":1,"sites\/all\/modules\/colorbox\/styles\/default\/colorbox_style.css":1,"modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"modules\/panels\/css\/panels.css":1,"modules\/nice_menus\/css\/nice_menus.css":1,"modules\/nice_menus\/css\/nice_menus_default.css":1,"modules\/fivestar\/css\/fivestar.css":1,"themes\/thecompany_responsive_theme\/css\/style.css":1,"themes\/thecompany_responsive_theme\/css\/media.css":1}},"colorbox":{"opacity":"0.85","current":"{current} of {total}","previous":"\u00ab Prev","next":"Next \u00bb","close":"Close","maxWidth":"98%","maxHeight":"98%","fixed":true,"mobiledetect":true,"mobiledevicewidth":"480px","specificPagesDefaultValue":"admin*\nimagebrowser*\nimg_assist*\nimce*\nnode\/add\/*\nnode\/*\/edit\nprint\/*\nprintpdf\/*\nsystem\/ajax\nsystem\/ajax\/*"},"toc_filter_smooth_scroll_duration":"","googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip","trackColorbox":1},"nice_menus_options":{"delay":"800","speed":"slow"},"ajax":{"edit-vote--2":{"callback":"fivestar_ajax_submit","event":"change","url":"\/system\/ajax","submit":{"_triggering_element_name":"vote"}}}});
//--><!]]>
</script>
<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','../../connect.facebook.net/en_US/fbevents.js');
// Insert Your Facebook Pixel ID below.
fbq('init', '735235999992228');
fbq('track', 'PageView');
</script>
<!-- Insert Your Facebook Pixel ID below. -->
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=735235999992228&amp;ev=PageView&amp;noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->

</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-696 node-type-processmakerbpm">
    
<div class="wrap">

<div id="header_wrapper">
  <div id="inner_header_wrapper">

    <header id="header" role="banner">
      
      <div class="header_inner_wrapper">
        <div class="header_left">
                      <div id="logo">
              <a href="../index.html" title="Home"><img src="../sites/default/files/full-logo.png"/></a>
            </div>
                    	  <div class="menu_wrapper">
            <nav id="main-menu"  role="navigation">
              <a class="nav-toggle" href="#">Navigation</a>
              <div class="menu-navigation-container">
                <ul class="menu"><li class="first leaf"><a href="../PM_Classic.html" title="Learn how to develop business solutions in ProcessMaker Platform while maintaining your existing ProcessMaker 3 solutions in PM Classic: the perfect bridge between your new and existing solutions with a state-of--the-art BPM platform.">PM Classic</a></li>
<li class="leaf"><a href="http://www.processmaker.com/tutorials" title="">Tutorials</a></li>
<li class="leaf"><a href="../3.1/user_guide.html">User Guide</a></li>
<li class="leaf"><a href="../3.1/developer_info.html">Developer Info</a></li>
<li class="leaf"><a href="../3.2/sys_administration.html">Sys Administration</a></li>
<li class="leaf"><a href="../3.1/resources.html">Helpful Resources</a></li>
<li class="leaf"><a href="../Sitemap.html">Sitemap</a></li>
<li class="last leaf"><a href="https://processmaker.gitbook.io/processmaker/" title="Read ProcessMaker Platform Spring 2023 documentation to learn more about the next generation of BPM.">ProcessMaker Platform</a></li>
</ul>              </div>
              <div class="clear"></div>
            </nav>
          </div>
                  <!--  <h1 id="site-title">
            <a href="/" title="Home">Documentation@ProcessMaker</a>
            <div id="site-description"></div>
          </h1> -->
            
        </div>
      </div>
      <div class="header_right">
          <div class="region region-search">
  <div id="block-search-form" class="block block-search">

        <h2 >_</h2>
    
  <div class="content">
    <form action="https://wiki.processmaker.com/node/696" method="post" id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
    <div class="form-item form-type-textfield form-item-search-block-form">
  <label class="element-invisible" for="edit-search-block-form--2">Search </label>
 <input title="Enter the terms you wish to search for." placeholder="Search" type="text" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text" />
</div>
<div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit" /></div><input type="hidden" name="form_build_id" value="form-jp-PRFBpda8-UewXQZ5uYWryNZyhKeOUO8OoeCfWTYU" />
<input type="hidden" name="form_id" value="search_block_form" />
</div>
</div></form>  </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
                  <h1 class="page-title">3.2 - 3.8 - Trigger Examples</h1>                <p class="page-title-suffix"></p>
                 <div style="margin-top: 5px;"></div>
      </div>
    </header>
    <div class="region-version">
      <span>Version: </span><ul><li><a  class="active-version">3.8</a></li><li><a  class="active-version">3.7</a></li><li><a  class="active-version">3.6</a></li><li><a  class="active-version">3.5</a></li><li><a  class="active-version">3.4</a></li><li><a  class="active-version">3.3</a></li><li><a  class="active-version">3.2</a></li><li><a href="../3.0/Trigger_Examples.html" class="">3.1</a></li><li><a href="../3.0/Trigger_Examples.html" class="">3.0</a></li><li><a href="../index.php/Trigger_Examples.html" class="">2.x</a></li></ul>    </div>
  </div>
</div>
<!-- <ul class="nice-menu nice-menu-down nice-menu-main-menu" id="nice-menu-0"><li class="menu-506 menu-path-node-1078 first odd "><a href="/PM_Classic" title="Learn how to develop business solutions in ProcessMaker Platform while maintaining your existing ProcessMaker 3 solutions in PM Classic: the perfect bridge between your new and existing solutions with a state-of--the-art BPM platform.">PM Classic</a></li>
<li class="menu-319 menu-path-processmakercom-tutorials  even "><a href="http://www.processmaker.com/tutorials" title="">Tutorials</a></li>
<li class="menu-320 menu-path-node-571  odd "><a href="/3.1/user_guide">User Guide</a></li>
<li class="menu-1138 menu-path-node-572  even "><a href="/3.1/developer_info">Developer Info</a></li>
<li class="menu-1197 menu-path-node-876  odd "><a href="/3.2/sys_administration">Sys Administration</a></li>
<li class="menu-1140 menu-path-node-236  even "><a href="/3.1/resources">Helpful Resources</a></li>
<li class="menu-1141 menu-path-node-554  odd "><a href="/Sitemap">Sitemap</a></li>
<li class="menu-1213 menu-path-sprocessmakergitbookio-processmaker-  even last"><a href="https://processmaker.gitbook.io/processmaker/" title="Read ProcessMaker Platform Spring 2023 documentation to learn more about the next generation of BPM.">ProcessMaker Platform</a></li>
</ul>
-->
  
  <div id="container">
    
    <div class="content-sidebar-wrap">

    <div id="content">

              <!-- <div id="breadcrumbs">
        <h2 class="element-invisible">You are here</h2><div class="breadcrumb"><a href="/">Home</a></div></div> -->
      
      <section id="post-content" role="main">
                                        <div class="region region-content">
  <div id="block-system-main" class="block block-system">

      
  <div class="content">
                          <span property="dc:title" content="3.2 - 3.8 - Trigger Examples" class="rdf-meta element-hidden"></span>  
      
    
  <div class="content node-processmakerbpm">
    <div class="field field-name-field-how-useful-did-you-find-th field-type-fivestar field-label-above"><div class="field-label">Please rate how useful you found this document:&nbsp;</div><div class="field-items"><div class="field-item even"><form class="fivestar-widget" action="https://wiki.processmaker.com/node/696" method="post" id="fivestar-custom-widget" accept-charset="UTF-8"><div><div  class="clearfix fivestar-average-text fivestar-average-stars fivestar-form-item fivestar-default"><div class="form-item form-type-fivestar form-item-vote">
 <div class="form-item form-type-select form-item-vote">
 <select id="edit-vote--2" name="vote" class="form-select"><option value="-">Select rating</option><option value="20">Give 3.2 - 3.8 - Trigger Examples 1/5</option><option value="40">Give 3.2 - 3.8 - Trigger Examples 2/5</option><option value="60" selected="selected">Give 3.2 - 3.8 - Trigger Examples 3/5</option><option value="80">Give 3.2 - 3.8 - Trigger Examples 4/5</option><option value="100">Give 3.2 - 3.8 - Trigger Examples 5/5</option></select>
<div class="description"><div class="fivestar-summary fivestar-summary-average-count"><span class="average-rating">Average: <span >3</span></span> <span class="total-votes">(<span >9</span> votes)</span></div></div>
</div>

</div>
</div><input class="fivestar-submit form-submit" type="submit" id="edit-fivestar-submit" name="op" value="Rate" /><input type="hidden" name="form_build_id" value="form-vC00Ka7Q-yCLxS0o3NKUjcuJgzxvLYoIDQ7P7RZNA6M" />
<input type="hidden" name="form_id" value="fivestar_custom_widget" />
</div></form></div></div></div><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><div style="float: right; margin-left: 5px; background-color: #f9f9f9; border: 1px solid #aaaaaa; padding: 5px;"><center><strong>Contents:</strong> [<a href="#" onclick="var el = document.getElementById('toc');
        var txt = ('innerText' in el)? 'innerText' : 'textContent';
        if (el.style.display=='none') { 
           el.style.display = '';
           document.getElementById('hideLabel')[txt] = 'hide';
        }
        else {
	        el.style.display = 'none';
           document.getElementById('hideLabel')[txt] = 'show';
        }"><span id="hideLabel">hide</span></a>]</b></center><div id="toc" ><ol class="toc">
<li class="toc"><a href="#Overview">Overview</a></li>
<li class="toc"><a href="#Aborting_New_Cases_Under_Certain_Circumstances">Aborting New Cases Under Certain Circumstances</a></li>
<li class="toc"><a href="#Workaround_for_Global_Variables">Workaround for Global Variables</a></li>
<ol class="toc">
<li class="toc"><a href="#Global_Counters_for_Cases">Global Counters for Cases</a></li>
</ol>
<li class="toc"><a href="#Routing_.28Derivating.29_all_Parallel_Tasks_in_a_Case">Routing (Derivating) all Parallel Tasks in a Case</a></li>
<li class="toc"><a href="#Routing_Parallel_Tasks_after_Completing_a_Fixed_Number">Routing Parallel Tasks after Completing a Fixed Number</a></li>
<li class="toc"><a href="#Displaying_a_List_of_Cases_in_a_Grid">Displaying a List of Cases in a Grid</a></li>
<li class="toc"><a href="#Skipping_the_Next_Task_in_a_Case">Skipping the Next Task in a Case</a></li>
<li class="toc"><a href="#Reopening_Cases">Reopening Cases</a></li>
<li class="toc"><a href="#Executing_a_Task_a_Variable_Number_of_Times">Executing a Task a Variable Number of Times</a></li>
<ol class="toc">
<li class="toc"><a href="#Repeating_a_Task_with_a_Loop-Around">Repeating a Task with a Loop-Around</a></li>
<ol class="toc">
<li class="toc"><a href="#If_a_Task_May_Repeat_Zero_Times">If a Task May Repeat Zero Times</a></li>
<li class="toc"><a href="#Drawbacks">Drawbacks</a></li>
</ol>
<li class="toc"><a href="#A_Variable_Number_of_Parallel_Tasks">A Variable Number of Parallel Tasks</a></li>
</ol>
<li class="toc"><a href="#Sending_Grid_Information_via_Email">Sending Grid Information via Email</a></li>
<li class="toc"><a href="#Changing_Case_Status_to_TO_DO">Create new case and change its status</a></li>
<li class="toc"><a href="#New_Case_with_self_service">Create new case with a self service task</a></li>
<ol class="toc">
<li class="toc"><a href="#self_service_value_based_assignment">With a Self Service Value Based Assignment task</a></li>
</ol>
<li class="toc"><a href="#Select_user_assigned_to_task">Select the user for a Value Based Assignment task</a></li>
<li class="toc"><a href="#Pausing_Case_between_Activites">Pausing Cases between Activities</a></li>
<li class="toc"><a href="#Sending_email_when_case_unpaused">Sending an email when a case is unpaused</a></li>
</ol>
</div></div>

<h2><span id="Overview">Overview</span></h2>
<p>Triggers provide a great deal of customization and flexibility to process design. These examples provide some ideas for more advanced uses of triggers.</p>

<!-- IT Works!! YEAH-->
<h2><span id="Aborting_New_Cases_Under_Certain_Circumstances">Aborting New Cases Under Certain Circumstances</span></h2>

<p>A trigger could be written to abort an existing case under certain circumstances. For instance, suppose there is a process where users should not open a new case if there is already an existing case which hasn't yet been completed (or canceled). The following trigger code could be inserted <b>before the first step in the initial task</b> to lookup whether there is already a case assigned to the current logged-in user whose <strong><tt>APP_DELEGATION.DEL_THREAD_STATUS</tt></strong> field is equal to <tt>'OPEN'</tt>, meaning that the task hasn't been completed (or canceled) yet.</p> 

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//assign system variables to PHP variables so can be inserted in strings &nbsp;</span><br />
<span style="color: #000088;">$user</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span> <br />
<span style="color: #000088;">$process</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>PROCESS<span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//Query to find any uncompleted steps assigned to logged-in user</span><br />
<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT * FROM APP_DELEGATION WHERE PRO_UID='<span style="color: #006699; font-weight: bold;">$process</span>' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;USR_UID='<span style="color: #006699; font-weight: bold;">$user</span>' AND DEL_THREAD_STATUS='OPEN'&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$res</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//if any open tasks are are found, assigned to user</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$res</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$res</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">removeCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp;<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT * FROM APP_DELEGATION WHERE PRO_UID='<span style="color: #006699; font-weight: bold;">$process</span>' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;USR_UID='<span style="color: #006699; font-weight: bold;">$user</span>' AND DEL_THREAD_STATUS='OPEN'&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$res</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$casesId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$res</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$resExisting</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT * FROM APPLICATION WHERE &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;APP_UID='<span style="color: #006699; font-weight: bold;">$casesId</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseNo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$resExisting</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_NUMBER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$resExisting</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$delindex</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT DEL_INDEX FROM APP_DELEGATION &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$caseIdx</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$delindex</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> <br />
<br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//Finally display message to user to first complete other case </span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//and redirect to the existing case</span><br />
<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Case Aborted. Please complete or cancel &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;this Case #<span style="color: #006699; font-weight: bold;">$caseNo</span> before starting a new case&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'WARNING'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;G<span style="color: #339933;">::</span><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Location: cases_Open?APP_UID=<span style="color: #006699; font-weight: bold;">$caseId</span>&amp;&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;DEL_INDEX=<span style="color: #006699; font-weight: bold;">$caseIdx</span>&amp;action=sent&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<br />
<span style="color: #009900;">&#125;</span></div></div>

<p>If there is, then the new case which was just started will be deleted and a warning message will be displayed along with the summary of the existing case that the user should first complete.</p>
<p><img src="../sites/default/files/PM3.0TriggerExampleAbortCase.png"></p>
<!---->

<!--WORKS-->
<h2><span id="Workaround_for_Global_Variables">Workaround for Global Variables</span></h2>
<p>ProcessMaker does not have global variables, which can be used for all cases and processes. The best workaround for a global variable is to store values in a <a href="../3.0/PM_Tables.html">PM Table</a> or an <a href="../3.0/Database_Connections.html">external database</a>, and then look it up when needed with <a href="../3.0/ProcessMaker_Functions.html#executeQuery.28.29" title="ProcessMaker Functions">executeQuery()</a>. When needing to permanently change the value of the variable, write to the database.</p>
<p>For example, a PM Table named "GLOBALS" could be created with the fields "VARIABLE" and "VALUE". To store the names of the managers of a company, the following data could be stored in the "GLOBALS" PM Table:</p>

<codeblock>VARIABLE           VALUE
----------------   -------------------------------
CEO                Jane Doe
COO                John Smith
CFO                Billy Bragg
SALES_MANAGER      Sarah Quimby
SUPPORT_MANAGER    Sally Simpson
</codeblock>

<p>Then use the following query to look up the "CEO" global variable:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT VALUE FROM PMT_GLOBALS WHERE VARIABLE='CEO'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$ceo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'VALUE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">else</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$ceo</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span></div></div>

<p>To set the "CEO" global variable to "Mary Marvin":</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;">executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;UPDATE PMT_GLOBALS SET VALUE='Mary Marvin' WHERE VARIABLE='CEO'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong><font color="dimgray"> In ProcessMaker 3.0+, PM Tables have "<tt>PMT_</tt>" prepended to their names in the <strong><tt>wf_&lt;WORKSPACE&gt;</tt></strong> database.</font></p>
<!---->

<!-- IT WORKS -->
<h3><span id="Global_Counters_for_Cases">Global Counters for Cases</span></h3>
<p>PM Tables can be used to implement global counters that can work across all cases. For example, if needing to keep a counter of the number of cases for each department in an organization, create a PM Table named "COUNTERS" with the fields "VARIABLE" and "VALUE" with the following contents:</p>

<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">VARIABLE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE<br />
------------------------ &nbsp;-------<br />
SALES_COUNTER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />
FINANCE_COUNTER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />
HUMAN_RESOURCES_COUNTER &nbsp; 0</div></div>

<p>Then, add a trigger to every case to increment the counter and display the number in the counter in a DynaForm when beginning a new case. For example a new case in the Finance department would execute the following trigger before the first step in the first task:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//get the current value of the FINANCE_COUNTER and increment it:</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT VALUE FROM PMT_COUNTERS WHERE VARIABLE='FINANCE_COUNTER'&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span> or <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error accessing the COUNTERS PM Table!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@%</span>counter <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'VALUE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//write the new counter value to the database:</span><br />
&nbsp; &nbsp;executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;UPDATE PMT_COUNTERS SET VALUE=&quot;</span> <span style="color: #339933;">.</span> <span style="color: #339933;">@%</span>counter <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot; WHERE<br />
&nbsp; &nbsp; VARIABLE='FINANCE_COUNTER'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #b1b100;">else</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@%</span>counter <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span></div></div>

<p>Then, add a field named "counter" to a subsequent DynaForm, so the value of the counter can be displayed to the user.</p>
<p style="margin-left:25px"><strong><font color="green">Note:</font></strong><font color="dimgray"> In this case, the <tt>VALUE</tt> field is an INTEGER type, so its value doesn't need to be enclosed in single quotation marks like a CHAR or VARCHAR field.</font></p>
<!-- -->

<!--FUNCIONA! pero SALE ERROR "WSDerivateCase is not a valid method" x eso se uso otro metodo con Soap-->
<h2><span id="Routing_.28Derivating.29_all_Parallel_Tasks_in_a_Case">Routing (Derivating) all Parallel Tasks in a Case</span></h2>
<p>A trigger can be used to automatically route (derivate) all the the parallel tasks in a case. For example, if a purchase request is sent to 3 managers as 3 parallel tasks.</p>
<p><img src="../sites/default/files/PM3.0TriggerExampleDerivateParallel.png"></p>

<p>Once one manager makes a decision to approve or disapprove the purchase request, the case will automatically route on for all the other managers, so the first manager to make a decision will decide for the others and the case will be removed from the inbox of the other managers. The following trigger is fired <b><i>after Dynaform</i></b> of all parallel tasks.</p>
<p><img src="../sites/default/files/PM3.0TriggerExampleDerivateParallelStep.png"></p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//if set, then a decision was submitted by the manager</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>ManagerDecision<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$caseId</span><span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$userLogged</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//Select all the other parallel tasks for the current case that are still open</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT DEL_INDEX, U.USR_USERNAME FROM APP_DELEGATION AD, &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;USERS U WHERE AD.APP_UID = '<span style="color: #006699; font-weight: bold;">$caseId</span>' AND AD.DEL_THREAD_STATUS='OPEN' &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;AND AD.USR_UID = U.USR_UID AND AD.DEL_INDEX &lt;&gt; <span style="color: #006699; font-weight: bold;">$index</span>&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$threads</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$threads</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$threads</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$threads</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$thread</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//Login as the assigned users and route on their tasks </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT USR_PASSWORD FROM USERS WHERE &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;USR_USERNAME = '<span style="color: #006699; font-weight: bold;">{$thread['USR_USERNAME']}</span>'&quot;</span><span style="color: #339933;">;</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$task_user</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$task_user</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$task_user</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$nextpass</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'md5:'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$task_user</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_PASSWORD'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$sessionId</span> <span style="color: #339933;">=</span> WSLogin<span style="color: #009900;">&#40;</span><span style="color: #000088;">$thread</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_USERNAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$nextpass</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SoapClient<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'http://localhost/sysworkflow/en/neoclassic/services/wsdl2'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$params</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'sessionId'</span><span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$sessionId</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'caseId'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'delIndex'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$thread</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-&gt;</span>__SoapCall<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'routeCase'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$params</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">status_code</span> <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error routing case: <span style="color: #006699; font-weight: bold;">{$result-&gt;message}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span> &nbsp; <br />
&nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<!---->

<!--IT WORKS -->
<h2><span id="Routing_Parallel_Tasks_after_Completing_a_Fixed_Number">Routing Parallel Tasks after Completing a Fixed Number</span></h2>

<p>A process to approve expenses needs at least 3 out of 5 managers to review the expense before a decision can be made. The process has 5 parallel tasks which are assigned to each one of the managers.</p>
<p><img src="../sites/default/files/PM3.0TriggerExampleDerivateParallelFixedNumber.png"></p>

<p>The following trigger is fired <b><i>After Routing</i></b> of all the parallel tasks (which means that it will be fired after all the steps have been completed). 
<p><img src="../sites/default/files/PM3.0TriggerExampleDerivateParallelFixedNumberSteps.png"></p>

<p>The trigger code checks to see whether at least two of the other parallel tasks have already been completed. Including the current task, that would mean that three tasks have been completed, so the rest of the parallel tasks will automatically be routed (derivated). The code looks up the assigned users for those tasks and logins as those users and calls the <a href="../3.0/ProcessMaker_WSDL_Web_Services.html#routeCase.28.29">routeCase()</a> web service for each task.</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//ID for current case</span><br />
<span style="color: #000088;">$taskId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>TASK<span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//UIDs of the parallel tasks</span><br />
<span style="color: #000088;">$parallelTasks</span> <span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;'796356201572280bd19ebb5038311779','888702392572b6bbb11fcb4074248244',&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;'692596435572b6bbb7a3db7095131549','820220947572b6bbbe954d8093262285',&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;'689544677572b6bbc4bdda8055390856'&quot;</span><span style="color: #339933;">;</span> <br />
<br />
<span style="color: #000088;">$tasks</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT APP_UID, DEL_INDEX, TAS_UID, DEL_THREAD_STATUS, &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;USR_UID FROM APP_DELEGATION WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;AND TAS_UID in (<span style="color: #006699; font-weight: bold;">$parallelTasks</span>) and DEL_THREAD_STATUS &lt;&gt; 'CLOSED'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
<br />
<span style="color: #666666; font-style: italic;">//If 2 of the parallel tasks are open, then route them </span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$tasks</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SoapClient<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'http://localhost/sysworkflow/en/neoclassic/services/wsdl2'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$tasks</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$task</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$task</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_THREAD_STATUS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'OPEN'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT USR_USERNAME, USR_PASSWORD FROM USERS &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;WHERE USR_UID='<span style="color: #006699; font-weight: bold;">{$task['USR_UID']}</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$params</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'userid'</span> &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_USERNAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'password'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'md5:'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_PASSWORD'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-&gt;</span>__SoapCall<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'login'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$params</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">status_code</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$sessionId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">message</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unable to connect to ProcessMaker.<span style="color: #000099; font-weight: bold;">\n</span>Error Number: <span style="color: #006699; font-weight: bold;">{$result-&gt;status_code}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;Error Message: <span style="color: #006699; font-weight: bold;">{$result-&gt;message}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$params</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'sessionId'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$sessionId</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'caseId'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'delIndex'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$task</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-&gt;</span>__SoapCall<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'routeCase'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$params</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">status_code</span> <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error deriving case: <span style="color: #006699; font-weight: bold;">{$result-&gt;message}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<!---->

<!-- IT WORKS-->
<h2><span id="Displaying_a_List_of_Cases_in_a_Grid">Displaying a List of Cases in a Grid</span></h2>
<p>A grid with information and links to cases can be displayed in a DynaForm. For example, to display a list of cases for the currently logged in user in a grid, first create a grid named "casesGrid" with the fields "caseNumber" (textbox), "processName" (textbox), "taskName" (textbox), "dueDate"(date), "linkToCase" (link), "urlForCase" (hidden), and "labelForCase" (hidden). </p>
<p><img src="../sites/default/files/PM3.0TriggerExampleCasesinGrid.png"></p>

<p>Then, fire a trigger <b><i>before DynaForm</i></b> to populate the grid, with code like this:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@=</span>casesGrid <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$userId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span><br />
<span style="color: #000088;">$q</span> <span style="color: #339933;">=</span> &nbsp;<span style="color: #0000ff;">&quot;SELECT APP_UID, DEL_INDEX FROM APP_DELEGATION WHERE USR_UID='<span style="color: #006699; font-weight: bold;">$userId</span>'&quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot; and DEL_THREAD_STATUS='OPEN'&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$cases</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cases</span><span style="color: #009900;">&#41;</span> and <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cases</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cases</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$caseIndex</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$oCase</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$oCase</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$caseIndex</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//look up the Task Name and Process Name:</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$lang</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>SYS_LANG<span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT CON_VALUE FROM CONTENT WHERE &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;CON_ID = '<span style="color: #006699; font-weight: bold;">{$aCaseInfo['PRO_UID']}</span>' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;CON_CATEGORY='PRO_TITLE' AND CON_LANG='<span style="color: #006699; font-weight: bold;">$lang</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$processName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CON_VALUE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT CON_VALUE FROM CONTENT WHERE &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;CON_ID = '<span style="color: #006699; font-weight: bold;">{$aCaseInfo['TAS_UID']}</span>' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;CON_CATEGORY='TAS_TITLE' AND CON_LANG='<span style="color: #006699; font-weight: bold;">$lang</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$taskName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CON_VALUE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #339933;">@=</span>casesGrid<span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;caseNumber&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_NUMBER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;processName&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$processName</span> <span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;taskName&quot;</span> <span style="color: #339933;">=&gt;</span> &nbsp;<span style="color: #000088;">$taskName</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;dueDate&quot;</span> <span style="color: #339933;">=&gt;</span> &nbsp;<span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_TASK_DUE_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;linkToCase&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;urlForCase&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">&quot;../cases/cases_Open?APP_UID=<span style="color: #006699; font-weight: bold;">$caseId</span>&amp;DEL_INDEX=<span style="color: #006699; font-weight: bold;">$caseIndex</span>&quot;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;labelForCase&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_TITLE'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@=</span>casesGrid <span style="color: #339933;">=</span> orderGrid<span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>casesGrid<span style="color: #339933;">,</span> <span style="color: #0000ff;">'dueDate'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'DESC'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div></div>

<p>Then, add the following JavaScript code to the DynaForm to set the links in the casesGrid:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">var</span> totalRows <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;#casesGrid&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>getNumberRows<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">var</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;=</span> totalRows<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">var</span> url <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;#casesGrid&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>getValue<span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp; &nbsp; $<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;#casesGrid&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>setValue<span style="color: #009900;">&#40;</span>url<span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #009900;">&#125;</span></div></div>
<p>Run the case, and the trigger will display a list of all the open cases for the current user:</p>
<p><img src="../sites/default/files/PM3.0TriggerExampleCasesinGridExample.png"></p>
<!---->

<!-- YA FUNCIONA-->
<h2><span id="Skipping_the_Next_Task_in_a_Case">Skipping the Next Task in a Case</span></h2>
<p>If inside the current task, the rest of the steps in that task can be skipped by calling the <a href="../3.0/ProcessMaker_Functions.html#PMFDerivateCase.28.29">PMFDerivateCase()</a> function in a trigger. However, the PMFDerivateCase() function can't be called for tasks to which the current logged-in user is not assigned. Moreover, <code>PMFDerivateCase()</code> can't be called for tasks which don't yet have a record in the <strong><tt>wf_&lt;WORKSPACE&gt;.APP_DELEGATION</tt></strong> table and whose <strong><tt>DEL_THREAD_STATUS</tt></strong> field does not equal <code>"OPEN"</code>. For these reasons, <code>PMFDerivateCase()</code> cannot be used to skip the <i>next</i> task in a case.</p>
<p>Instead, to skip the next task, create a trigger which fires <b><i>After Derivation/Routing</i></b> of the previous task. After derivation, a record has already been created in the <strong><tt>wf_&lt;WORKSPACE&gt;.APP_DELEGATION</tt></strong> table, so the assigned user and the delegation index for the next task can be looked up with <a href="../3.0/ProcessMaker_Functions.html#executeQuery.28.29" title="ProcessMaker Functions">executeQuery()</a>. Also look up the MD5 hash for that user's password in the database. Then, login as that next assigned user with the <a href="../3.0/ProcessMaker_WSDL_Web_Services.html#Logging_in_with_ProcessMaker.27s_WSDL_web_services" title="ProcessMaker WSDL Web Services">login()</a> web service and then call <a href="../3.0/ProcessMaker_WSDL_Web_Services.html#Route_.28derivate.29_a_case" title="ProcessMaker WSDL Web Services">routeCase()</a> to route through the next task.</p>
<p>For example:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//lookup the user assigned to the next task in the case</span><br />
<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT AD.DEL_INDEX, U.USR_USERNAME FROM APP_DELEGATION AD, &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;USERS U WHERE AD.APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;AD.DEL_INDEX=(SELECT MAX(DEL_INDEX) FROM APP_DELEGATION &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;WHERE APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>') AND AD.USR_UID=U.USR_UID&quot;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$nextUser</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_USERNAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$nextIndex</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//lookup the md5 hash for the password</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;SELECT USR_PASSWORD FROM USERS WHERE USR_USERNAME='<span style="color: #006699; font-weight: bold;">$nextUser</span>'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$nextPass</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'md5:'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_PASSWORD'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; <br />
<span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SoapClient<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'http://localhost/sysworkflow/en/neoclassic/services/wsdl2'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$params</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'userid'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$nextUser</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'password'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$nextPass</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-&gt;</span>__SoapCall<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'login'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$params</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">status_code</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$sessionId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">message</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">else</span><br />
&nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unable to connect to ProcessMaker.<span style="color: #000099; font-weight: bold;">\n</span>Error Message: <span style="color: #006699; font-weight: bold;">{$result-&gt;message}</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp;<br />
<span style="color: #000088;">$params</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'sessionId'</span><span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$sessionId</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp;<span style="color: #0000ff;">'caseId'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <br />
&nbsp; &nbsp;<span style="color: #0000ff;">'delIndex'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$nextIndex</span><br />
<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-&gt;</span>__SoapCall<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'routeCase'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$params</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">status_code</span> <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error routing case: <span style="color: #006699; font-weight: bold;">{$result-&gt;message}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p>If needing to execute this code in the middle of the previous task, first call <code>PMFDerivateCase()</code>, then execute the rest of the above code. At the end, call <a href="../3.0/ProcessMaker_Functions.html#G::header.28.29" title="ProcessMaker Functions">G::header()</a> to redirect to the cases list and then call <a href="http://php.net/manual/en/function.die.php">die()</a>, to stop the previous task from trying to continue onto the next step.</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;">PMFDerivateCase<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//insert above code here</span><br />
<br />
G<span style="color: #339933;">::</span><a href="http://php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;location: casesListExtJs&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//if using version 2.0 +</span><br />
<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong><font color="dimgray"> This code will have problems if the next task is a parallel task, because its index number might not be the maximum index number. In that case, search for a particular task ID in the <strong><tt>APP_DELEGATION</tt></strong> table. Task IDs can be found with the <a href="../3.0/ProcessMaker_WSDL_Web_Services.html#Task_List" title="ProcessMaker WSDL Web Services">taskList()</a> function.</font></p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT AD.DEL_INDEX, U.USR_USERNAME FROM APP_DELEGATION AD, &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;USERS U WHERE AD.APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND AD.TAS_UID='XXXXXXXXXXXXXXXXXXXXXXX' &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;AND AD.DEL_INDEX=(SELECT MAX(DEL_INDEX) FROM APP_DELEGATION WHERE &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;APP_UID='<span style="color: #006699; font-weight: bold;">$caseId</span>' AND AD.TAS_UID='XXXXXXXXXXXXXXXXXXXXXXX') AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;AD.USR_UID=U.USR_UID&quot;</span><span style="color: #339933;">;</span></div></div>

<!-- IT WORKS YEAH -->
<h2><span id="Reopening_Cases">Reopening Cases</span></h2>
<p>After a case has been canceled or completed, it is not possible to reopen the case from the ProcessMaker interface. However, it is possible to reopen a case by using SQL queries to change the case's status from "CANCELLED" or "COMPLETED" to "TO_DO", so it will reappear in the user's Inbox.</p>

<p>For example, a process is created to reopen selected cases which are canceled or completed. This process contains the following DynaForm:</p>
<img src="../sites/default/files/DynaFormCasesToReopen.png" width="1000px">
<p>The grid is associated with a grid variable named "casesList" and it contains the following grid fields:
<ul>
<li>checkbox with ID 'reopen'</li>
<li>textbox with ID 'caseNo' (disabled mode)</li>
<li>textbox with ID 'process' (disabled mode)</li>
<li>textbox with ID 'task' (disabled mode)</li>
<li>textbox with ID 'user' (disabled mode)</li>
<li>textbox with ID 'updated' (disabled mode)</li>
<li>textbox with ID 'status' (disabled mode)</li>
<li>hidden field with ID 'caseId'</li>
<li>hidden field with ID 'index'</li>
<li>hidden field with ID 'userId'</li>
</ul>

<p>This grid is populated by the following trigger code which looks up all the cases with 'COMPLETED' or 'CANCELLED' status in the database and places information about those cases in the "casesList" grid. This trigger is executed <i>before</i> the DynaForm:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT APPLICATION.APP_UID, APPLICATION.APP_NUMBER, APPLICATION.APP_STATUS, APPLICATION.APP_UPDATE_DATE, APP_DELEGATION.DEL_INDEX, APP_DELEGATION.USR_UID, APP_DELEGATION.PRO_ID, APP_DELEGATION.TAS_ID, APP_DELEGATION.USR_ID<br />
&nbsp; FROM APPLICATION<br />
&nbsp; LEFT JOIN APP_DELEGATION ON (APPLICATION.APP_NUMBER = APP_DELEGATION.APP_NUMBER)<br />
&nbsp; WHERE DEL_LAST_INDEX = 1 AND APP_STATUS_ID IN (3,4)&quot;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #000088;">$cases</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cases</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; <a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error in query: <span style="color: #006699; font-weight: bold;">$query</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #339933;">@=</span>casesList <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cases</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">// Get the process title</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$q1</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT PRO_TITLE FROM PROCESS WHERE PRO_ID = &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PRO_ID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$r1</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$q1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">// Get the task title</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$q2</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT TAS_TITLE FROM TASK WHERE TAS_ID = &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAS_ID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$r2</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$q2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">// Get the user information</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$q3</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT USR_FIRSTNAME, USR_LASTNAME FROM USERS WHERE USR_ID = &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_ID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$r3</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$q3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$proTitle</span> <span style="color: #339933;">=</span> <a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r1</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PRO_TITLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ? <span style="color: #000088;">$r1</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PRO_TITLE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$tasTitle</span> <span style="color: #339933;">=</span> <a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r2</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAS_TITLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ? <span style="color: #000088;">$r2</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAS_TITLE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #000088;">$userInfo</span> <span style="color: #339933;">=</span> <a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r3</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_FIRSTNAME'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ? <span style="color: #000088;">$r3</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_FIRSTNAME'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span> <span style="color: #000088;">$r3</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_LASTNAME'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #339933;">@=</span>casesList<span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'caseId'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'index'</span> &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'userId'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'reopen'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'0'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'caseNo'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_NUMBER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'process'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$proTitle</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'task'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$tasTitle</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'user'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$userInfo</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'updated'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UPDATE_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'status'</span> &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$cases</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; <span style="color: #009900;">&#125;</span></div></div>
<p>A second trigger is created which is set to fire after the DynaForm. Its code loops through the <code>@=casesList</code> grid and reopens each case which is marked by the user.</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>casesList<span style="color: #009900;">&#41;</span> and <span style="color: #339933;">!</span><a href="http://php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>casesList<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$reopenedCount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>casesList <span style="color: #b1b100;">as</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'reopen'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'0'</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$caseId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'caseId'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$index</span> &nbsp;<span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'index'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$userId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'userId'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">ReactivateCurrentDelegation</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$index</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aCaseLoaded</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aCaseLoaded</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'TO_DO'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aCaseLoaded</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS_ID'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//only in version 3.2 and later</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">updateCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aCaseLoaded</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$reopenedCount</span><span style="color: #339933;">++;</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$reopenedCount</span> cases were reopened.&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;INFO&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>

<p><font color=green><b>Note:</b></font> <font color=dimgrey>If the number of cases listed for a user becomes inaccurate, the case counters for users can be updated by running the <strong><code>migrate-new-cases-lists</code></strong> ProcessMaker command in a terminal:</p>
<p><strong><u>LINUX/UNIX</u></strong></p>
<div class="geshifilter"><div class="bash geshifilter-bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">cd</span> <span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>processmaker<br />
.<span style="color: #000000; font-weight: bold;">/</span>processmaker migrate-new-cases-lists</div></div>

<p><strong><u>Windows</u></strong></p>
<div class="geshifilter"><div class="bash geshifilter-bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">cd</span> C:\Users\USERNAME\AppData\Roaming\ProcessMaker-<span style="color: #000000;">3</span>_X_X_X\processmaker<br />
..\php\php.exe <span style="color: #660033;">-f</span> processmaker migrate-new-cases-lists</div></div>
</font>
</div>

<!--FUNCIONA YEAH -->
<h2><span id="Executing_a_Task_a_Variable_Number_of_Times">Executing a Task a Variable Number of Times</span></h2>
<p>There are two ways to execute a task a variable number of times in a process, but both methods have their <a href="#Drawbacks">drawbacks</a>.</p>

<h3><span id="Repeating_a_Task_with_a_Loop-Around">Repeating a Task with a Loop-Around</span></h3>

<p>Use an <a href="../3.0/Gateways.html#Exclusive_Gateway" title="3.0/Exclusive Gateway">exclusive gateway</a> to create a loop-around for the same task in the process map so the task can be repeatedly executed.</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopDiagram.png"></p>

<p>In this example, the "Repeated Task" needs to be worked on by a different user of a group each time it executes. For that, set it to use <a href="../3.0/Tasks.html#Value_Based_Assignment" title="3.0/Tasks">Value Based Assignment</a>, so that a different user can be designated with each pass through the task. 
</p>

<p>The "Repeated Task" needs to be executed once by every member of a group named "Audit Team" (which has a unique ID of "684661865572a1d7cde5603040620405"). The group "Audit Team" has 3 members.</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopGroups.png"></p>

<p>Set a Trigger to fire in the "Initial Task" which will lookup the members of the "Audit Team". The Trigger creates:</p>
<ol><li>A case variable named <code>@%noRepeats</code> to keep track of the number of times the task has been repeated.</li><li>An array named <code>@=membersAuditTeam</code> to hold the unique IDs of the members of the "Audit Team" group.</li><li>A case variable named <code>@@currentAuditor</code> to hold the unique ID of the user who is designated to work on the "Repeating Task".</li></ol>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@%</span>noRepeats <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@=</span>membersAuditTeam <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>currentAuditor <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br />
G<span style="color: #339933;">::</span><span style="color: #004000;">LoadClass</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;groups&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Groups<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getUsersOfGroup</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'684661865572a1d7cde5603040620405'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//Group's ID</span><br />
<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@=</span>membersAuditTeam<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>membersAuditTeam<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>currentAuditor <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>membersAuditTeam<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> &nbsp; </div></div>

<p>Set the "Repeated Task" to use Value Based Assignment with the variable <code>@@currentAuditor</code>.</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopRepeatedAssign.png"></p>

<p>Set the exclusive gateway after "Repeated Task" to use the following <a href="../3.0/Using_Conditions.html" title="Using Conditions">conditions</a>:</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopRoutingGateway.png"></p>

<p>Finally, set the following Trigger to fire with each pass through the "Repeating Task", so that <code>@%noRepeats</code> will be incremented and <code> @@currentAuditor</code> will be set to the next user in the <code>@=membersAuditTeam</code> array.</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@%</span>noRepeats <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//increment for each pass through the task</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@%</span>noRepeats <span style="color: #339933;">&lt;</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>membersAuditTeam<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>currentAuditor <span style="color: #339933;">=</span> <span style="color: #339933;">@=</span>membersAuditTeam<span style="color: #009900;">&#91;</span><span style="color: #339933;">@%</span>noRepeats<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>

<p>When running the case, the "Repeated Task" will be redirected three times, each time to a different user group before being redirected to the "Final Task".</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopRun.png"></p>
<!---->

<!-- -->
<h4><span id="If_a_Task_May_Repeat_Zero_Times">If a Task May Repeat Zero Times</span></h4>
<p>If the "Repeating Task" needs to have the possibility of not being executed at all (for example, if there are zero members in the "Audit Team"), then an <a href="../3.0/Gateways.html#Exclusive_Gateway" title="3.0/Exclusive Gateway">exclusive gateway</a> needs to be added before the "Repeating Task" to skip it.</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopZeroDiagram.png"></p>

<p>Then, conditions can be added to the first evaluation routing rule to either go to the Repeating Task or skip to the "Final Task". For example:</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopZeroRoutingGateway.png"></p>

<p>The conditions in the second evaluation routing rule will be the same as in the previous example.</p>

<h4><span id="Drawbacks">Drawbacks</span></h4>
<p>Repeating a task with a loop-around has several drawbacks:</p>
<ol><li>The task will be executed serially, so that it can take a long time for each user to execute the task one by one.</li>
<li>If the repeating task contains a DynaForm, then each new user can change the values of the DynaForm fields with each loop, so the values from the first user might get overwritten by the second user, and the values of the second user might get overwritten by the values of the third user, etc.</li></ol>
 
<!-- IT WORKS--> 
<h3><span id="A_Variable_Number_of_Parallel_Tasks">A Variable Number of Parallel Tasks</span></h3>
<p>The other way to repeat a variable number of tasks is to create a parallel tasks which will all execute at the same time. Create as many variable tasks as the maximum number of times that the task could possibly be executed.</p>

<p style="margin-left:25px"><strong><font color="green">Note:</font></strong> <font color="dimgray"> ProcessMaker includes a parallel marker for tasks in version 3.0.1.4 and later, so the following code example is only necessary if using a previous version of ProcessMaker.</font></p>

<p>For example, if each parallel task needs to be executed by a member of the "Audit Team", then create as many parallel tasks as the largest number of possible members of the "Audit Team".</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopParallelDiagram.png"></p>

<p>Set each of the parallel tasks to use Value Based Assignment. "Parallel Task 1" uses variable <code>@@userForTask1</code>, "Parallel Task 2" uses variable <code>@@userForTask2</code>, "Parallel Task 3" uses variable <code>@@userForTask3</code> and "Parallel Task 4" uses variable <code>@@userForTask4</code>.</p>
<p>Then, set a Trigger to fire in the "Initial Task" which determines the number of parallel tasks to execute and which users will be designated to work on each parallel task.</p>
<p>For example, the following Trigger fired during the "Initial Task" looks up the members of the "Audit Team" (which has a unique ID of "684661865572a1d7cde5603040620405") and assigns each member to a different parallel task:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;">G<span style="color: #339933;">::</span><span style="color: #004000;">LoadClass</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;groups&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Groups<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getUsersOfGroup</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'684661865572a1d7cde5603040620405'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@%</span>noMembers <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@%</span>noMembers <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>userForTask1 <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@%</span>noMembers <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>userForTask2 <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@%</span>noMembers <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>userForTask3 <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> <br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@%</span>noMembers <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>userForTask4 <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>

<p>Set the <a href="../3.0/Using_Conditions.html" title="3.0/Using Conditions">conditions</a> in the <a href="../3.0/Gateways.html#Inclusive_Gateway">Inclusive Gateway</a> so that only as many parallel tasks are executed as the number of members in the "Audit Team":</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleTaskLoopParallel.png"></p>

<p>Finally, set the steps for each of the parallel tasks. If needing each parallel task to execute the same steps, then keep the following caveats in mind:</p>
<ul><li>For DynaForm steps, create a <i>separate</i> DynaForm for each of the parallel tasks. If the <i>same</i> DynaForm is used in all the parallel tasks, then every user can overwrite the data entered by the other users.<br>To create separate DynaForms for each parallel task, use the <strong>Save As</strong> option to create copies. Then go through the copies and rename all the DynaForm fields so they have different names.</li></ul>
<div style="margin-left: 50px;"><p>For example, if the original DynaForm is named "Audit Form" and it has the fields "accountName", "lastAudit" and "auditResult", then create:</p>
<ul><li>Audit Form 1 with the fields: "accountName1", "lastAudit1" and "auditResult1"</li><li>Audit Form 2 with the fields: "accountName2", "lastAudit2" and "auditResult2"</li><li>Audit Form 3 with the fields: "accountName3", "lastAudit3" and "auditResult3"</li><li>Audit Form 4 with the fields: "accountName4", "lastAudit4" and "auditResult4"</li></ul>
<p>In this way, each member of the "Audit Team" can fill out a separate form and won't see the data from the other auditors.</p></div>
<ul><li>For Input Document steps, the same Input Document can be used for all the parallel tasks. Each auditor can add additional files to the existing Input Document. However, if none of the auditors should be able to see the Input Document files from the other auditors, then create a separate Input Document for each parallel task.</li><li>For Output Document steps, the same Output Document can be used for all the parallel tasks as long as versioning is enabled, so each user doesn't overwrite the Output Documents of the other users.</li></ul>

<!-- IT WORKS YEAH -->
<h2><span id="Sending_Grid_Information_via_Email">Sending Grid Information via Email</span></h2>
<p>If the information of a Grid is required to be sent via email follow the steps below:</p>
<p><strong>1.</strong> Let's say that we need to send by email the information of a list of users adding in a grid, the id of the grid is <b><tt>GridName</tt></b> and the fields ids are <b><tt>FirstName</tt></b> and <b><tt>LastName</tt></b> respectively</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleGridEmail.png"></p>

<p>Create a trigger with the following HTML code on which the structure of the grid will be created:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;table &nbsp;border=&quot;1&quot;&gt;'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;tr&gt;'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;td style=&quot;background-color:#DEDEDE;&quot;&gt;First Name&lt;/td&gt;'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;td style=&quot;background-color:#DEDEDE;&quot;&gt;Last Name&lt;/td&gt;'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/tr&gt;'</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">@=</span>GridName <span style="color: #b1b100;">as</span> <span style="color: #000088;">$row</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;tr&gt;'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;td&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'FirstName'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/td&gt;'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;td&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'LastName'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/td&gt;'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/tr&gt;'</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #000088;">$Grid</span><span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/table&gt;'</span><span style="color: #339933;">;</span></div></div>

<p>It is necessary to create a table structure with a <tt>$Grid</tt> variable, this variable will be defined to store all the HTML structure, on each line <tt>$Grid</tt> variable will be concatenated with a previous value to construct the table. On the first part the header of the grid is defined, also cases variables can be defined. As the example above some styles can be used.</p>

<p>On the second part, it is necessary to add a <tt>foreach</tt> sentence, since it is not possible to know how many rows will be created on the grid, so <tt>foreach</tt> will allow to go through each line of the grid to create it on the template.</p>

<p><strong>2.</strong> Once the structure of the Grid is created, the <a href="../3.0/ProcessMaker_Functions.html#PMFSendMessage.28.29" title="ProcessMaker Functions">PMFSendMessage</a> function must be added to define the necessary parameters to send the email:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@@</span>result <span style="color: #339933;">=</span> PMFSendMessage <span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'mail@example.com'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'mail@example.com'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'mail2@example.com'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'mail3@example.com'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'Grid Example'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; <span style="color: #0000ff;">'template.html'</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Grid'</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$Grid</span><span style="color: #009900;">&#41;</span><br />
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>

<p>Since $Grid is an array it must be send on the last parameter of the function.</p>

<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleGridTrigger.png"></p>

<p><tt>Grid</tt> will be the name of the variable which will be defined inside template.html, it means that this variable will contain all the grid structure stored at <tt>$Grid</tt>.</p>
<p><strong>3.</strong> Finally create an HTML template named <tt>template.html</tt> with the following line:</p>

<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #339933;">@</span><span style="color: #666666; font-style: italic;">#Grid</span></div></div>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleGridTemplate.png"></p> 

<p>Assign the trigger <b><i>After Derivation</i></b> or <b><i>After Dynaform</i></b>. Don't forget to configure <a href="../3.0/Email_Settings.html" title="3.0/Email Settings">email notifications</a> to have mails sent successfully.</p>
<p><img alt="" src="../sites/default/files/PM3.0TriggerExampleGridEmailFormMail.png"></p>

<h2><span id="Changing_Case_Status_to_TO_DO">Create new case and change its status</span></h2>
<p>When a new case is created, its status is automatically set to "DRAFT", so it doesn't appear in the list of cases under <b>Home > Inbox</b>. The <a href="../3.0/Internal_Functions_and_Classes.html#Cases::updateCase.28.29">Cases::updateCase()</a> method can be used to change the status of the case from "DRAFT" to "TO_DO", so it will appear in the user's <b>Inbox</b>.</p>

<p>The following example creates a new case using the <a href="../3.2/ProcessMaker_Functions.html#PMFNewCase.28.29">PMFNewCase()</a> function and then changes its status to "TO_DO":</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$taskId</span> &nbsp; &nbsp;<span style="color: #339933;">=</span> <span style="color: #0000ff;">'13440667256aa8f12102541045873124'</span><span style="color: #339933;">;</span> &nbsp;<span style="color: #666666; font-style: italic;">//set to starting task's unique ID</span><br />
<span style="color: #000088;">$processId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'56583120656aa8ee87197a4069048886'</span><span style="color: #339933;">;</span> &nbsp;<span style="color: #666666; font-style: italic;">//set to the process' unique ID</span><br />
<span style="color: #000088;">$userLogged</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//set the current user</span><br />
<span style="color: #000088;">$aData</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span> &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//set variables from the current case to send to the new case</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">'Name'</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@@</span>clientName<span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">'Amount'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@@</span>InvoiceAmount<br />
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$newCaseId</span> <span style="color: #339933;">=</span> PMFNewCase<span style="color: #009900;">&#40;</span><span style="color: #000088;">$processId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$userLogged</span><span style="color: #339933;">,</span> <span style="color: #000088;">$taskId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aData</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCase</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'TO_DO'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">updateCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></div></div>

<p>If using ProcessMaker 3.2 and later, an optional parameter has been added to set the status of new cases created with the <a href="../3.2/Processmaker_Functions-2.html#PMFNewCase.28.29">PMFNewCase()</a> function, so it is no longer necessary to manually change the status of cases.</p>

<p>Nonetheless, if needing to manually change the status of cases in version 3.2 and later, the <code>Cases::updateCase()</code> and <code>ListParticipatedLast::update()</code> methods 
can be used to manually change the status of cases, as shown in this example:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCase</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'TO_DO'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">updateCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$newCaseId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//change the status of the case in the Home &gt; Participated list:</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aData</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'APP_UID'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_STATUS'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'USR_UID'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'DEL_INDEX'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'APP_STATUS'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'TO_DO'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$oListPartLast</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ListParticipatedLast<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$oListPartLast</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">update</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aData</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>

<p>Note that the above method should only be used if setting the status of a case to "TO_DO" or "DRAFT". if needing to change the case's status to "CANCELLED", "DELETED" or "PAUSED", then the corresponding <a href="../3.0/ProcessMaker_Functions.html#PMFCancelCase.28.29">PMFCancelCase()</a>, <a href="../3.0/Internal_Functions_and_Classes.html#Cases::removeCase.28.29">cases::removeCase()</a> or <a href="../3.0/ProcessMaker_Functions.html#PMFPauseCase.28.29">PMFPauseCase()</a> functions should be used. To change the status to "COMPLETED", the <a href="../3.0/ProcessMaker_Functions.html#PMFDerivateCase.28.29">PMFDerivateCase()</a> function can be used to complete a final task in the process.</p> 

<h2><span id="New_Case_with_self_service">Create new case with a self service task</span></h2>
<p>When a new case is started with the <a href="../3.0/ProcessMaker_Functions.html#PMFNewCase.28.29">PMFNewCase()</a> or <a href="../3.0/ProcessMaker_Functions.html#PMFNewCaseImpersonate.28.29">PMFNewCaseImpersonate()</a> functions (or the corresponding <a  href="../3.0/ProcessMaker_WSDL_Web_Services.html#newCase.28.29">web services</a> or <a href="../3.0/REST_API_Cases.html#New_Case:_POST_.2Fcases">REST endpoints</a>), the case will be assigned to the specified user. This is a problem if the case needs to start with a task which has <a href="../3.0/Tasks.html#Self_Service">Self Service</a> or <a href="../3.0/Tasks.html#Self_Service_Value_Based_Assignment">Self Service Value Based Assignment</a>, so it should not have an assigned user.</p> 

<p>The workaround to this problem is to create a <i>dummy task</i> before the self service task in the process:</p>
<img src="../sites/default/files/DummyTaskBeforeSelfService.png">
<p>Then, after creating the new case, call the <a href="../3.0/ProcessMaker_Functions.html#PMFDerivateCase.28.29">PMFDerivateCase()</a> function, the <a href="../3.0/ProcessMaker_WSDL_Web_Services.html#routeCase.28.29">routeCase()</a> web service or the <a href="../3.0/REST_API_Cases.html#Route_Case:_PUT_.2Fcases.2F.7Bapp_uid.7D.2Froute-case">PUT /cases/{app_uid}/route-case</a> REST endpoint to route the new case from the dummy task to the self service task. The case should then appear in the <b>Home > Unassigned</b> list, where any of the users who are in the assignment pool for the self service task can claim it.</p>
<p><b>Example with a Self Service task:</b></p>
<div style="margin-left:25px;">
<p>The following trigger code uses <code>PMFNewCase()</code> to first create the case and then <code>PMFDerivateCase()</code> to route to the self service case which is the second task in the process. The unique IDs of the process and the initial dummy task are found by running a case and looking at the values of the <code>@@PROCESS</code> and <code>@@TASK</code> system variable in the <a href="../3.0/Triggers.html#Debugging_Triggers">Debugger</a>.
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$processId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'1822559215775c714dadba1052021519'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to the Process ID</span><br />
<span style="color: #000088;">$dummyTaskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'3609934335775a15491fb93026385324'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to ID of the dummy task</span><br />
<span style="color: #339933;">@@</span>newCaseId <span style="color: #339933;">=</span> PMFNewCase<span style="color: #009900;">&#40;</span><span style="color: #000088;">$processId</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">,</span> <span style="color: #000088;">$dummyTaskId</span><span style="color: #339933;">,</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
PMFDerivateCase<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>newCaseId<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </div></div>
<p>This code will work as long as the logged-in user is also in the assignment pool for the initial dummy task. If not, then use the ID of a user who is in that assignment pool.</p>
</div>
<h3><span id="self_service_value_based_assignment">With a Self Service Value Based Assignment task</span></h3>
<p>If a new case should begin with a Self Service Value Based Assignment task, then the variable which holds the assignee(s) to the task needs to be passed to the new case. 
<p>In this example, there is one process with the "Start case" task:
<p><img src="../sites/default/files/NewCaseSelfServiceStartCase.png"></p>
<p>and another process with a "dummy task" and a "Self service task" which uses Self Service Value Based Assignment:</p>
<img src="../sites/default/files/DummyTaskBeforeSelfService.png">
<p>The "Start case" task contains a DynaForm with a dropdown box associated with the <code>@@selfServiceAssignee</code> variable. This dropdown is used to select the user or group to assign to the Self Service Value Based Assignment task:</p>
<p><img src="../sites/default/files/DropdownPropertiesAssigneeList.png"></p> 
<p>In the properties of this dropdown box, the <b>datasource</b> is set to "array variable" and the <b>data variable</b> is set to <code>@=aAvailableAssignees</code>. This variable holds a array of the users and groups assigned to the "Self service task".</p>
<p>The following trigger code, which is fired before the DynaForm, populates the list of available users and groups in the dropdown box:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">require_once</span> <span style="color: #0000ff;">&quot;classes/model/Groupwf.php&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Groupwf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//set to ID of self service value based assignment task</span><br />
<span style="color: #000088;">$selfServiceTaskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'4776332015775a154c5b053070364112'</span><span style="color: #339933;">;</span> <br />
<span style="color: #666666; font-style: italic;">//pool of users/groups that can be selected for the self service task</span><br />
<span style="color: #339933;">@=</span>aAvailableAssignees <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #666666; font-style: italic;">//look up users/groups assigned to the self service task</span><br />
<span style="color: #000088;">$query</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT USR_UID, TU_RELATION FROM TASK_USER WHERE TAS_UID='<span style="color: #006699; font-weight: bold;">$selfServiceTaskId</span>'&quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aAssignees</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignees</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//if a group, then look up group info:</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TU_RELATION'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Load</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'GRP_STATUS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">'ACTIVE'</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #339933;">@=</span>aAvailableAssignees<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'GRP_TITLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">//if a user</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aUserInfo</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'status'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">'ACTIVE'</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$fullName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'lastname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'<br />
&nbsp; &nbsp; &nbsp; &nbsp;('</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #339933;">@=</span>aAvailableAssignees<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aAssignee</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'USR_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$fullName</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>The trigger code retrieves the list of assigned users/groups from the <b><tt>USER_GROUP</tt></b> table in the database and places them in the <code>@=aAvailableAssignees</code> array to display in the dropdown. If the user or group's status is not set to <code>'ACTIVE'</code>, then it is not included in the list.</p>
<p><img src="../sites/default/files/SelectAssigneeSelfService.png"></p> 
<p>After the DynaForm, a second trigger is executed to create the new case:</p> 
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>selfServiceAssignee<span style="color: #009900;">&#41;</span> and <span style="color: #339933;">!</span><a href="http://php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>selfServiceAssignee<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$processId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'3711601605775a272301e35039931543'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to the Process ID</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$dummyTaskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'3609934335775a15491fb93026385324'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//set to ID of dummy task</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>newCaseId <span style="color: #339933;">=</span> PMFNewCase<span style="color: #009900;">&#40;</span><span style="color: #000088;">$processId</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">,</span> <span style="color: #000088;">$dummyTaskId</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'selfServiceAssignee'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@=</span>selfServiceAssignee<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>newCaseId<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error creating case&quot;</span> <span style="color: #339933;">.</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#40;</span><a href="http://php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>__ERROR__<span style="color: #009900;">&#41;</span> ? <span style="color: #0000ff;">': '</span><span style="color: #339933;">.@@</span>__ERROR__ <span style="color: #339933;">:</span> <span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;ERROR&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <br />
&nbsp; &nbsp; &nbsp; PMFDerivateCase<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>newCaseId<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>newCaseId<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$caseNo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_NUMBER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$ng</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Groups<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$ng</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">verifyGroup</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>selfServiceAssignee<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> &nbsp; <span style="color: #666666; font-style: italic;">//if a group</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;New case #<span style="color: #006699; font-weight: bold;">$caseNo</span> assigned to group &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">.</span> <span style="color: #339933;">@@</span>selfServiceAssignee_label<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'.&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'INFO'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">//if a user, then claim the case for that user:</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setCatchUser</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>newCaseId<span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>selfServiceAssignee<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$g</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> G<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$g</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SendMessageText</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;New case #<span style="color: #006699; font-weight: bold;">$caseNo</span> claimed by user &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">.@@</span>selfServiceAssignee_label<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'.&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'INFO'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#125;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>The <code>@@selfServiceAssignee</code> variable is passed to the new case which is created with the <a href="../3.0/ProcessMaker_Functions.html#PMFNewCase.28.29">PMFNewCase()</a> function, so that the ID of the user/group selected in the dropdown box will assigned to the "Self service task" in the second process.</p>
<p>After creating the new case, the trigger code then calls <a href="../3.0/ProcessMaker_Functions.html#PMFDerivateCase.28.29">PMFDerivateCase()</a> to move the new case from the "dummy task" to the "Self service task". If an individual user was assigned to the task, then the trigger calls <a href="../3.0/Internal_Functions_and_Classes.html#Cases::setCatchUser.28.29">Cases::setCatchUser()</a> to claim the case for that user. That way the user does not have to look under <b>HOME > Unassigned</b> to find the case and manually claim the case.</p> 
<p>Finally, <a href="../3.0/Internal_Functions_and_Classes.html#G::SendMessageText.28.29">G::SendMessageText()</a> is called to display a message at the top of the next screen to inform the user of the case number of the new case and who the case was assigned to.</p>
<p><img src="../sites/default/files/MessageNewCaseAssignedToGroup.png"></p>
<p>In order for this example to work, set the "Self service task" to use the <code>@@selfServiceAssignee</code> variable in its "Assignment Rules" properties:</p>
<p><img src="../sites/default/files/AssignmentRulesForSelfServiceTask.png"></p>
<p>Make sure that all the users/groups which are assigned to the "Start Case" task in the first process are also assigned to the "dummy task" in the second task. This is necessary, because the logged-in user needs to have the rights to call PMFDerivateCase() and route paste the "dummy task".</p>
<p>To test this example, download and import the <a href="../sites/default/files/Start_case_with_self_service-3.pmx">Start Case with self service process</a> (right click and select "Save As").</p>

<h2><span id="Select_user_assigned_to_task">Select the user for a Value Based Assignment task</span></h2>
<p><a href="../3.0/Tasks.html#Value_Based_Assignment">Value Based Assignment</a> can be used if needing to select a user to assign to task. This example shows how to populate a dropdown box in a DynaForm to select the user to assign to a task with Value Based Assignment. It also shows how to assign a user randomly from the pool of available users for a task.<p>
<p>The following process is used to complete a work order. The second task named "Do Work" uses Value Based Assignment. On the first pass through the "Do work" task, the user is chosen randomly from the pool of available users assigned to the task. In the third task named "Inspect work," a manager decides whether the work was done properly. If not, the manager can mark a checkbox to redo the "Do Work" task and can select a user from a dropdown box to assign to the task. Then the process will loop back to the "Do Work" task. </p>
<p><img src="../sites/default/files/SelectUserToAssignWithLoopAround.png"></p>
<p>To implement this process, first create the following variables:</p>
<ul>
<li>A string variable named "userAssignedToWork" which will be the variable used for Value Based Assignment in the "Do Work" task.
<li>An array variable named "availableUsers" which will hold the list of available users in the assignment pool for the "Do Work" task.
<li>A boolean variable named "doWorkOver" for a checkbox which is marked to redo the "Do Work" task.
</ul>
<p>Second, <i>right click</i> on the "Do Work" task, and select <b>Assignment Rules</b> from its context menu. In the dialog box that opens, select <b>Value Based Assignment</b> and set its <b>Variable for Value Based Assignment</b> to <code>@@userAssignedToWork</code>.</p>
<p><img src="../sites/default/files/SelectUserValueBasedAssignment.png"></p>
<p>Third, create the following DynaForm which the manager in the "Inspect Work" task will fill out if the "Do Work" task was not completed correctly in order to redo the task.</p>
<p><img src="../sites/default/files/SelectUserDynaFormWithDropdown.png"></p>
<p>In this DynaForm, the "Do work over?" checkbox is associated with the "doWorkOver" variable. The "Assign work to" dropdown box is associated with the "userAssignedToWork" variable. In the dropdown's properties, the <b>datasource</b> is set to "array variable" and the <b>data variable</b> is <code>@@availableUsers</code>. Set this DynaForm as a step in the "Inspect Work" task.</p>
<p>Fourth, go to the process map and <i>right click</i> on the exclusive gateway and select <b>Properties</b> from its context menu. In its routing rules, set the following conditions:</p>
<p><img src="../sites/default/files/SelectUserRoutingRules.png"></p>
<p>If the "Do work over?" checkbox is marked, its <code>@@doWorkOver_label</code> variable will be set to <code>"true"</code>; otherwise it will be set to <code>"false"</code>. In routing rules conditions, is recommended to use <a href="http://php.net/manual/en/function.isset.php">isset()</a> to check whether the variable exists, just in case the user decided to use the <b>Steps</b> menu to skip the DynaForm, so the variable was not saved.</p>
<p>Fifth, create the following trigger to randomly assign a user to the "Do Work" task from the pool of available users:</p>
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//use the debugger to find the ID of the task:</span><br />
<span style="color: #000088;">$nextTaskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'188586462577ed40a325599037697166'</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$d</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Derivation<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$d</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getAllUsersFromAnyTask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$nextTaskId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$cnt</span> <span style="color: #339933;">=</span> <a href="http://php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cnt</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<a href="http://php.net/die"><span style="color: #990000;">die</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Please assign users to the &quot;</span><span style="color: #b1b100;">Do</span> Work<span style="color: #0000ff;">&quot; task.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span><br />
<span style="color: #339933;">@@</span>userAssignedToWork <span style="color: #339933;">=</span> <span style="color: #000088;">$aUsers</span><span style="color: #009900;">&#91;</span><a href="http://php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$cnt</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></div>
<p>The <a href="../3.0/Internal_Functions_and_Classes.html#Derivation::getAllUsersFromAnyTask.28.29">Derivation::getAllUsersFromAnyTask()</a> method is called to get an array of the unique IDs of the users assigned to the "Do Work" task. Then, the <a href="http://php.net/manual/en/function.rand.php">rand()</a> function is used to randomly select one of those users to assign to the "Do Work" task. Set this trigger to execute <i>before assignment</i> in the "Fill work order" task.</p>
<p>Sixth, create another trigger to populate the list of users in the "Assign task to" dropdown box:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//use the debugger to find the ID of the task:</span><br />
<span style="color: #000088;">$nextTaskId</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'188586462577ed40a325599037697166'</span><span style="color: #339933;">;</span><br />
<span style="color: #339933;">@@</span>availableUsers <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$d</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Derivation<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aUsers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$d</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getAllUsersFromAnyTask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$nextTaskId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aUsers</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$userId</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aUserInfo</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$userId</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$fullName</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'firstname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'lastname'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'<br />
&nbsp; &nbsp; ('</span><span style="color: #339933;">.</span><span style="color: #000088;">$aUserInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')'</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@=</span>availableUsers<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$userId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$fullName</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #009900;">&#125;</span></div></div>
<p>This trigger calls <a href="../3.0/Internal_Functions_and_Classes.html#Derivation::getAllUsersFromAnyTask.28.29">Derivation::getAllUsersFromAnyTask()</a> to get an array of the users and then loops through the list, copying the user's IDs and full name into the <code>@=availableUsers</code> array, which will populate the list in the dropdown box. Set this trigger to execute <i>before</i> the DynaForm in the "Inspect Work" task.</p>
<p>Finally, assign users to the different tasks in the process, so that cases can be run in the process. <p>
<p>To test this example, download and import the <a href="../sites/default/files/Loop_Around-2.pmx">Loop Around process</a> (right click and select "Save As").</p></p>

<h2><span id="Pausing_Case_between_Activites">Pausing Cases between Activities</span></h2>
<p>The <a href="../3.0/Events.html#IntermediateTimerEvent">intermediate timer event</a> is designed to pause a case between activities (tasks and subprocesses) in the process, but the date and time for this event is fixed and cannot be set dynamically. Instead, the <a href="../3.0/ProcessMaker_Functions.html#PMFPauseCase.28.29">PMFPauseCase()</a> or <a href="../3.0/Internal_Functions_and_Classes.html#Cases_class">Cases::pauseCase()</a> functions can be used to pause a case. However, these functions immediately pause the case, rather than pausing them between activities. This trigger example shows how to call <a href="../3.0/ProcessMaker_Functions.html#PMFPauseCase.28.29">PMFPauseCase()</a> between activities and dynamically set the datetime when the case will unpause.</p>
<p>In the following process, the case is paused between "Task 1" and "Task 2". In Task 1, there is a DynaForm where the user selects a datetime when the case should start "Task 2".</p>
<p><img src="../sites/default/files/PauseBetweenTasksProcessMap.png"></p> 
<p>First, create two variables:</p>
<ul>
<li>A datetime variable named "pauseTillDate", which will set the datetime when the case will unpause.
<li>A datetime variable named "todayDate", which will set the minimum date in the date picker.
</ul>
<p>Second, create the following DynaForm with a datetime field associated with the "pauseTillDate" variable. In the datetime's properties, set its <b>min date</b> to <code>@@todayDate</code>. If needing to set the hours and minutes when the case will unpause, set its <b>format</b> to <code>YYYY-MM-DD HH:mm</code>.</p>
<p><img src="../sites/default/files/PauseBetweenTasksDynaForm.png"></p>
<p>Set this DynaForm as a step inside "Task 1".</p>
<p>Third, create the following trigger, which will set <code>@@todayDate</code> to today's date:</p>
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">@@todayDate = getCurrentDate();</div></div>
<p>Set this trigger to execute <i>before</i> the DynaForm containing the datetime field.</p>
<p>Fourth, create another trigger which will call <a href="../3.0/ProcessMaker_Functions.html#PMFPauseCase.28.29">PMFPauseCase()</a>. It uses <a href="../3.0/Internal_Functions_and_Classes.html#Cases::loadCase.28.29">Cases::LoadCase()</a> to look up the user assigned to the next task in the process.
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//get the user assigned to the next task:</span><br />
<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #666666; font-style: italic;">//if next task is a subprocess then no assigned user:</span><br />
<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$userId</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@@</span>USER_LOGGED<span style="color: #339933;">;</span><br />
<span style="color: #b1b100;">else</span><br />
&nbsp; &nbsp; <span style="color: #000088;">$userId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
<br />
PMFPauseCase<span style="color: #009900;">&#40;</span><span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <span style="color: #339933;">@%</span>INDEX<span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$userId</span><span style="color: #339933;">,</span> <span style="color: #339933;">@@</span>pauseTillDate<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></div>
<p>Set this trigger to execute <i>after routing</i> in "Task 1". At that point, "Task 2" will have already been created in the database, so that the case can be paused in the second task.</p>
<p>The steps and triggers in "Task 1" should have this placement:</p>
<p><img src="../sites/default/files/PauseBetweenTasksSteps.png" width="700px"></p>
<p>Make sure to configure the server where ProcessMaker is installed to <a href="../3.0/Executing_cron.html">periodically execute the <b><tt>cron.php</tt></b> script</a>, so that cases will be unpaused at the configured datetime. When a case is run, it will pause until the selected datetime before starting "Task 2". If the user does not select a datetime to pause the case, then it will pause indefinitely until the user assigned to "Task 2" manually unpauses the case.</p>
<p>To test this example, download and import the <a href="../sites/default/files/Pause_Case-3.pmx">Pause Case process</a> (<i>right click</i> and select "Save As").</p></p>

<h2><span id="Sending_email_when_case_unpaused">Sending an email when a case is unpaused</span></h2>
<p>The following example shows how to send an email to the assigned user of the current task when a case is unpaused. First, create a separate process that contains a script task which will be periodically executed. </p>
<p><img src="../sites/default/files/PeriodicScriptTask.png" ></p>
<p>Note that it is not possible to start a process with a script task, so the "dummy task" has to be created to start the process.</p>
<p>Right click on the intermediate timer event, and select <b>Properties</b> from its context menu. In the "Timer Event Properties" dialog box that appears, select the <b>Wait for</b> option and set the <b>Minutes</b> to "20".
<p><img src="../sites/default/files/PeriodicScriptTaskTimerProperties.png" ></p>
<p>Then, create the following email template named 'unpauseCase.html' which will be sent when the case is unpaused:</p>
<div class="geshifilter"><div class="text geshifilter-text" style="font-family:monospace;">Case #@=caseNo has been unpaused so that you can work on it.<br />
<br />
Case Title: @=caseTitle<br />
Paused: @=casePaused<br />
Unpaused: @=caseUnpaused<br />
Task: @=currentTask<br />
Due Date: @=taskDueDate<br />
Current User: @=taskAssignedUser</div></div>

<p>Then, create the following trigger in the same process:
<div class="geshifilter"><div class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$now</span> <span style="color: #339933;">=</span> <a href="http://php.net/date"><span style="color: #990000;">date</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Y-m-d H:i:s&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$sql</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;SELECT * FROM APP_DELAY WHERE APP_DISABLE_ACTION_USER='0' AND &quot;</span><span style="color: #339933;">.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;APP_DISABLE_ACTION_DATE&gt;='<span style="color: #006699; font-weight: bold;">$now</span>' AND APP_TYPE='PAUSE' &quot;</span><span style="color: #339933;">;</span><br />
<span style="color: #000088;">$aCases</span> <span style="color: #339933;">=</span> executeQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sql</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCases</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Cases<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">unpauseCase</span><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DELEGATION_USER'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #666666; font-style: italic;">//add 1 because unpauseCase increments index</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aCaseInfo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">LoadCase</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_UID'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DEL_INDEX'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <br />
&nbsp; <br />
&nbsp; &nbsp;<span style="color: #000088;">$t</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Task<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aTask</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$t</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Load</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;TAS_UID&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #000088;">$aUser</span> <span style="color: #339933;">=</span> userInfo<span style="color: #009900;">&#40;</span><span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_DELEGATION_USER'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp;<br />
&nbsp; &nbsp;<span style="color: #000088;">$caseNo</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;APP_NUMBER&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #000088;">$aVars</span> <span style="color: #339933;">=</span> <a href="http://php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;caseNo&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$caseNo</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;caseTitle&quot;</span> &nbsp; &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_TITLE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;casePaused&quot;</span> &nbsp; &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCase</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'APP_ENABLE_ACTION_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;caseUnpaused&quot;</span> &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$now</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;currentTask&quot;</span> &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aTask</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAS_TITLE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;taskDueDate&quot;</span> &nbsp; &nbsp; <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DEL_TASK_DUE_DATE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">&quot;taskAssignedUser&quot;</span><span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$aCaseInfo</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CURRENT_USER'</span><span style="color: #009900;">&#93;</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><br />
&nbsp; &nbsp;<span style="color: #339933;">@@</span>ret <span style="color: #339933;">=</span> PMFSendMessage<span style="color: #009900;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #339933;">@@</span>APPLICATION<span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'admin@example.com'</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aUser</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mail'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'Case '</span><span style="color: #339933;">.</span><span style="color: #000088;">$caseNo</span><span style="color: #339933;">.</span><span style="color: #0000ff;">' unpaused'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'unpauseCase.html'</span><span style="color: #339933;">,</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #000088;">$aVars</span><br />
&nbsp; &nbsp;<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp; <br />
<span style="color: #009900;">&#125;</span></div></div>

<p>Change <code>'admin@example.com'</code> to match the email of the default account set under <b>Admin > Settings > Email Servers</b>.</p>
<p>This trigger uses <a href="../3.0/ProcessMaker_Functions.html#executeQuery.28.29">executeQuery()</a> to look up the cases which are ready to be unpaused in the <b><tt>APP_DELAY</tt></b> table in the database. For each case, the trigger uses the <a href="../3.0/Internal_Functions_and_Classes.html#Cases::unpauseCase.28.29">Cases::unpauseCase()</a> method to pause the case. When the case is paused, its delegation index is incremented by <code>1</code>. Then, details about the case are obtained with <a href="../3.0/Internal_Functions_and_Classes.html#Cases::loadCase.28.29">Cases::LoadCase()</a>, <a href="../3.0/Internal_Functions_and_Classes.html#Task::Load.28.29">Task::Load()</a> and <a href="../3.0/ProcessMaker_Functions.html#userInfo.28.29">userInfo()</a>. These details are stored in an array of variables that will be passed to the <a href ="../3.0/ProcessMaker_Functions.html#PMFSendMessage.28.29">PMFSendMessage()</a> function, which sends an email to the user assigned to the case.</p>
<p>Set this trigger to be executed by the script task. <i>Right click</i> on the script task and select <b>Properties</b> from its context menu. Then, select this trigger in the dropdown box. Then, assign a user to the "dummy task" and run a case in the process.</p>  
<p>Finally, configure the ProcessMaker server to periodically <a href="../3.1/Executing_cron.html#executing_timereventcron.php">execute the <b><tt>timereventcron.php</tt></b> script</a> as a <a href="../3.1/Executing_cron.html#Configuring_crontab_in_Linux.2FUNIX">cron job in Linux/UNIX</a> or a <a href="../3.1/Executing_cron.html#Scheduling_a_task_in_Windows">Scheduled Task in Windows</a>. Make sure that <b><tt>timereventcron.php</tt></b> is executed <i>before</i> <b><tt>cron.php</tt></b>, because <b><tt>cron.php</tt></b> will also unpause cases so there won't be any cases to unpause by the above trigger if it is run after <b><tt>cron.php</tt></b>.

<p>To test this process, download and install the <a href="../sites/default/files/Periodic_Script_Task-1.pmx">Periodic_Script_Task-1.pmx</a> process (<i>right click</i> and select "Save Link As"). 
</div></div></div>  </div>

      <footer>
          </footer>
  
    </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
      </section>
    </div>
  
      
    </div>

      
</div>

 <!---add diego--->
  <div id="download-app-section" class="download-app mobile-none">
			<div class="row">
				<div class="col-md-12">
					<div class="text_app">Download our app</div>
							<a href="https://itunes.apple.com/us/app/processmaker/id992576284?ls=1&amp;mt=8" target="_blank">
								<img src="../themes/thecompany_responsive_theme/images/appstore.png">
							<a href="https://play.google.com/store/apps/details?id=com.colosa.processmaker" target="_blank">
								<img src="../themes/thecompany_responsive_theme/images/playstore.png">				
				</div>
			</div>
  </div>
  <!---end diego--->
<!----add diego----->    
		<div class="logo_processmaker"><a href="http://www.processmaker.com/">
		<img src="../themes/thecompany_responsive_theme/images/logo_processmaker.png"></div>
<!----end diego----->
<div id="footer">
  <div id="footer_wrapper">
      </div>

  <div class="social-media-wrapper">
         <div id="social-media-icons">
       <ul>
       	<div class="text_contact">Contact us</div>
				<div class="text_number">+1-617-340-3377</div>
        <!--<li><a class="rss" href="/rss.xml">rss</a></li> <!--edit diego-->
        <li><a class="facebook" href="http://facebook.com/processmaker/" target="_blank" rel="me">facebook</a></li>
        <li><a class="twitter" href="https://twitter.com/processmaker" target="_blank" rel="me">twitter</a></li>
        <li><a class="gplus" href="https://www.google.com/+ProcessMakerOpenSource" target="_blank" rel="me">Gplus</a></li>
        <li><a class="linkedin" href="https://www.linkedin.com/groups?mostRecent=&amp;gid=3970335&amp;trk=my_groups-tile-flipgrp" target="_blank" rel="me">Linked in</a></li>
        <!--<li><a class="dribbble" href="http://dribbble.com" target="_blank" rel="me">Dribbble</a></li>
        <li><a class="vimeo" href="http://vimeo.com" target="_blank" rel="me">Vimeo</a></li>-->
        <li><a class="youtube" href="https://www.youtube.com/user/processmaker" target="_blank" rel="me">Youtube</a></li>
       </ul>
      </div>
      </div>
  
  <div class="footer_credit">
    <div class="footer_inner_credit">
           <div id="foot"><div class="region region-footer">
  <div id="block-block-2" class="block block-block">

      
  <div class="content">
    <p><font style="font-family:arial,sans-serif; font-size:15px; font-weight: none; color:#FFF">Automate your Workflow with Business Process Management<br>Software licensed under the <a 1px="" class="external text" href="http://www.gnu.org/licenses/agpl.html" rel="nofollow" style="padding-right: 13px; color:white;">GNU Affero General Public License version 3</a><br>Contact us:&nbsp;<a class="external free" href="mailto:community@processmaker.com" rel="nofollow" style="font-weight:bold;color:white;text-decoration:underline;">community@processmaker.com</a><br><a class="external free" href="https://www.processmaker.com/privacy-statement" rel="nofollow" style="font-weight:bold;color:white;text-decoration:underline;">Privacy Statement</a></font><br><font style="font-family:arial,sans-serif; font-size:15px; font-weight: none; color:#FFF">© Copyright 2000-2024 ProcessMaker Inc. All rights reserved.</font></p>
  </div>
  
</div> <!-- /.block -->
</div>
 <!-- /.region -->
</div>
         
   <!-- <div id="copyright">
      <p class="copyright">Copyright &copy; 2024, Documentation@ProcessMaker </p>
      <!--<p class="credits"> Developed by  <a href="http://www.zymphonies.com">Zymphonies</a></p>
      <div class="clear"></div>
    </div>-->
  </div>
  
  </div>
</div>

</div>

<script type="text/javascript">
  /* <![CDATA[ */
  document.write (
    '<img src="https://marketing.processmaker.com/acton/bn/3812/visitor.gif?ts='+ new Date().getTime()+ '&ref='+escape(document.referrer) + '">'
  );
  /* ]]> */
</script>
  
</div>
    <style>
    .center-div{
        width: 100%;        
        margin: 0 auto;
        z-index:10000;
        position:fixed;
        bottom: 0px;
        cursor:pointer;
    }
    .round-popup{
        margin:0 auto;
        font-family: 'Montserrat', sans-serif;
        font-size: 15px;
        font-weight: lighter;
        width: 412px;
        height: 50px;
        padding-top: 7px;
        text-align: center;
        position:relative;
    }
    .round-popup-button{
        position:absolute;
        top: 11px;
        right: 15px;
        background: transparent;
        border:none;
        font-size:15px;
        font-weight:normal;
        line-height:20px;
        width:20px;
        height:20px;
        padding:0;
    }
    .round-background-blue{
        background: url('http://www.processmaker.com/uploads/blue.png')no-repeat;
        color:white;
        
    }
    #box-pm31-button-blue{
        color: rgba(255, 255, 255, 0.5);
    }
    
    #box-pm31-button-blue:active,#box-pm31-button-blue:focus{
        border:none;
        outline:none;
    }
    .round-background-blue a{
        color: white!important;
        text-decoration: none;
        font-size: 15px;
        line-height:45px;
        font-family:Montserrat, sans-serif;
    }
    .round-background-blue span{
        font-weight: bold;
    }
    /*WHITE background*/
    .round-background-white{
        background: url('http://www.processmaker.com/uploads/white.png')no-repeat;
        background-position-x: -9px;        
        color: #3397E1;
    }
    .round-background-white a:hover{
        color: #3397E1!important;
        text-decoration: none;
        font-size: 15px;
    }
    #box-pm31-button-white{
        color: rgba(51, 151, 225, 0.7);
    }
</style>
    <div id="box-pm31" class="center-div" style="display:none;">
        <div class="round-popup round-background-blue">
            <a onclick="ga('send', 'event', 'WikiBlueBanner','click','PM31Release');" href="http://www.processmaker.com/download-processmaker-landing-page">
                <span>ProcessMaker 3.1</span> is Here! Download Now <span style="font-size:20px;font-weigth:normal;">»</span>
            </a>
            <button id="box-pm31-button-blue" class="round-popup-button">&times;</button>
        </div>
    </div>
    <script>

function pmCreateCookie(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        var expires = "; expires="+date.toGMTString();
    }
    else var expires = "";
    document.cookie = name+"="+value+expires+"; path=/";
}

function pmReadCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function pmEraseCookie(name) {
    createCookie(name,"",-1);
}



     jQuery(document).ready(function( $ ) {
        $('#box-pm31-button-blue').click(function(e){
                e.stopPropagation();
                $('#box-pm31').slideUp('fast');
                pmCreateCookie('ppcookie','val',10);
            });
        });
        jQuery(window).load(function() {
            if(pmReadCookie('ppcookie') !== 'val'){
                //jQuery('#box-pm31').delay( 2000 ).slideDown('slow');
            }
        });
    </script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">

<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
    // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
    // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.marinsm.com/serve/586a7ec3a2ae6b728400003d.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>

</body>

<!-- Mirrored from wiki.processmaker.com/node/696 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Feb 2024 09:23:15 GMT -->
</html>
